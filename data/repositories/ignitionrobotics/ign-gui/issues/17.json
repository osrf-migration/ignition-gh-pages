{"priority": "minor", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gui.json"}, "html": {"href": "#!/ignitionrobotics/ign-gui"}, "avatar": {"href": "data/bytebucket.org/ravatar/{d80b97c2-f3f9-42b2-86b0-8c1fd4aa845f}ts=1406854"}}, "type": "repository", "name": "ign-gui", "full_name": "ignitionrobotics/ign-gui", "uuid": "{d80b97c2-f3f9-42b2-86b0-8c1fd4aa845f}"}, "links": {"attachments": {"href": "data/repositories/ignitionrobotics/ign-gui/issues/17/attachments_page=1.json"}, "self": {"href": "data/repositories/ignitionrobotics/ign-gui/issues/17.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-gui/issues/17/watch"}, "comments": {"href": "data/repositories/ignitionrobotics/ign-gui/issues/17/comments_page=1.json"}, "html": {"href": "#!/ignitionrobotics/ign-gui/issues/17/properly-terminate-render-engine"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-gui/issues/17/vote"}}, "reporter": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "title": "Properly terminate render engine", "component": null, "votes": 0, "watches": 1, "content": {"raw": "@iche033 mentioned on pull request #62 that we should call `Fini` on the ignition-rendering engine before terminating the program so it shuts down properly.\r\n\r\nI tried calling fini when the engine has no more scenes like this:\r\n\r\n~~~\r\ndiff -r 63bc2e88e616 src/plugins/Scene3D.cc\r\n--- a/src/plugins/Scene3D.cc\tTue Dec 26 08:53:22 2017 -0800\r\n+++ b/src/plugins/Scene3D.cc\tTue Dec 26 09:27:22 2017 -0800\r\n@@ -90,6 +90,8 @@\r\n     engine->DestroyScene(scene);\r\n \r\n     // TODO: If that was the last scene, terminate engine?\r\n+    if (engine->SceneCount() == 0)\r\n+      engine->Fini();\r\n   }\r\n }\r\n~~~\r\n\r\nBut if after doing this, we try to open a new scene plugin (i.e. re-init the engine), the program crashes with this backtrace:\r\n\r\n~~~\r\n/usr/local/lib/libignition-rendering-ogre.so.0(_ZN8ignition9rendering9OgreScene13CreateContextEv+0x75) [0x7f49e1e5c731] /home/louise/code/ign-rendering/src/ogre/OgreScene.cc:339\r\n/usr/local/lib/libignition-rendering-ogre.so.0(_ZN8ignition9rendering9OgreScene8InitImplEv+0x3a) [0x7f49e1e57faa] /home/louise/code/ign-rendering/src/ogre/OgreScene.cc:124\r\n/usr/local/lib/libignition-rendering-base.so.0(_ZN8ignition9rendering9BaseScene4InitEv+0x1d1) [0x7f49e18de6a7] /home/louise/code/ign-rendering/src/base/BaseScene.cc:70\r\n/usr/local/lib/libignition-rendering-base.so.0(_ZN8ignition9rendering16BaseRenderEngine12PrepareSceneESt10shared_ptrINS0_5SceneEE+0xc8) [0x7f49e18daea6] /home/louise/code/ign-rendering/src/base/BaseRenderEngine.cc:214\r\n/usr/local/lib/libignition-rendering-base.so.0(_ZN8ignition9rendering16BaseRenderEngine11CreateSceneEjRKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE+0x785) [0x7f49e18daae5] /home/louise/code/ign-rendering/src/base/BaseRenderEngine.cc:193\r\n/usr/local/lib/libignition-rendering-base.so.0(_ZN8ignition9rendering16BaseRenderEngine11CreateSceneERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE+0x86) [0x7f49e18da2e0] /home/louise/code/ign-rendering/src/base/BaseRenderEngine.cc:167\r\n/usr/local/lib/ign-gui-0/plugins/libScene3D.so(_ZN8ignition3gui7plugins7Scene3D10LoadConfigEPKN8tinyxml210XMLElementE+0x1199) [0x7f49e24ed8e7] /home/louise/code/ign-gui/src/plugins/Scene3D.cc:170\r\n/usr/local/lib/libignition-gui0.so(_ZN8ignition3gui6Plugin4LoadEPKN8tinyxml210XMLElementE+0x93d) [0x7f4a1557b765] /home/louise/code/ign-gui/src/Plugin.cc:100\r\n/usr/local/lib/libignition-gui0.so(_ZN8ignition3gui10loadPluginERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEPKN8tinyxml210XMLElementE+0x15c8) [0x7f4a154cebe1] /home/louise/code/ign-gui/src/Iface.cc:553\r\n/usr/local/lib/libignition-gui0.so(_ZN8ignition3gui10MainWindow11OnAddPluginE7QString+0x1d7) [0x7f4a154f041d] /home/louise/code/ign-gui/src/MainWindow.cc:268\r\n/usr/local/lib/libignition-gui0.so(_ZN8ignition3gui10MainWindow18qt_static_metacallEP7QObjectN11QMetaObject4CallEiPPv+0x19d) [0x7f4a1559fd97] /home/louise/code/ign-gui/build/include/ignition/gui/moc_MainWindow.cpp:88\r\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN11QMetaObject8activateEP7QObjectiiPPv+0x7ea) [0x7f4a1228fd2a]\r\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN13QSignalMapper6mappedERK7QString+0x35) [0x7f4a1229a1a5]\r\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN13QSignalMapper3mapEP7QObject+0x202) [0x7f4a1229b6f2]\r\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN11QMetaObject8activateEP7QObjectiiPPv+0x7ea) [0x7f4a1228fd2a]\r\n/usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5(_ZN7QAction9triggeredEb+0x42) [0x7f4a1309f412]\r\n/usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5(_ZN7QAction8activateENS_11ActionEventE+0xf8) [0x7f4a130a1898]\r\n/usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5 [0x7f4a130a1e1f]\r\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN7QObject5eventEP6QEvent+0xf1) [0x7f4a12290c01]\r\n/usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5(_ZN7QAction5eventEP6QEvent+0x22) [0x7f4a130a2122]\r\n/usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5(_ZN19QApplicationPrivate13notify_helperEP7QObjectP6QEvent+0x8c) [0x7f4a130a905c]\r\n/usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5(_ZN12QApplication6notifyEP7QObjectP6QEvent+0x256) [0x7f4a130ae516]\r\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN16QCoreApplication14notifyInternalEP7QObjectP6QEvent+0xdb) [0x7f4a1226138b]\r\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN23QCoreApplicationPrivate16sendPostedEventsEP7QObjectiP11QThreadData+0x2c6) [0x7f4a12263786]\r\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5 [0x7f4a122b73c3]\r\n/lib/x86_64-linux-gnu/libglib-2.0.so.0(g_main_context_dispatch+0x2a7) [0x7f4a0f33f197]\r\n/lib/x86_64-linux-gnu/libglib-2.0.so.0 [0x7f4a0f33f3f0]\r\n/lib/x86_64-linux-gnu/libglib-2.0.so.0(g_main_context_iteration+0x2c) [0x7f4a0f33f49c]\r\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN20QEventDispatcherGlib13processEventsE6QFlagsIN10QEventLoop17ProcessEventsFlagEE+0x5f) [0x7f4a122b77cf]\r\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN10QEventLoop4execE6QFlagsINS_17ProcessEventsFlagEE+0x10a) [0x7f4a1225eb4a]\r\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN16QCoreApplication4execEv+0x9c) [0x7f4a12266bec]\r\n/usr/local/lib/libignition-gui0.so(_ZN8ignition3gui13runMainWindowEv+0x205) [0x7f4a154d09bb] /home/louise/code/ign-gui/src/Iface.cc:659\r\n/usr/local/lib/libignition-gui0.so(_ZN8ignition3gui9runConfigERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE+0x3ee) [0x7f4a154c9be1] /home/louise/code/ign-gui/src/Iface.cc:226\r\n/usr/local/lib/libignition-gui0.so(cmdConfig+0x81) [0x7f4a154eabe9] /home/louise/code/ign-gui/src/ign.cc:53\r\n/usr/lib/x86_64-linux-gnu/libffi.so.6(ffi_call_unix64+0x4c) [0x7f4a158b2e40]\r\n/usr/lib/x86_64-linux-gnu/libffi.so.6(ffi_call+0x2eb) [0x7f4a158b28ab]\r\n/usr/lib/x86_64-linux-gnu/ruby/2.3.0/fiddle.so [0x7f4a15ab9758]\r\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a180427ef]\r\n/usr/lib/x86_64-linux-gnu/ruby/2.3.0/fiddle.so [0x7f4a15ab9585]\r\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a1802450b]\r\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a180324a3]\r\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a180334d3]\r\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a1802819c]\r\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a1802d142]\r\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a17f13cfd]\r\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3(ruby_exec_node+0x1d) [0x7f4a17f156fd]\r\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3(ruby_run_node+0x1e) [0x7f4a17f1783e]\r\n/usr/bin/ruby [0x40087b]\r\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0) [0x7f4a17b02830] ../csu/libc-start.c:291\r\n/usr/bin/ruby(_start+0x29) [0x4008a9]\r\n~~~", "markup": "markdown", "html": "<p>@iche033 mentioned on <a href=\"#!/ignitionrobotics/ign-gui/pull-requests/62/rendering-plugins-scene3d-and-grid3d\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #62</a> that we should call <code>Fini</code> on the ignition-rendering engine before terminating the program so it shuts down properly.</p>\n<p>I tried calling fini when the engine has no more scenes like this:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 63bc2e88e616 src/plugins/Scene3D.cc</span>\n<span class=\"gd\">--- a/src/plugins/Scene3D.cc    Tue Dec 26 08:53:22 2017 -0800</span>\n<span class=\"gi\">+++ b/src/plugins/Scene3D.cc    Tue Dec 26 09:27:22 2017 -0800</span>\n<span class=\"gu\">@@ -90,6 +90,8 @@</span>\n     engine-&gt;DestroyScene(scene);\n\n     // TODO: If that was the last scene, terminate engine?\n<span class=\"gi\">+    if (engine-&gt;SceneCount() == 0)</span>\n<span class=\"gi\">+      engine-&gt;Fini();</span>\n   }\n }\n</pre></div>\n\n\n<p>But if after doing this, we try to open a new scene plugin (i.e. re-init the engine), the program crashes with this backtrace:</p>\n<div class=\"codehilite\"><pre><span></span>/usr/local/lib/libignition-rendering-ogre.so.0(_ZN8ignition9rendering9OgreScene13CreateContextEv+0x75) [0x7f49e1e5c731] /home/louise/code/ign-rendering/src/ogre/OgreScene.cc:339\n/usr/local/lib/libignition-rendering-ogre.so.0(_ZN8ignition9rendering9OgreScene8InitImplEv+0x3a) [0x7f49e1e57faa] /home/louise/code/ign-rendering/src/ogre/OgreScene.cc:124\n/usr/local/lib/libignition-rendering-base.so.0(_ZN8ignition9rendering9BaseScene4InitEv+0x1d1) [0x7f49e18de6a7] /home/louise/code/ign-rendering/src/base/BaseScene.cc:70\n/usr/local/lib/libignition-rendering-base.so.0(_ZN8ignition9rendering16BaseRenderEngine12PrepareSceneESt10shared_ptrINS0_5SceneEE+0xc8) [0x7f49e18daea6] /home/louise/code/ign-rendering/src/base/BaseRenderEngine.cc:214\n/usr/local/lib/libignition-rendering-base.so.0(_ZN8ignition9rendering16BaseRenderEngine11CreateSceneEjRKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE+0x785) [0x7f49e18daae5] /home/louise/code/ign-rendering/src/base/BaseRenderEngine.cc:193\n/usr/local/lib/libignition-rendering-base.so.0(_ZN8ignition9rendering16BaseRenderEngine11CreateSceneERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE+0x86) [0x7f49e18da2e0] /home/louise/code/ign-rendering/src/base/BaseRenderEngine.cc:167\n/usr/local/lib/ign-gui-0/plugins/libScene3D.so(_ZN8ignition3gui7plugins7Scene3D10LoadConfigEPKN8tinyxml210XMLElementE+0x1199) [0x7f49e24ed8e7] /home/louise/code/ign-gui/src/plugins/Scene3D.cc:170\n/usr/local/lib/libignition-gui0.so(_ZN8ignition3gui6Plugin4LoadEPKN8tinyxml210XMLElementE+0x93d) [0x7f4a1557b765] /home/louise/code/ign-gui/src/Plugin.cc:100\n/usr/local/lib/libignition-gui0.so(_ZN8ignition3gui10loadPluginERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEPKN8tinyxml210XMLElementE+0x15c8) [0x7f4a154cebe1] /home/louise/code/ign-gui/src/Iface.cc:553\n/usr/local/lib/libignition-gui0.so(_ZN8ignition3gui10MainWindow11OnAddPluginE7QString+0x1d7) [0x7f4a154f041d] /home/louise/code/ign-gui/src/MainWindow.cc:268\n/usr/local/lib/libignition-gui0.so(_ZN8ignition3gui10MainWindow18qt_static_metacallEP7QObjectN11QMetaObject4CallEiPPv+0x19d) [0x7f4a1559fd97] /home/louise/code/ign-gui/build/include/ignition/gui/moc_MainWindow.cpp:88\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN11QMetaObject8activateEP7QObjectiiPPv+0x7ea) [0x7f4a1228fd2a]\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN13QSignalMapper6mappedERK7QString+0x35) [0x7f4a1229a1a5]\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN13QSignalMapper3mapEP7QObject+0x202) [0x7f4a1229b6f2]\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN11QMetaObject8activateEP7QObjectiiPPv+0x7ea) [0x7f4a1228fd2a]\n/usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5(_ZN7QAction9triggeredEb+0x42) [0x7f4a1309f412]\n/usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5(_ZN7QAction8activateENS_11ActionEventE+0xf8) [0x7f4a130a1898]\n/usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5 [0x7f4a130a1e1f]\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN7QObject5eventEP6QEvent+0xf1) [0x7f4a12290c01]\n/usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5(_ZN7QAction5eventEP6QEvent+0x22) [0x7f4a130a2122]\n/usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5(_ZN19QApplicationPrivate13notify_helperEP7QObjectP6QEvent+0x8c) [0x7f4a130a905c]\n/usr/lib/x86_64-linux-gnu/libQt5Widgets.so.5(_ZN12QApplication6notifyEP7QObjectP6QEvent+0x256) [0x7f4a130ae516]\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN16QCoreApplication14notifyInternalEP7QObjectP6QEvent+0xdb) [0x7f4a1226138b]\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN23QCoreApplicationPrivate16sendPostedEventsEP7QObjectiP11QThreadData+0x2c6) [0x7f4a12263786]\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5 [0x7f4a122b73c3]\n/lib/x86_64-linux-gnu/libglib-2.0.so.0(g_main_context_dispatch+0x2a7) [0x7f4a0f33f197]\n/lib/x86_64-linux-gnu/libglib-2.0.so.0 [0x7f4a0f33f3f0]\n/lib/x86_64-linux-gnu/libglib-2.0.so.0(g_main_context_iteration+0x2c) [0x7f4a0f33f49c]\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN20QEventDispatcherGlib13processEventsE6QFlagsIN10QEventLoop17ProcessEventsFlagEE+0x5f) [0x7f4a122b77cf]\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN10QEventLoop4execE6QFlagsINS_17ProcessEventsFlagEE+0x10a) [0x7f4a1225eb4a]\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN16QCoreApplication4execEv+0x9c) [0x7f4a12266bec]\n/usr/local/lib/libignition-gui0.so(_ZN8ignition3gui13runMainWindowEv+0x205) [0x7f4a154d09bb] /home/louise/code/ign-gui/src/Iface.cc:659\n/usr/local/lib/libignition-gui0.so(_ZN8ignition3gui9runConfigERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE+0x3ee) [0x7f4a154c9be1] /home/louise/code/ign-gui/src/Iface.cc:226\n/usr/local/lib/libignition-gui0.so(cmdConfig+0x81) [0x7f4a154eabe9] /home/louise/code/ign-gui/src/ign.cc:53\n/usr/lib/x86_64-linux-gnu/libffi.so.6(ffi_call_unix64+0x4c) [0x7f4a158b2e40]\n/usr/lib/x86_64-linux-gnu/libffi.so.6(ffi_call+0x2eb) [0x7f4a158b28ab]\n/usr/lib/x86_64-linux-gnu/ruby/2.3.0/fiddle.so [0x7f4a15ab9758]\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a180427ef]\n/usr/lib/x86_64-linux-gnu/ruby/2.3.0/fiddle.so [0x7f4a15ab9585]\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a1802450b]\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a180324a3]\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a180334d3]\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a1802819c]\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a1802d142]\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3 [0x7f4a17f13cfd]\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3(ruby_exec_node+0x1d) [0x7f4a17f156fd]\n/usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3(ruby_run_node+0x1e) [0x7f4a17f1783e]\n/usr/bin/ruby [0x40087b]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0) [0x7f4a17b02830] ../csu/libc-start.c:291\n/usr/bin/ruby(_start+0x29) [0x4008a9]\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "new", "version": null, "edited_on": null, "created_on": "2017-12-26T17:29:45.313688+00:00", "milestone": null, "updated_on": "2017-12-26T17:29:45.313688+00:00", "type": "issue", "id": 17}