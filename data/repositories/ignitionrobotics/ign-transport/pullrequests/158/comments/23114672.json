{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/158/comments/23114672.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/diff/nampi/ign-transport:78fff8d7b202..f63548f31172?path=src%2FNodeShared.cc"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/158/_/diff#comment-23114672"}}, "parent": {"id": 23000203, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/158/comments/23000203.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/158/_/diff#comment-23000203"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 158, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/158.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/158"}}, "title": "Issue_47: Wait for subscribers"}, "content": {"raw": "I think is still needed. The first part of `WaitForSubscribers()` guarantees that your node has advertised the topic before with the requested type (`type1` for example). This part checks whether there are already remote subscribers. We need it because other node within our process could advertise the same topic but different type (`type2` for example) and other node in a separate process might be subscribed using `type2` too. In this scenario, we'll have a remote subscriber for our topic but we're not interested on it because our type is `type1`. We should create a test case for this scenario:\n\n\n```\n#!c++\n\nreset();\n\ntransport::Node node;\ntransport::Node node2;\nunsigned int timeout = 1000;\nEXPECT_TRUE(node.Advertise<ignition::msgs::Vector3d>(g_topic));\nEXPECT_TRUE(node2.Advertise<ignition::msgs::Int32>(g_topic));\n\nstd::string subscriberPath = testing::portablePathUnion(\n   PROJECT_BINARY_PATH,\n   \"test/integration/INTEGRATION_waitForSubscribers_aux\");\ntesting::forkHandlerType pi = testing::forkAndRun(subscriberPath.c_str(),\n  partition.c_str());\nstd::this_thread::sleep_for(std::chrono::milliseconds(timeout));\n\nEXPECT_FALSE(node2.WaitForSubscribers<ignition::msgs::Vector3d>(g_topic,\n  timeout));\n\ntesting::waitAndCleanupFork(pi);\n```\n", "markup": "markdown", "html": "<p>I think is still needed. The first part of <code>WaitForSubscribers()</code> guarantees that your node has advertised the topic before with the requested type (<code>type1</code> for example). This part checks whether there are already remote subscribers. We need it because other node within our process could advertise the same topic but different type (<code>type2</code> for example) and other node in a separate process might be subscribed using <code>type2</code> too. In this scenario, we'll have a remote subscriber for our topic but we're not interested on it because our type is <code>type1</code>. We should create a test case for this scenario:</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"n\">reset</span><span class=\"p\">();</span>\n\n<span class=\"n\">transport</span><span class=\"o\">::</span><span class=\"n\">Node</span> <span class=\"n\">node</span><span class=\"p\">;</span>\n<span class=\"n\">transport</span><span class=\"o\">::</span><span class=\"n\">Node</span> <span class=\"n\">node2</span><span class=\"p\">;</span>\n<span class=\"kt\">unsigned</span> <span class=\"kt\">int</span> <span class=\"n\">timeout</span> <span class=\"o\">=</span> <span class=\"mi\">1000</span><span class=\"p\">;</span>\n<span class=\"n\">EXPECT_TRUE</span><span class=\"p\">(</span><span class=\"n\">node</span><span class=\"p\">.</span><span class=\"n\">Advertise</span><span class=\"o\">&lt;</span><span class=\"n\">ignition</span><span class=\"o\">::</span><span class=\"n\">msgs</span><span class=\"o\">::</span><span class=\"n\">Vector3d</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">g_topic</span><span class=\"p\">));</span>\n<span class=\"n\">EXPECT_TRUE</span><span class=\"p\">(</span><span class=\"n\">node2</span><span class=\"p\">.</span><span class=\"n\">Advertise</span><span class=\"o\">&lt;</span><span class=\"n\">ignition</span><span class=\"o\">::</span><span class=\"n\">msgs</span><span class=\"o\">::</span><span class=\"n\">Int32</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">g_topic</span><span class=\"p\">));</span>\n\n<span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">string</span> <span class=\"n\">subscriberPath</span> <span class=\"o\">=</span> <span class=\"n\">testing</span><span class=\"o\">::</span><span class=\"n\">portablePathUnion</span><span class=\"p\">(</span>\n   <span class=\"n\">PROJECT_BINARY_PATH</span><span class=\"p\">,</span>\n   <span class=\"s\">&quot;test/integration/INTEGRATION_waitForSubscribers_aux&quot;</span><span class=\"p\">);</span>\n<span class=\"n\">testing</span><span class=\"o\">::</span><span class=\"n\">forkHandlerType</span> <span class=\"n\">pi</span> <span class=\"o\">=</span> <span class=\"n\">testing</span><span class=\"o\">::</span><span class=\"n\">forkAndRun</span><span class=\"p\">(</span><span class=\"n\">subscriberPath</span><span class=\"p\">.</span><span class=\"n\">c_str</span><span class=\"p\">(),</span>\n  <span class=\"n\">partition</span><span class=\"p\">.</span><span class=\"n\">c_str</span><span class=\"p\">());</span>\n<span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">this_thread</span><span class=\"o\">::</span><span class=\"n\">sleep_for</span><span class=\"p\">(</span><span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">chrono</span><span class=\"o\">::</span><span class=\"n\">milliseconds</span><span class=\"p\">(</span><span class=\"n\">timeout</span><span class=\"p\">));</span>\n\n<span class=\"n\">EXPECT_FALSE</span><span class=\"p\">(</span><span class=\"n\">node2</span><span class=\"p\">.</span><span class=\"n\">WaitForSubscribers</span><span class=\"o\">&lt;</span><span class=\"n\">ignition</span><span class=\"o\">::</span><span class=\"n\">msgs</span><span class=\"o\">::</span><span class=\"n\">Vector3d</span><span class=\"o\">&gt;</span><span class=\"p\">(</span><span class=\"n\">g_topic</span><span class=\"p\">,</span>\n  <span class=\"n\">timeout</span><span class=\"p\">));</span>\n\n<span class=\"n\">testing</span><span class=\"o\">::</span><span class=\"n\">waitAndCleanupFork</span><span class=\"p\">(</span><span class=\"n\">pi</span><span class=\"p\">);</span>\n</pre></div>", "type": "rendered"}, "created_on": "2016-08-31T17:13:55.681760+00:00", "user": {"display_name": "Carlos Ag\u00fcero", "uuid": "{da8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D"}, "html": {"href": "https://bitbucket.org/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/692bf15758111acaddae4da15a47f9e5d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCA-0.png"}}, "nickname": "caguero", "type": "user", "account_id": "557058:4ded1ddf-947e-4154-bbd1-3dba24f1bdbd"}, "inline": {"to": null, "from": null, "outdated": true, "path": "src/NodeShared.cc"}, "updated_on": "2016-08-31T17:14:31.892932+00:00", "type": "pullrequest_comment", "id": 23114672}