{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/239/comments/53307126.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/239/_/diff#comment-53307126"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 239, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/239.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/239"}}, "title": "Use ign-cmake"}, "content": {"raw": "As of 816ccbb this branch should now be fully supported on Windows, compiled against Visual Studio 2017.\n\nAfter resolving the timeout issues, there was one last issue related to DLLs and ZeroMQ. Basically, if `ign-transport` is compiled as a DLL, then `NodeShared` will be destructed during the DLL teardown phase. It turns out that DLL teardown in Windows is a little chaotic, and we get some failed assertions from ZeroMQ while `NodeShared` is destructed. An easy solution is to just never destruct `NodeShared` on Windows. In the future we should consider investigating a cleaner solution, but this should get us by for now.\n\nI also needed to stretch out some of the wait times because it seems that Windows isn't as fast at multithreading as Linux.\n\nFinally, I needed to make this f111b9c tweak so that `BUILD_TESTING=OFF` would work properly.\n\nAt long last, I can give this pull request my approval. :joy: ", "markup": "markdown", "html": "<p>As of <a href=\"#!/ignitionrobotics/ign-transport/commits/816ccbb\" rel=\"nofollow\" class=\"ap-connect-link\">816ccbb</a> this branch should now be fully supported on Windows, compiled against Visual Studio 2017.</p>\n<p>After resolving the timeout issues, there was one last issue related to DLLs and ZeroMQ. Basically, if <code>ign-transport</code> is compiled as a DLL, then <code>NodeShared</code> will be destructed during the DLL teardown phase. It turns out that DLL teardown in Windows is a little chaotic, and we get some failed assertions from ZeroMQ while <code>NodeShared</code> is destructed. An easy solution is to just never destruct <code>NodeShared</code> on Windows. In the future we should consider investigating a cleaner solution, but this should get us by for now.</p>\n<p>I also needed to stretch out some of the wait times because it seems that Windows isn't as fast at multithreading as Linux.</p>\n<p>Finally, I needed to make this <a href=\"#!/ignitionrobotics/ign-transport/commits/f111b9c\" rel=\"nofollow\" class=\"ap-connect-link\">f111b9c</a> tweak so that <code>BUILD_TESTING=OFF</code> would work properly.</p>\n<p>At long last, I can give this pull request my approval. <img class=\"emoji\" src=\"data/pf-emoji-service--cdn.us-east-1.prod.public.atl-paas.net/standard/551c9814-1d37-4573-819d-afab3afeaf32/48x48/1f602.png\" alt=\"\ud83d\ude02\" title=\":joy:\" data-emoji-short-name=\":joy:\" /> </p>", "type": "rendered"}, "created_on": "2018-01-10T03:48:03.315681+00:00", "user": {"display_name": "Michael Grey", "uuid": "{c1cdfe52-2887-474c-ae99-72fdc53a59c9}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc1cdfe52-2887-474c-ae99-72fdc53a59c9%7D"}, "html": {"href": "https://bitbucket.org/%7Bc1cdfe52-2887-474c-ae99-72fdc53a59c9%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:67759e29-d1df-465f-868d-047738e36fc9/d42d74cf-c1bd-4431-8288-07f543bbe325/128"}}, "nickname": "mxgrey", "type": "user", "account_id": "557058:67759e29-d1df-465f-868d-047738e36fc9"}, "updated_on": "2018-01-10T03:48:03.318335+00:00", "type": "pullrequest_comment", "id": 53307126}