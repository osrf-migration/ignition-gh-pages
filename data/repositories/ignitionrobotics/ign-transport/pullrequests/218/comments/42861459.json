{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/218/comments/42861459.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/218/_/diff#comment-42861459"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 218, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/218.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/218"}}, "title": "C++14"}, "content": {"raw": "I just tried adding a c++14 call, and it fails to compile:\n\n~~~\ndiff -r 9a11cc5ecd00 src/Discovery_TEST.cc\n--- a/src/Discovery_TEST.cc\tTue Aug 15 11:58:47 2017 -0700\n+++ b/src/Discovery_TEST.cc\tTue Aug 15 12:17:27 2017 -0700\n@@ -391,7 +391,7 @@\n   reset();\n \n   // Create two discovery nodes.\n-  std::unique_ptr<MsgDiscovery> discovery1(new MsgDiscovery(pUuid1, g_msgPort));\n+  auto discovery1 = std::make_unique<MsgDiscovery>(pUuid1, g_msgPort);\n   MsgDiscovery discovery2(pUuid2, g_msgPort);\n \n   // Register one callback for receiving disconnect notifications.\n~~~\n\n~~~\n/home/scpeters/ws_old/ignition/src/ign-transport/src/Discovery_TEST.cc: In member function \u2018virtual void DiscoveryTest_TestNodeBye_Test::TestBody()\u2019:\n/home/scpeters/ws_old/ignition/src/ign-transport/src/Discovery_TEST.cc:394:21: error: \u2018make_unique\u2019 is not a member of \u2018std\u2019\n   auto discovery1 = std::make_unique<MsgDiscovery>(pUuid1, g_msgPort);\n                     ^\n/home/scpeters/ws_old/ignition/src/ign-transport/src/Discovery_TEST.cc:394:50: error: expected primary-expression before \u2018>\u2019 token\n   auto discovery1 = std::make_unique<MsgDiscovery>(pUuid1, g_msgPort);\n                                                  ^\nsrc/CMakeFiles/UNIT_Discovery_TEST.dir/build.make:62: recipe for target 'src/CMakeFiles/UNIT_Discovery_TEST.dir/Discovery_TEST.cc.o' failed\nmake[2]: *** [src/CMakeFiles/UNIT_Discovery_TEST.dir/Discovery_TEST.cc.o] Error 1\nCMakeFiles/Makefile2:418: recipe for target 'src/CMakeFiles/UNIT_Discovery_TEST.dir/all' failed\nmake[1]: *** [src/CMakeFiles/UNIT_Discovery_TEST.dir/all] Error 2\nmake[1]: *** Waiting for unfinished jobs....\n~~~\n\nI looked at all the compile flags and noticed that it is passing both `-std=c++11` and `-std=c++14`. It is maybe getting the `c++11` flag from ignition-math? Is it a race condition if it gets both flags?\n\n~~~\ncd /home/scpeters/ws_old/ignition/src/ign-transport/build/src && /usr/lib/ccache/c++    -I/home/scpeters/ws_old/ignition/src/ign-transport/test/gtest/include -I/home/scpeters/ws_old/ignition/src/ign-transport/include -I/home/scpeters/ws_old/ignition/src/ign-transport/build/include -I/home/scpeters/ws_old/ignition/src/ign-transport/build -I/home/scpeters/ws_old/ignition/src/ign-transport/build/test -I/usr/include/uuid -isystem /usr/include/ignition/msgs0 -isystem /usr/include/ignition/math3  -g -O2  -std=c++14 -fvisibility=hidden -Waddress -Warray-bounds -Wcomment -Wformat -Wnonnull -Wparentheses -Wreorder -Wreturn-type -Wsequence-point -Wsign-compare -Wstrict-aliasing -Wstrict-overflow=1 -Wswitch -Wtrigraphs -Wuninitialized -Wunused-function -Wunused-label -Wunused-value -Wunused-variable -Wvolatile-register-var -Wextra -Wno-long-long -Wno-unused-value -Wno-unused-value -Wno-unused-value -Wno-unused-value -Wfloat-equal -Wshadow -Winit-self -Wswitch-default -Wmissing-include-dirs -pedantic -Wno-pragmas -Wc++14-compat  -g -O2    -fPIC -std=c++11 -o CMakeFiles/UNIT_Discovery_TEST.dir/Discovery_TEST.cc.o -c /home/scpeters/ws_old/ignition/src/ign-transport/src/Discovery_TEST.cc\n\n~~~", "markup": "markdown", "html": "<p>I just tried adding a c++14 call, and it fails to compile:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 9a11cc5ecd00 src/Discovery_TEST.cc</span>\n<span class=\"gd\">--- a/src/Discovery_TEST.cc Tue Aug 15 11:58:47 2017 -0700</span>\n<span class=\"gi\">+++ b/src/Discovery_TEST.cc Tue Aug 15 12:17:27 2017 -0700</span>\n<span class=\"gu\">@@ -391,7 +391,7 @@</span>\n   reset();\n\n   // Create two discovery nodes.\n<span class=\"gd\">-  std::unique_ptr&lt;MsgDiscovery&gt; discovery1(new MsgDiscovery(pUuid1, g_msgPort));</span>\n<span class=\"gi\">+  auto discovery1 = std::make_unique&lt;MsgDiscovery&gt;(pUuid1, g_msgPort);</span>\n   MsgDiscovery discovery2(pUuid2, g_msgPort);\n\n   // Register one callback for receiving disconnect notifications.\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span><span class=\"o\">/</span><span class=\"nt\">home</span><span class=\"o\">/</span><span class=\"nt\">scpeters</span><span class=\"o\">/</span><span class=\"nt\">ws_old</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">ign-transport</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">Discovery_TEST</span><span class=\"p\">.</span><span class=\"nc\">cc</span><span class=\"o\">:</span> <span class=\"nt\">In</span> <span class=\"nt\">member</span> <span class=\"nt\">function</span> <span class=\"err\">\u2018</span><span class=\"nt\">virtual</span> <span class=\"nt\">void</span> <span class=\"nt\">DiscoveryTest_TestNodeBye_Test</span><span class=\"p\">::</span><span class=\"nd\">TestBody</span><span class=\"o\">()</span><span class=\"err\">\u2019</span><span class=\"o\">:</span>\n<span class=\"o\">/</span><span class=\"nt\">home</span><span class=\"o\">/</span><span class=\"nt\">scpeters</span><span class=\"o\">/</span><span class=\"nt\">ws_old</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">ign-transport</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">Discovery_TEST</span><span class=\"p\">.</span><span class=\"nc\">cc</span><span class=\"p\">:</span><span class=\"nd\">394</span><span class=\"p\">:</span><span class=\"nd\">21</span><span class=\"o\">:</span> <span class=\"nt\">error</span><span class=\"o\">:</span> <span class=\"err\">\u2018</span><span class=\"nt\">make_unique</span><span class=\"err\">\u2019</span> <span class=\"nt\">is</span> <span class=\"nt\">not</span> <span class=\"nt\">a</span> <span class=\"nt\">member</span> <span class=\"nt\">of</span> <span class=\"err\">\u2018</span><span class=\"nt\">std</span><span class=\"err\">\u2019</span>\n   <span class=\"nt\">auto</span> <span class=\"nt\">discovery1</span> <span class=\"o\">=</span> <span class=\"nt\">std</span><span class=\"p\">::</span><span class=\"nd\">make_unique</span><span class=\"o\">&lt;</span><span class=\"nt\">MsgDiscovery</span><span class=\"o\">&gt;(</span><span class=\"nt\">pUuid1</span><span class=\"o\">,</span> <span class=\"nt\">g_msgPort</span><span class=\"o\">);</span>\n                     <span class=\"o\">^</span>\n<span class=\"o\">/</span><span class=\"nt\">home</span><span class=\"o\">/</span><span class=\"nt\">scpeters</span><span class=\"o\">/</span><span class=\"nt\">ws_old</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">ign-transport</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">Discovery_TEST</span><span class=\"p\">.</span><span class=\"nc\">cc</span><span class=\"p\">:</span><span class=\"nd\">394</span><span class=\"p\">:</span><span class=\"nd\">50</span><span class=\"o\">:</span> <span class=\"nt\">error</span><span class=\"o\">:</span> <span class=\"nt\">expected</span> <span class=\"nt\">primary-expression</span> <span class=\"nt\">before</span> <span class=\"err\">\u2018</span><span class=\"o\">&gt;</span><span class=\"err\">\u2019</span> <span class=\"nt\">token</span>\n   <span class=\"nt\">auto</span> <span class=\"nt\">discovery1</span> <span class=\"o\">=</span> <span class=\"nt\">std</span><span class=\"p\">::</span><span class=\"nd\">make_unique</span><span class=\"o\">&lt;</span><span class=\"nt\">MsgDiscovery</span><span class=\"o\">&gt;(</span><span class=\"nt\">pUuid1</span><span class=\"o\">,</span> <span class=\"nt\">g_msgPort</span><span class=\"o\">);</span>\n                                                  <span class=\"o\">^</span>\n<span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">CMakeFiles</span><span class=\"o\">/</span><span class=\"nt\">UNIT_Discovery_TEST</span><span class=\"p\">.</span><span class=\"nc\">dir</span><span class=\"o\">/</span><span class=\"nt\">build</span><span class=\"p\">.</span><span class=\"nc\">make</span><span class=\"p\">:</span><span class=\"nd\">62</span><span class=\"o\">:</span> <span class=\"nt\">recipe</span> <span class=\"nt\">for</span> <span class=\"nt\">target</span> <span class=\"s1\">&#39;src/CMakeFiles/UNIT_Discovery_TEST.dir/Discovery_TEST.cc.o&#39;</span> <span class=\"nt\">failed</span>\n<span class=\"nt\">make</span><span class=\"cp\">[</span><span class=\"mi\">2</span><span class=\"cp\">]</span><span class=\"o\">:</span> <span class=\"o\">***</span> <span class=\"cp\">[</span><span class=\"nx\">src</span><span class=\"p\">/</span><span class=\"nx\">CMakeFiles</span><span class=\"p\">/</span><span class=\"nx\">UNIT_Discovery_TEST.dir</span><span class=\"p\">/</span><span class=\"nx\">Discovery_TEST.cc.o</span><span class=\"cp\">]</span> <span class=\"nt\">Error</span> <span class=\"nt\">1</span>\n<span class=\"nt\">CMakeFiles</span><span class=\"o\">/</span><span class=\"nt\">Makefile2</span><span class=\"p\">:</span><span class=\"nd\">418</span><span class=\"o\">:</span> <span class=\"nt\">recipe</span> <span class=\"nt\">for</span> <span class=\"nt\">target</span> <span class=\"s1\">&#39;src/CMakeFiles/UNIT_Discovery_TEST.dir/all&#39;</span> <span class=\"nt\">failed</span>\n<span class=\"nt\">make</span><span class=\"cp\">[</span><span class=\"mi\">1</span><span class=\"cp\">]</span><span class=\"o\">:</span> <span class=\"o\">***</span> <span class=\"cp\">[</span><span class=\"nx\">src</span><span class=\"p\">/</span><span class=\"nx\">CMakeFiles</span><span class=\"p\">/</span><span class=\"nx\">UNIT_Discovery_TEST.dir</span><span class=\"p\">/</span><span class=\"nb\">all</span><span class=\"cp\">]</span> <span class=\"nt\">Error</span> <span class=\"nt\">2</span>\n<span class=\"nt\">make</span><span class=\"cp\">[</span><span class=\"mi\">1</span><span class=\"cp\">]</span><span class=\"o\">:</span> <span class=\"o\">***</span> <span class=\"nt\">Waiting</span> <span class=\"nt\">for</span> <span class=\"nt\">unfinished</span> <span class=\"nt\">jobs</span><span class=\"o\">....</span>\n</pre></div>\n\n\n<p>I looked at all the compile flags and noticed that it is passing both <code>-std=c++11</code> and <code>-std=c++14</code>. It is maybe getting the <code>c++11</code> flag from ignition-math? Is it a race condition if it gets both flags?</p>\n<div class=\"codehilite\"><pre><span></span>cd /home/scpeters/ws_old/ignition/src/ign-transport/build/src &amp;&amp; /usr/lib/ccache/c++    -I/home/scpeters/ws_old/ignition/src/ign-transport/test/gtest/include -I/home/scpeters/ws_old/ignition/src/ign-transport/include -I/home/scpeters/ws_old/ignition/src/ign-transport/build/include -I/home/scpeters/ws_old/ignition/src/ign-transport/build -I/home/scpeters/ws_old/ignition/src/ign-transport/build/test -I/usr/include/uuid -isystem /usr/include/ignition/msgs0 -isystem /usr/include/ignition/math3  -g -O2  -std=c++14 -fvisibility=hidden -Waddress -Warray-bounds -Wcomment -Wformat -Wnonnull -Wparentheses -Wreorder -Wreturn-type -Wsequence-point -Wsign-compare -Wstrict-aliasing -Wstrict-overflow=1 -Wswitch -Wtrigraphs -Wuninitialized -Wunused-function -Wunused-label -Wunused-value -Wunused-variable -Wvolatile-register-var -Wextra -Wno-long-long -Wno-unused-value -Wno-unused-value -Wno-unused-value -Wno-unused-value -Wfloat-equal -Wshadow -Winit-self -Wswitch-default -Wmissing-include-dirs -pedantic -Wno-pragmas -Wc++14-compat  -g -O2    -fPIC -std=c++11 -o CMakeFiles/UNIT_Discovery_TEST.dir/Discovery_TEST.cc.o -c /home/scpeters/ws_old/ignition/src/ign-transport/src/Discovery_TEST.cc\n</pre></div>", "type": "rendered"}, "created_on": "2017-08-15T19:19:25.840421+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2017-08-15T19:19:25.842902+00:00", "type": "pullrequest_comment", "id": 42861459}