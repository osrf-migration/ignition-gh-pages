{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131271866.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131271866"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "This comment could not be backed up from BitBucket, so this dummy comment was inserted in it's place.", "markup": "markdown", "html": "<p>This comment could not be backed up from BitBucket, so this dummy comment was inserted in it's place.</p>", "type": "rendered"}, "created_on": "1970-01-01T00:00:00.000000+00:00", "user": {"display_name": "Unknown User", "uuid": "{00000000-0000-0000-0000-000000000000}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B00000000-0000-0000-0000-000000000000%7D"}, "html": {"href": "https://bitbucket.org/%7B00000000-0000-0000-0000-000000000000%7D/"}, "avatar": {"href": "data/missing_avatar.png"}}, "nickname": "unknownuser", "type": "user", "account_id": "000000:00000000-0000-0000-0000-000000000000"}, "updated_on": "1970-01-01T00:00:00.000000+00:00", "type": "pullrequest_comment", "id": 131271866}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131275460.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131275460"}}, "parent": {"id": 131271866, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131271866.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131271866"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "Under extreme disk loads, that\u2019s going to happen with `rosbag`, and there\u2019s not a really great software workaround for it.  Ultimately, it comes down to what resource you have more available of.  If you are maxing out disk IO, but have memory to spare, then increasing the `rosbag` queue depths works \\(though it may just mean that you go longer before dropping messages\\).  If you are maxing out disk IO, but have CPU to spare, then compression is a good approach.\n\nThis definitely manifests if you are trying to record too many high-bandwidth sensor with insufficient disk I/O.\n\nThanks for doing these tests and reporting the results!", "markup": "markdown", "html": "<p>Under extreme disk loads, that\u2019s going to happen with <code>rosbag</code>, and there\u2019s not a really great software workaround for it.  Ultimately, it comes down to what resource you have more available of.  If you are maxing out disk IO, but have memory to spare, then increasing the <code>rosbag</code> queue depths works (though it may just mean that you go longer before dropping messages).  If you are maxing out disk IO, but have CPU to spare, then compression is a good approach.</p>\n<p>This definitely manifests if you are trying to record too many high-bandwidth sensor with insufficient disk I/O.</p>\n<p>Thanks for doing these tests and reporting the results!</p>", "type": "rendered"}, "created_on": "2020-01-11T00:29:54.594857+00:00", "user": {"display_name": "Michael Carroll", "uuid": "{17dbbc15-cbc0-42f0-a985-cde9061c78a0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D"}, "html": {"href": "https://bitbucket.org/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:65740f22-cc56-4418-9608-7e17d0ed47b7/2aa259f5-4de1-4f68-9156-eded72041d84/128"}}, "nickname": "Michael Carroll", "type": "user", "account_id": "557058:65740f22-cc56-4418-9608-7e17d0ed47b7"}, "updated_on": "2020-01-11T00:29:54.604767+00:00", "type": "pullrequest_comment", "id": 131275460}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130611380.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130611380"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "Can you add a changelog?", "markup": "markdown", "html": "<p>Can you add a changelog?</p>", "type": "rendered"}, "created_on": "2020-01-06T22:17:51.694414+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "updated_on": "2020-01-06T22:17:51.700530+00:00", "type": "pullrequest_comment", "id": 130611380}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130612239.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130612239"}}, "parent": {"id": 130611380, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130611380.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130611380"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "Done 10cc86b", "markup": "markdown", "html": "<p>Done <a href=\"#!/ignitionrobotics/ign-transport/commits/10cc86b\" rel=\"nofollow\" class=\"ap-connect-link\">10cc86b</a></p>", "type": "rendered"}, "created_on": "2020-01-06T22:27:53.544794+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2020-01-06T22:27:53.552747+00:00", "type": "pullrequest_comment", "id": 130612239}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130611906.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/diff/ignitionrobotics/ign-transport:f0642cc2209f..2a2f6f3c0c78?path=log%2Fsrc%2FRecorder.cc"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130611906"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "What do you think about changing from overwrite to forcing a write to disk when the queue becomes full? This would guarantee data is not lost.", "markup": "markdown", "html": "<p>What do you think about changing from overwrite to forcing a write to disk when the queue becomes full? This would guarantee data is not lost.</p>", "type": "rendered"}, "created_on": "2020-01-06T22:24:06.304947+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "inline": {"to": 119, "from": null, "path": "log/src/Recorder.cc"}, "updated_on": "2020-01-06T22:24:06.311281+00:00", "type": "pullrequest_comment", "id": 130611906}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130612821.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/diff/ignitionrobotics/ign-transport:10cc86bb04dd..2a2f6f3c0c78?path=log%2Fsrc%2FRecorder.cc"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130612821"}}, "parent": {"id": 130611906, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130611906.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130611906"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "I guess it depends on the use case. Forcing a disk write can cause topics to go out of sync with simulation causing a whole host of issues. Ideally, this \"forcing\" would be done from the user end (eg. ign-gazebo) so simulation is blocked from stepping while writing to disk. I'm not sure how we can accomplish that with the current design though. ", "markup": "markdown", "html": "<p>I guess it depends on the use case. Forcing a disk write can cause topics to go out of sync with simulation causing a whole host of issues. Ideally, this \"forcing\" would be done from the user end (eg. ign-gazebo) so simulation is blocked from stepping while writing to disk. I'm not sure how we can accomplish that with the current design though. </p>", "type": "rendered"}, "created_on": "2020-01-06T22:34:52.902822+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "inline": {"to": null, "from": null, "path": "log/src/Recorder.cc"}, "updated_on": "2020-01-06T22:34:52.908821+00:00", "type": "pullrequest_comment", "id": 130612821}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130613349.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/diff/ignitionrobotics/ign-transport:10cc86bb04dd..2a2f6f3c0c78?path=log%2Fsrc%2FRecorder.cc"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130613349"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "You might want to move `this->dataWriterState = true;` to just before the `while` loop in `Recorder::Implementation::DataWriterThread()`. That way the state is changed when the thread starts.", "markup": "markdown", "html": "<p>You might want to move <code>this-&gt;dataWriterState = true;</code> to just before the <code>while</code> loop in <code>Recorder::Implementation::DataWriterThread()</code>. That way the state is changed when the thread starts.</p>", "type": "rendered"}, "created_on": "2020-01-06T22:41:16.015848+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "inline": {"to": 212, "from": null, "path": "log/src/Recorder.cc"}, "updated_on": "2020-01-06T22:41:16.023230+00:00", "type": "pullrequest_comment", "id": 130613349}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130613859.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/diff/ignitionrobotics/ign-transport:76968ef2c341..2a2f6f3c0c78?path=log%2Fsrc%2FRecorder.cc"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130613859"}}, "parent": {"id": 130613349, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130613349.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130613349"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "Good point. 76968ef", "markup": "markdown", "html": "<p>Good point. <a href=\"#!/ignitionrobotics/ign-transport/commits/76968ef\" rel=\"nofollow\" class=\"ap-connect-link\">76968ef</a></p>", "type": "rendered"}, "created_on": "2020-01-06T22:46:57.991557+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "inline": {"to": 212, "from": null, "path": "log/src/Recorder.cc"}, "updated_on": "2020-01-06T22:46:57.998789+00:00", "type": "pullrequest_comment", "id": 130613859}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130616726.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/diff/ignitionrobotics/ign-transport:76968ef2c341..2a2f6f3c0c78?path=log%2Fsrc%2FRecorder.cc"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130616726"}}, "parent": {"id": 130613859, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130613859.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130613859"}}, "depth": 2}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "I'm going to have to revert this one because it leads to a race condition if a `log::Recorder` object is created and destroyed immediately. This is causing a test failure on pipelines. As the [documentation](#!/ignitionrobotics/ign-transport/pull-requests/428/write-to-disk-from-a-background-thread-in/diff?w=1#Llog/src/Recorder.ccT135) states, the flag is meant to indicate that the thread is starting or has started, so it's okay for it to be true before the thread has actually started.", "markup": "markdown", "html": "<p>I'm going to have to revert this one because it leads to a race condition if a <code>log::Recorder</code> object is created and destroyed immediately. This is causing a test failure on pipelines. As the <a data-is-external-link=\"true\" href=\"#!/ignitionrobotics/ign-transport/pull-requests/428/write-to-disk-from-a-background-thread-in/diff?w=1#Llog/src/Recorder.ccT135\" rel=\"nofollow\">documentation</a> states, the flag is meant to indicate that the thread is starting or has started, so it's okay for it to be true before the thread has actually started.</p>", "type": "rendered"}, "created_on": "2020-01-06T23:28:55.167514+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "inline": {"to": 212, "from": null, "path": "log/src/Recorder.cc"}, "updated_on": "2020-01-06T23:28:55.174605+00:00", "type": "pullrequest_comment", "id": 130616726}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130616978.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/diff/ignitionrobotics/ign-transport:76968ef2c341..2a2f6f3c0c78?path=log%2Fsrc%2FRecorder.cc"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130616978"}}, "parent": {"id": 130616726, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130616726.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130616726"}}, "depth": 3}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "sounds good.", "markup": "markdown", "html": "<p>sounds good.</p>", "type": "rendered"}, "created_on": "2020-01-06T23:33:23.068548+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "inline": {"to": 212, "from": null, "path": "log/src/Recorder.cc"}, "updated_on": "2020-01-06T23:33:23.074757+00:00", "type": "pullrequest_comment", "id": 130616978}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130613952.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/diff/ignitionrobotics/ign-transport:76968ef2c341..2a2f6f3c0c78?path=log%2Fsrc%2FRecorder.cc"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130613952"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "Is the time written into the log file suppose to be the time when the message was received or when the message was written to disk? If it's the former, then I think you need to store the time in the queue.", "markup": "markdown", "html": "<p>Is the time written into the log file suppose to be the time when the message was received or when the message was written to disk? If it's the former, then I think you need to store the time in the queue.</p>", "type": "rendered"}, "created_on": "2020-01-06T22:48:00.388569+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "inline": {"to": 200, "from": null, "path": "log/src/Recorder.cc"}, "updated_on": "2020-01-06T22:48:00.399414+00:00", "type": "pullrequest_comment", "id": 130613952}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130618982.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/diff/ignitionrobotics/ign-transport:6556b7a1cce8..2a2f6f3c0c78?path=log%2Fsrc%2FRecorder.cc"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130618982"}}, "parent": {"id": 130613952, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130613952.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130613952"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "Thanks for catching this. It is supposed to be recording when the message was received. I added a failing test in ccf4e3e and the fix in 6556b7a.", "markup": "markdown", "html": "<p>Thanks for catching this. It is supposed to be recording when the message was received. I added a failing test in <a href=\"#!/ignitionrobotics/ign-transport/commits/ccf4e3e\" rel=\"nofollow\" class=\"ap-connect-link\">ccf4e3e</a> and the fix in <a href=\"#!/ignitionrobotics/ign-transport/commits/6556b7a\" rel=\"nofollow\" class=\"ap-connect-link\">6556b7a</a>.</p>", "type": "rendered"}, "created_on": "2020-01-07T00:07:45.487510+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "inline": {"to": 200, "from": null, "path": "log/src/Recorder.cc"}, "updated_on": "2020-01-07T00:07:45.494386+00:00", "type": "pullrequest_comment", "id": 130618982}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130614527.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/diff/ignitionrobotics/ign-transport:76968ef2c341..2a2f6f3c0c78?path=log%2Fsrc%2FRecorder.cc"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130614527"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "How did you derive the default value of 10? ", "markup": "markdown", "html": "<p>How did you derive the default value of 10? </p>", "type": "rendered"}, "created_on": "2020-01-06T22:54:53.816417+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "inline": {"to": 114, "from": null, "path": "log/src/Recorder.cc"}, "updated_on": "2020-01-06T22:54:53.822342+00:00", "type": "pullrequest_comment", "id": 130614527}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130620328.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/diff/ignitionrobotics/ign-transport:6556b7a1cce8..2a2f6f3c0c78?path=log%2Fsrc%2FRecorder.cc"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130620328"}}, "parent": {"id": 130614527, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130614527.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130614527"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "This is a good question. To be honest, I just picked a default value I've seen used elsewhere for queues. I didn't have a good way to come up with a good default. I thought about scaling `maxQueueSize` with the number of subscribed topics, but that wouldn't address the issue of some topics being published faster than others and having a queue per topic seemed too complicated.", "markup": "markdown", "html": "<p>This is a good question. To be honest, I just picked a default value I've seen used elsewhere for queues. I didn't have a good way to come up with a good default. I thought about scaling <code>maxQueueSize</code> with the number of subscribed topics, but that wouldn't address the issue of some topics being published faster than others and having a queue per topic seemed too complicated.</p>", "type": "rendered"}, "created_on": "2020-01-07T00:34:20.749554+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "inline": {"to": 114, "from": null, "path": "log/src/Recorder.cc"}, "updated_on": "2020-01-07T00:34:20.756913+00:00", "type": "pullrequest_comment", "id": 130620328}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130728909.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130728909"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "I'm a bit concerned about the max queue size, picking a good value for the queue size, and the possibility of loosing data.\n\nHow about we take some lessons from [rosbag](http://wiki.ros.org/rosbag/Commandline), which specifies a queue based on MB or zero for infinite queue. Rosbag also writes in chunks, not at every message. Both of these strategies might be beneficial here.\n\nI think the byte size queue limit, or zero for an infinite queue, would be pretty straight forward to implement.\n\nA chunk size could also be specified. When the queue is larger than the chunk size, then the conditional is triggered. \n\nWhat do you think?", "markup": "markdown", "html": "<p>I'm a bit concerned about the max queue size, picking a good value for the queue size, and the possibility of loosing data.</p>\n<p>How about we take some lessons from <a data-is-external-link=\"true\" href=\"http://wiki.ros.org/rosbag/Commandline\" rel=\"nofollow\">rosbag</a>, which specifies a queue based on MB or zero for infinite queue. Rosbag also writes in chunks, not at every message. Both of these strategies might be beneficial here.</p>\n<p>I think the byte size queue limit, or zero for an infinite queue, would be pretty straight forward to implement.</p>\n<p>A chunk size could also be specified. When the queue is larger than the chunk size, then the conditional is triggered. </p>\n<p>What do you think?</p>", "type": "rendered"}, "created_on": "2020-01-07T16:42:09.979298+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "updated_on": "2020-01-07T16:42:09.986536+00:00", "type": "pullrequest_comment", "id": 130728909}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130730322.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130730322"}}, "parent": {"id": 130728909, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130728909.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130728909"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "I'm also concerned with a queue size of 10 and the potential for competitors noting dropped messages on CloudSim/locally again.  I'm working on configuring some tests to figure out how often that queue limit is exceeded and messages are dropped.", "markup": "markdown", "html": "<p>I'm also concerned with a queue size of 10 and the potential for competitors noting dropped messages on CloudSim/locally again.  I'm working on configuring some tests to figure out how often that queue limit is exceeded and messages are dropped.</p>", "type": "rendered"}, "created_on": "2020-01-07T16:51:06.732397+00:00", "user": {"display_name": "Arthur Schang", "uuid": "{1403972a-9b64-442b-a69c-d7e9557e1d87}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B1403972a-9b64-442b-a69c-d7e9557e1d87%7D"}, "html": {"href": "https://bitbucket.org/%7B1403972a-9b64-442b-a69c-d7e9557e1d87%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/initials/AS-0.png"}}, "nickname": "Arthur Schang", "type": "user", "account_id": "557058:14b7fd50-d65a-47a8-825c-fa89681d07bd"}, "updated_on": "2020-01-07T16:51:06.920254+00:00", "type": "pullrequest_comment", "id": 130730322}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130753423.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130753423"}}, "parent": {"id": 130728909, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130728909.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130728909"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "Yes, it is definitely a valid concern, but isn't it up  to the application to set the correct queue size. For SubT, we can set a very large queue size in ign-gazebo. That being said, a good default is always desirable.\n\n> How about we take some lessons from rosbag, which specifies a queue based on MB or zero for infinite queue. Rosbag also writes in chunks, not at every message. Both of these strategies might be beneficial here.\n\nI like these ideas. I'll start working on them. I don't know if writing in chunks will improve performance though since each message is inserted into the database individually. If there is a way to do a bulk database update, that would be great.\n\nAnother idea is to put the log recorder in its own process. If we did that, it won't block other subscribers, but we would pay the cost of serialization and hitting the network. Is that something we should consider?\n\n", "markup": "markdown", "html": "<p>Yes, it is definitely a valid concern, but isn't it up  to the application to set the correct queue size. For SubT, we can set a very large queue size in ign-gazebo. That being said, a good default is always desirable.</p>\n<blockquote>\n<p>How about we take some lessons from rosbag, which specifies a queue based on MB or zero for infinite queue. Rosbag also writes in chunks, not at every message. Both of these strategies might be beneficial here.</p>\n</blockquote>\n<p>I like these ideas. I'll start working on them. I don't know if writing in chunks will improve performance though since each message is inserted into the database individually. If there is a way to do a bulk database update, that would be great.</p>\n<p>Another idea is to put the log recorder in its own process. If we did that, it won't block other subscribers, but we would pay the cost of serialization and hitting the network. Is that something we should consider?</p>", "type": "rendered"}, "created_on": "2020-01-07T20:10:07.946334+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2020-01-07T20:10:07.955139+00:00", "type": "pullrequest_comment", "id": 130753423}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130754334.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130754334"}}, "parent": {"id": 130753423, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130753423.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130753423"}}, "depth": 2}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "The separate process is good idea, but I think this change would deserve more careful planning. How about we scope this to subt's immediate needs, and push the extra stuff to a later time. So, I propose that this PR be modified to allow for an infinite queue size when the max queue size is zero, and set the default queue size to 1000. The 1000 value comes from zeromq, where is was the default buffer size. \n\nWe can save chunking for later. As you mentioned, it would be nice to measure or know if this is actually beneficial.\n\nAlso save the separate process work for later.\n\nIf that sounds good to you, then can you please create issues for chunking and the separate process?", "markup": "markdown", "html": "<p>The separate process is good idea, but I think this change would deserve more careful planning. How about we scope this to subt's immediate needs, and push the extra stuff to a later time. So, I propose that this PR be modified to allow for an infinite queue size when the max queue size is zero, and set the default queue size to 1000. The 1000 value comes from zeromq, where is was the default buffer size. </p>\n<p>We can save chunking for later. As you mentioned, it would be nice to measure or know if this is actually beneficial.</p>\n<p>Also save the separate process work for later.</p>\n<p>If that sounds good to you, then can you please create issues for chunking and the separate process?</p>", "type": "rendered"}, "created_on": "2020-01-07T20:18:36.135822+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "updated_on": "2020-01-07T20:18:36.143460+00:00", "type": "pullrequest_comment", "id": 130754334}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130758379.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130758379"}}, "parent": {"id": 130754334, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130754334.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130754334"}}, "depth": 3}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "Sounds good!", "markup": "markdown", "html": "<p>Sounds good!</p>", "type": "rendered"}, "created_on": "2020-01-07T20:56:43.082498+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2020-01-07T20:56:43.094356+00:00", "type": "pullrequest_comment", "id": 130758379}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131080011.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131080011"}}, "parent": {"id": 130758379, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130758379.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130758379"}}, "depth": 4}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "I have made the change to specify the buffer size in MB in dce0319. I assumed you said the default size was 1000 MB, not 1000 bytes.\n\nIt also occurred to me that any data remaining in the queue when `Stop` is closed or the `Recorder` object is destroyed may not get written to the log file. In b808836, I changed it so that `Stop` flushes the remaining data to the log file. One caveat here is that now `Recorder::Stop` (and, as a result, `Recorder::~Recorder`) are blocking functions. I think that's acceptable, but I'd like to hear your opinion. \n\nFinally, I found that `transport::Log` doesn't properly end transactions it started when `transport::Log::~Log` is called, which means the last few messages inserted into the log file using `transport::Log::InsertMessage` may not get written to the database. In b808836, I changed it so that it ends the transaction when the destructor is called. I think this fixes the flaky test `INTEGRATION_log_system` in ign-gazebo.", "markup": "markdown", "html": "<p>I have made the change to specify the buffer size in MB in <a href=\"#!/ignitionrobotics/ign-transport/commits/dce0319\" rel=\"nofollow\" class=\"ap-connect-link\">dce0319</a>. I assumed you said the default size was 1000 MB, not 1000 bytes.</p>\n<p>It also occurred to me that any data remaining in the queue when <code>Stop</code> is closed or the <code>Recorder</code> object is destroyed may not get written to the log file. In <a href=\"#!/ignitionrobotics/ign-transport/commits/b808836\" rel=\"nofollow\" class=\"ap-connect-link\">b808836</a>, I changed it so that <code>Stop</code> flushes the remaining data to the log file. One caveat here is that now <code>Recorder::Stop</code> (and, as a result, <code>Recorder::~Recorder</code>) are blocking functions. I think that's acceptable, but I'd like to hear your opinion. </p>\n<p>Finally, I found that <code>transport::Log</code> doesn't properly end transactions it started when <code>transport::Log::~Log</code> is called, which means the last few messages inserted into the log file using <code>transport::Log::InsertMessage</code> may not get written to the database. In <a href=\"#!/ignitionrobotics/ign-transport/commits/b808836\" rel=\"nofollow\" class=\"ap-connect-link\">b808836</a>, I changed it so that it ends the transaction when the destructor is called. I think this fixes the flaky test <code>INTEGRATION_log_system</code> in ign-gazebo.</p>", "type": "rendered"}, "created_on": "2020-01-09T17:44:33.967733+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2020-01-09T17:44:33.978369+00:00", "type": "pullrequest_comment", "id": 131080011}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131081486.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131081486"}}, "parent": {"id": 131080011, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131080011.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131080011"}}, "depth": 5}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "Thanks. This looks great. I agree that blocking on Stop and the Recorder destructor is a good idea.", "markup": "markdown", "html": "<p>Thanks. This looks great. I agree that blocking on Stop and the Recorder destructor is a good idea.</p>", "type": "rendered"}, "created_on": "2020-01-09T17:56:18.041406+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "updated_on": "2020-01-09T17:56:18.049676+00:00", "type": "pullrequest_comment", "id": 131081486}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131130757.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131130757"}}, "parent": {"id": 131080011, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131080011.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131080011"}}, "depth": 5}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "My only comment on the blocking is that it should probably include a message to console indicating that is what it is doing.  If the flush could take a bit to write everything down to disk, it could be interpreted as the program hanging on shutdown.", "markup": "markdown", "html": "<p>My only comment on the blocking is that it should probably include a message to console indicating that is what it is doing.  If the flush could take a bit to write everything down to disk, it could be interpreted as the program hanging on shutdown.</p>", "type": "rendered"}, "created_on": "2020-01-10T04:23:07.987631+00:00", "user": {"display_name": "Michael Carroll", "uuid": "{17dbbc15-cbc0-42f0-a985-cde9061c78a0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D"}, "html": {"href": "https://bitbucket.org/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:65740f22-cc56-4418-9608-7e17d0ed47b7/2aa259f5-4de1-4f68-9156-eded72041d84/128"}}, "nickname": "Michael Carroll", "type": "user", "account_id": "557058:65740f22-cc56-4418-9608-7e17d0ed47b7"}, "updated_on": "2020-01-10T04:23:07.995157+00:00", "type": "pullrequest_comment", "id": 131130757}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131235624.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131235624"}}, "parent": {"id": 131130757, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131130757.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131130757"}}, "depth": 6}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "This is a good idea, but since ign-transport doesn't depend on ign-common, I don't have a nice way of printing a console message based on a flag. I was thinking of using `LMSG` for the time being and creating an issue to make an API for setting `transport::log::__verbosity` from ign-gazebo. Thoughts?", "markup": "markdown", "html": "<p>This is a good idea, but since ign-transport doesn't depend on ign-common, I don't have a nice way of printing a console message based on a flag. I was thinking of using <code>LMSG</code> for the time being and creating an issue to make an API for setting <code>transport::log::__verbosity</code> from ign-gazebo. Thoughts?</p>", "type": "rendered"}, "created_on": "2020-01-10T16:36:04.424699+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2020-01-10T16:36:04.436848+00:00", "type": "pullrequest_comment", "id": 131235624}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131237986.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131237986"}}, "parent": {"id": 131235624, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131235624.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131235624"}}, "depth": 7}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "Ah, I didn\u2019t realize that.  I don\u2019t think that we should introduce that dependency without a major revision bump.\n\nI think that\u2019s a reasonable approach for now.", "markup": "markdown", "html": "<p>Ah, I didn\u2019t realize that.  I don\u2019t think that we should introduce that dependency without a major revision bump.</p>\n<p>I think that\u2019s a reasonable approach for now.</p>", "type": "rendered"}, "created_on": "2020-01-10T16:51:24.474894+00:00", "user": {"display_name": "Michael Carroll", "uuid": "{17dbbc15-cbc0-42f0-a985-cde9061c78a0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D"}, "html": {"href": "https://bitbucket.org/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:65740f22-cc56-4418-9608-7e17d0ed47b7/2aa259f5-4de1-4f68-9156-eded72041d84/128"}}, "nickname": "Michael Carroll", "type": "user", "account_id": "557058:65740f22-cc56-4418-9608-7e17d0ed47b7"}, "updated_on": "2020-01-10T16:51:24.482527+00:00", "type": "pullrequest_comment", "id": 131237986}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131082297.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131082297"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "This looks good. I'm going to try this out on cloudsim before approving.", "markup": "markdown", "html": "<p>This looks good. I'm going to try this out on cloudsim before approving.</p>", "type": "rendered"}, "created_on": "2020-01-09T18:03:15.454151+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "updated_on": "2020-01-09T18:03:15.462453+00:00", "type": "pullrequest_comment", "id": 131082297}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131108984.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131108984"}}, "parent": {"id": 131082297, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131082297.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131082297"}}, "depth": 1}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "FYI: the prerelease failed to build on homebrew with high sierra due to the use of `std::optional`, so I've restricted the formula to mojave and greater:\n\n* https://github.com/osrf/homebrew-simulation/pull/946/commits/2a7ac7943a5010af653ecba66e24b72aeec49236", "markup": "markdown", "html": "<p>FYI: the prerelease failed to build on homebrew with high sierra due to the use of <code>std::optional</code>, so I've restricted the formula to mojave and greater:</p>\n<ul>\n<li><a href=\"https://github.com/osrf/homebrew-simulation/pull/946/commits/2a7ac7943a5010af653ecba66e24b72aeec49236\" rel=\"nofollow\" class=\"ap-connect-link\">https://github.com/osrf/homebrew-simulation/pull/946/commits/2a7ac7943a5010af653ecba66e24b72aeec49236</a></li>\n</ul>", "type": "rendered"}, "created_on": "2020-01-09T21:55:18.144507+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2020-01-09T21:55:18.192109+00:00", "type": "pullrequest_comment", "id": 131108984}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131110221.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131110221"}}, "parent": {"id": 131108984, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131108984.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131108984"}}, "depth": 2}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "actually, the windows build failed too, so I've added `#include <optional>` to `recorder.cc`", "markup": "markdown", "html": "<p>actually, the windows build failed too, so I've added <code>#include &lt;optional&gt;</code> to <code>recorder.cc</code></p>", "type": "rendered"}, "created_on": "2020-01-09T22:09:25.431333+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": "2020-01-09T22:09:25.440798+00:00", "type": "pullrequest_comment", "id": 131110221}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131110277.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131110277"}}, "parent": {"id": 131110221, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131110221.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131110221"}}, "depth": 3}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "Thanks!", "markup": "markdown", "html": "<p>Thanks!</p>", "type": "rendered"}, "created_on": "2020-01-09T22:10:04.780997+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2020-01-09T22:10:04.787399+00:00", "type": "pullrequest_comment", "id": 131110277}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131244836.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131244836"}}, "parent": {"id": 131110277, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131110277.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131110277"}}, "depth": 4}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "Also added `#include <numeric>` for `std::iota`", "markup": "markdown", "html": "<p>Also added <code>#include &lt;numeric&gt;</code> for <code>std::iota</code></p>", "type": "rendered"}, "created_on": "2020-01-10T17:50:49.948400+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2020-01-10T17:50:49.956670+00:00", "type": "pullrequest_comment", "id": 131244836}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131247395.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131247395"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "CI looks good. I'm merging in a few minutes.", "markup": "markdown", "html": "<p>CI looks good. I'm merging in a few minutes.</p>", "type": "rendered"}, "created_on": "2020-01-10T18:15:09.186930+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2020-01-10T18:15:09.198325+00:00", "type": "pullrequest_comment", "id": 131247395}], "page": 1, "size": 30}