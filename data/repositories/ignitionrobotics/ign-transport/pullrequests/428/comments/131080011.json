{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/131080011.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-131080011"}}, "parent": {"id": 130758379, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428/comments/130758379.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428/_/diff#comment-130758379"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 428, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/pullrequests/428.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/pull-requests/428"}}, "title": "Write to disk from a background thread in log recorder"}, "content": {"raw": "I have made the change to specify the buffer size in MB in dce0319. I assumed you said the default size was 1000 MB, not 1000 bytes.\n\nIt also occurred to me that any data remaining in the queue when `Stop` is closed or the `Recorder` object is destroyed may not get written to the log file. In b808836, I changed it so that `Stop` flushes the remaining data to the log file. One caveat here is that now `Recorder::Stop` (and, as a result, `Recorder::~Recorder`) are blocking functions. I think that's acceptable, but I'd like to hear your opinion. \n\nFinally, I found that `transport::Log` doesn't properly end transactions it started when `transport::Log::~Log` is called, which means the last few messages inserted into the log file using `transport::Log::InsertMessage` may not get written to the database. In b808836, I changed it so that it ends the transaction when the destructor is called. I think this fixes the flaky test `INTEGRATION_log_system` in ign-gazebo.", "markup": "markdown", "html": "<p>I have made the change to specify the buffer size in MB in <a href=\"#!/ignitionrobotics/ign-transport/commits/dce0319\" rel=\"nofollow\" class=\"ap-connect-link\">dce0319</a>. I assumed you said the default size was 1000 MB, not 1000 bytes.</p>\n<p>It also occurred to me that any data remaining in the queue when <code>Stop</code> is closed or the <code>Recorder</code> object is destroyed may not get written to the log file. In <a href=\"#!/ignitionrobotics/ign-transport/commits/b808836\" rel=\"nofollow\" class=\"ap-connect-link\">b808836</a>, I changed it so that <code>Stop</code> flushes the remaining data to the log file. One caveat here is that now <code>Recorder::Stop</code> (and, as a result, <code>Recorder::~Recorder</code>) are blocking functions. I think that's acceptable, but I'd like to hear your opinion. </p>\n<p>Finally, I found that <code>transport::Log</code> doesn't properly end transactions it started when <code>transport::Log::~Log</code> is called, which means the last few messages inserted into the log file using <code>transport::Log::InsertMessage</code> may not get written to the database. In <a href=\"#!/ignitionrobotics/ign-transport/commits/b808836\" rel=\"nofollow\" class=\"ap-connect-link\">b808836</a>, I changed it so that it ends the transaction when the destructor is called. I think this fixes the flaky test <code>INTEGRATION_log_system</code> in ign-gazebo.</p>", "type": "rendered"}, "created_on": "2020-01-09T17:44:33.967733+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2020-01-09T17:44:33.978369+00:00", "type": "pullrequest_comment", "id": 131080011}