{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport"}, "avatar": {"href": "data/bytebucket.org/ravatar/{4249390a-7f55-404b-990d-817ba94cc7ac}ts=1533306"}}, "type": "repository", "name": "ign-transport", "full_name": "ignitionrobotics/ign-transport", "uuid": "{4249390a-7f55-404b-990d-817ba94cc7ac}"}, "links": {"attachments": {"href": "data/repositories/ignitionrobotics/ign-transport/issues/72/attachments_page=1.json"}, "self": {"href": "data/repositories/ignitionrobotics/ign-transport/issues/72.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/issues/72/watch"}, "comments": {"href": "data/repositories/ignitionrobotics/ign-transport/issues/72/comments_page=1.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/issues/72/ign-topic-service-fails-on-macos-x-if"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/issues/72/vote"}}, "reporter": {"display_name": "Carlos Ag\u00fcero", "uuid": "{da8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D"}, "html": {"href": "https://bitbucket.org/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/692bf15758111acaddae4da15a47f9e5d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCA-0.png"}}, "nickname": "caguero", "type": "user", "account_id": "557058:4ded1ddf-947e-4154-bbd1-3dba24f1bdbd"}, "title": "ign topic|service fails on MacOS X if system integrity protection is enabled", "component": null, "votes": 0, "watches": 1, "content": {"raw": "Here's a snippet of the content of `cmdtransport3.rb` installed with Ignition Transport:\r\n\r\n```\r\n#!c++\r\n\r\n...\r\n# Constants.\r\nLIBRARY_NAME = 'libignition-transport3.so'\r\n...\r\n```\r\nThe variable `LIBRARY_NAME` is passed to `dlload()` later. As usual, there are a few standard directories that are checked to find the shared library. Homebrew installs all resources in `/usr/local/` (after running  `brew links <package>`) and in order to find shared libraries,  you need to set `DYLD_LIBRARY_PATH` pointing to `/usr/local/lib`. However, if the Mac OS X [system integrity protection](https://en.wikipedia.org/wiki/System_Integrity_Protection) is enabled, you won't be able to do it. Apparently, this is the most common setup and is not recommended to disable it. \r\n\r\nThe issue then is that `libignition-transport3.so` won't be found when using `ign`.\r\n\r\nA potential solution is to change `LIBRARY_NAME` to contain the relative path to the shared library from the ruby script (`cmdtransport3.rb`). Both the ruby script and the shared library are installed together, so this mechanism should be relocatable.\r\n\r\nE.g.: `cmdtransport3.rb` is installed in:\r\n\r\n  `/home/caguero/local/lib/ruby/ignition/cmdtransport3.rb`\r\n\r\nThe Ignition Transport library is installed in:\r\n\r\n  `/home/caguero/local/lib/libignition-transport3.so`\r\n\r\nThe value of IGN_LIBRARY_NAME should be:\r\n\r\n```\r\n#!c++\r\n\r\n...\r\n# Constants.\r\nLIBRARY_NAME = '../../libignition-transport3.so'\r\n...\r\n```", "markup": "markdown", "html": "<p>Here's a snippet of the content of <code>cmdtransport3.rb</code> installed with Ignition Transport:</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"p\">...</span>\n<span class=\"cp\"># Constants.</span>\n<span class=\"n\">LIBRARY_NAME</span> <span class=\"o\">=</span> <span class=\"err\">&#39;</span><span class=\"n\">libignition</span><span class=\"o\">-</span><span class=\"n\">transport3</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"err\">&#39;</span>\n<span class=\"p\">...</span>\n</pre></div>\n\n\n<p>The variable <code>LIBRARY_NAME</code> is passed to <code>dlload()</code> later. As usual, there are a few standard directories that are checked to find the shared library. Homebrew installs all resources in <code>/usr/local/</code> (after running  <code>brew links &lt;package&gt;</code>) and in order to find shared libraries,  you need to set <code>DYLD_LIBRARY_PATH</code> pointing to <code>/usr/local/lib</code>. However, if the Mac OS X <a data-is-external-link=\"true\" href=\"https://en.wikipedia.org/wiki/System_Integrity_Protection\" rel=\"nofollow\">system integrity protection</a> is enabled, you won't be able to do it. Apparently, this is the most common setup and is not recommended to disable it. </p>\n<p>The issue then is that <code>libignition-transport3.so</code> won't be found when using <code>ign</code>.</p>\n<p>A potential solution is to change <code>LIBRARY_NAME</code> to contain the relative path to the shared library from the ruby script (<code>cmdtransport3.rb</code>). Both the ruby script and the shared library are installed together, so this mechanism should be relocatable.</p>\n<p>E.g.: <code>cmdtransport3.rb</code> is installed in:</p>\n<p><code>/home/caguero/local/lib/ruby/ignition/cmdtransport3.rb</code></p>\n<p>The Ignition Transport library is installed in:</p>\n<p><code>/home/caguero/local/lib/libignition-transport3.so</code></p>\n<p>The value of IGN_LIBRARY_NAME should be:</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"p\">...</span>\n<span class=\"cp\"># Constants.</span>\n<span class=\"n\">LIBRARY_NAME</span> <span class=\"o\">=</span> <span class=\"err\">&#39;</span><span class=\"p\">..</span><span class=\"o\">/</span><span class=\"p\">..</span><span class=\"o\">/</span><span class=\"n\">libignition</span><span class=\"o\">-</span><span class=\"n\">transport3</span><span class=\"p\">.</span><span class=\"n\">so</span><span class=\"err\">&#39;</span>\n<span class=\"p\">...</span>\n</pre></div>", "type": "rendered"}, "assignee": {"display_name": "Carlos Ag\u00fcero", "uuid": "{da8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D"}, "html": {"href": "https://bitbucket.org/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/692bf15758111acaddae4da15a47f9e5d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCA-0.png"}}, "nickname": "caguero", "type": "user", "account_id": "557058:4ded1ddf-947e-4154-bbd1-3dba24f1bdbd"}, "state": "resolved", "version": null, "edited_on": null, "created_on": "2017-10-04T22:14:56.157361+00:00", "milestone": null, "updated_on": "2017-10-05T15:18:24.287555+00:00", "type": "issue", "id": 72}