{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport"}, "avatar": {"href": "data/bytebucket.org/ravatar/{4249390a-7f55-404b-990d-817ba94cc7ac}ts=1533306"}}, "type": "repository", "name": "ign-transport", "full_name": "ignitionrobotics/ign-transport", "uuid": "{4249390a-7f55-404b-990d-817ba94cc7ac}"}, "links": {"attachments": {"href": "data/repositories/ignitionrobotics/ign-transport/issues/113/attachments_page=1.json"}, "self": {"href": "data/repositories/ignitionrobotics/ign-transport/issues/113.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/issues/113/watch"}, "comments": {"href": "data/repositories/ignitionrobotics/ign-transport/issues/113/comments_page=1.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/issues/113/fedora-kde-tests-do-not-pass-on-fresh"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-transport/issues/113/vote"}}, "reporter": {"display_name": "Til Hoff", "uuid": "{5b5196a3-571e-4e4c-bed3-6f72e4dabba8}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5b5196a3-571e-4e4c-bed3-6f72e4dabba8%7D"}, "html": {"href": "https://bitbucket.org/%7B5b5196a3-571e-4e4c-bed3-6f72e4dabba8%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1835281ac000de88eb0ed5f38cd82eaed=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsTH-5.png"}}, "nickname": "turakar", "type": "user", "account_id": "557058:0928ff78-c705-4502-bf3b-52e34e5508f2"}, "title": "[Fedora KDE] Tests do not pass on fresh source install - Discovery fails", "component": null, "votes": 0, "watches": 1, "content": {"raw": "# Description\r\n\r\n`ign-transport` is compiled from source without errors. After that, `make test` is run. Some of the tests, most noticeably `UNIT_Discovery_TEST`, fails. Test `INTEGRATION_twoProcsSrvCallStress` hangs and blocks further tests.\r\n\r\n# Steps to reproduce\r\n\r\n* use Fedora KDE 29 / 30\r\n* install dependencies \\(migrated from the install instructions for ignition\\)\r\n\r\n```\r\nsudo dnf install cmake freeglut-devel ffmpeg-devel freeimage-devel gflags-devel glew-devel gts-devel ogre-devel protobuf-devel protobuf-c-devel qt5 tinyxml2-devel tinyxml-devel pkg-config protobuf-compiler python qt5-qtquickcontrols qt5-qtquickcontrols2 qt5-devel qt5-qtdeclarative-devel qt5-qtquickcontrols2-devel ruby rubygem-ronn uuid-devel libzip-devel jsoncpp-devel libcurl-devel libyaml-devel czmq-devel cppzmq-devel sqlite-devel libwebsockets-devel eigen3-devel openssl-devel git mercurial make g++\r\n```\r\n\r\n* build `dart`, `assimp` and `gflags` from source \\(unrelated to `ign-transport`, but important for the merge-install\\)\r\n\r\n    * On Fedora KDE 30 you can use `gflags-devel` from the repositories\r\n    \r\n* clone the sources as laid out in the official install instructions for ignition\r\n* build a merge-install\r\n\r\n```\r\ncolcon build --merge-install\r\n```\r\n\r\n* Execute the following:\r\n\r\n```shell\r\ncd ign-transport\r\nmkdir build && cd build\r\ncmake ..\r\nmake\r\nmake test\r\n```\r\n\r\n**Expected behaviour**\r\n\r\nCompilation works. All tests pass.\r\n\r\n**Actual behaviour**\r\n\r\nCompilation works \\(no severe warnings printed, no dependencies not found\\). Test results:\r\n\r\n```\r\nRunning tests...\r\nTest project /home/t/projects/debris/approach-simulator/ignitionrobotics/ign-transport/build\r\n      Start  1: UNIT_AdvertiseOptions_TEST\r\n 1/90 Test  #1: UNIT_AdvertiseOptions_TEST .............................   Passed    0.01 sec\r\n      Start  2: check_UNIT_AdvertiseOptions_TEST\r\n 2/90 Test  #2: check_UNIT_AdvertiseOptions_TEST .......................   Passed    0.02 sec\r\n      Start  3: UNIT_CIface_TEST\r\n 3/90 Test  #3: UNIT_CIface_TEST .......................................   Passed    0.37 sec\r\n      Start  4: check_UNIT_CIface_TEST\r\n 4/90 Test  #4: check_UNIT_CIface_TEST .................................   Passed    0.02 sec\r\n      Start  5: UNIT_Clock_TEST\r\n 5/90 Test  #5: UNIT_Clock_TEST ........................................   Passed    1.66 sec\r\n      Start  6: check_UNIT_Clock_TEST\r\n 6/90 Test  #6: check_UNIT_Clock_TEST ..................................   Passed    0.02 sec\r\n      Start  7: UNIT_Discovery_TEST\r\n 7/90 Test  #7: UNIT_Discovery_TEST ....................................***Failed   33.84 sec\r\n      Start  8: check_UNIT_Discovery_TEST\r\n 8/90 Test  #8: check_UNIT_Discovery_TEST ..............................   Passed    0.03 sec\r\n      Start  9: UNIT_HandlerStorage_TEST\r\n 9/90 Test  #9: UNIT_HandlerStorage_TEST ...............................   Passed    0.02 sec\r\n      Start 10: check_UNIT_HandlerStorage_TEST\r\n10/90 Test #10: check_UNIT_HandlerStorage_TEST .........................   Passed    0.03 sec\r\n      Start 11: UNIT_Helpers_TEST\r\n11/90 Test #11: UNIT_Helpers_TEST ......................................   Passed    0.01 sec\r\n      Start 12: check_UNIT_Helpers_TEST\r\n12/90 Test #12: check_UNIT_Helpers_TEST ................................   Passed    0.02 sec\r\n      Start 13: UNIT_MessageInfo_TEST\r\n13/90 Test #13: UNIT_MessageInfo_TEST ..................................   Passed    0.01 sec\r\n      Start 14: check_UNIT_MessageInfo_TEST\r\n14/90 Test #14: check_UNIT_MessageInfo_TEST ............................   Passed    0.02 sec\r\n      Start 15: UNIT_NetUtils_TEST\r\n15/90 Test #15: UNIT_NetUtils_TEST .....................................   Passed    0.02 sec\r\n      Start 16: check_UNIT_NetUtils_TEST\r\n16/90 Test #16: check_UNIT_NetUtils_TEST ...............................   Passed    0.03 sec\r\n      Start 17: UNIT_NodeOptions_TEST\r\n17/90 Test #17: UNIT_NodeOptions_TEST ..................................   Passed    0.01 sec\r\n      Start 18: check_UNIT_NodeOptions_TEST\r\n18/90 Test #18: check_UNIT_NodeOptions_TEST ............................   Passed    0.02 sec\r\n      Start 19: UNIT_Node_TEST\r\n19/90 Test #19: UNIT_Node_TEST .........................................   Passed   23.13 sec\r\n      Start 20: check_UNIT_Node_TEST\r\n20/90 Test #20: check_UNIT_Node_TEST ...................................   Passed    0.02 sec\r\n      Start 21: UNIT_Packet_TEST\r\n21/90 Test #21: UNIT_Packet_TEST .......................................   Passed    0.01 sec\r\n      Start 22: check_UNIT_Packet_TEST\r\n22/90 Test #22: check_UNIT_Packet_TEST .................................   Passed    0.03 sec\r\n      Start 23: UNIT_Publisher_TEST\r\n23/90 Test #23: UNIT_Publisher_TEST ....................................   Passed    0.01 sec\r\n      Start 24: check_UNIT_Publisher_TEST\r\n24/90 Test #24: check_UNIT_Publisher_TEST ..............................   Passed    0.02 sec\r\n      Start 25: UNIT_SubscribeOptions_TEST\r\n25/90 Test #25: UNIT_SubscribeOptions_TEST .............................   Passed    0.02 sec\r\n      Start 26: check_UNIT_SubscribeOptions_TEST\r\n26/90 Test #26: check_UNIT_SubscribeOptions_TEST .......................   Passed    0.02 sec\r\n      Start 27: UNIT_TopicStorage_TEST\r\n27/90 Test #27: UNIT_TopicStorage_TEST .................................   Passed    0.01 sec\r\n      Start 28: check_UNIT_TopicStorage_TEST\r\n28/90 Test #28: check_UNIT_TopicStorage_TEST ...........................   Passed    0.03 sec\r\n      Start 29: UNIT_TopicUtils_TEST\r\n29/90 Test #29: UNIT_TopicUtils_TEST ...................................   Passed    0.01 sec\r\n      Start 30: check_UNIT_TopicUtils_TEST\r\n30/90 Test #30: check_UNIT_TopicUtils_TEST .............................   Passed    0.02 sec\r\n      Start 31: UNIT_Uuid_TEST\r\n31/90 Test #31: UNIT_Uuid_TEST .........................................   Passed    0.01 sec\r\n      Start 32: check_UNIT_Uuid_TEST\r\n32/90 Test #32: check_UNIT_Uuid_TEST ...................................   Passed    0.02 sec\r\n      Start 33: UNIT_ign_TEST\r\n33/90 Test #33: UNIT_ign_TEST ..........................................***Timeout 240.03 sec\r\n      Start 34: check_UNIT_ign_TEST\r\n34/90 Test #34: check_UNIT_ign_TEST ....................................   Passed    0.02 sec\r\n      Start 35: UNIT_ign_src_TEST\r\n35/90 Test #35: UNIT_ign_src_TEST ......................................   Passed    6.45 sec\r\n      Start 36: check_UNIT_ign_src_TEST\r\n36/90 Test #36: check_UNIT_ign_src_TEST ................................   Passed    0.02 sec\r\n      Start 37: INTEGRATION_versioned_symbols\r\n37/90 Test #37: INTEGRATION_versioned_symbols ..........................   Passed    0.03 sec\r\n      Start 38: INTEGRATION_authPubSub\r\n38/90 Test #38: INTEGRATION_authPubSub .................................   Passed   10.81 sec\r\n      Start 39: check_INTEGRATION_authPubSub\r\n39/90 Test #39: check_INTEGRATION_authPubSub ...........................   Passed    0.03 sec\r\n      Start 40: INTEGRATION_scopedTopic\r\n40/90 Test #40: INTEGRATION_scopedTopic ................................   Passed   11.47 sec\r\n      Start 41: check_INTEGRATION_scopedTopic\r\n41/90 Test #41: check_INTEGRATION_scopedTopic ..........................   Passed    0.03 sec\r\n      Start 42: INTEGRATION_twoProcsPubSub\r\n42/90 Test #42: INTEGRATION_twoProcsPubSub .............................***Exception: SegFault 73.67 sec\r\n      Start 43: check_INTEGRATION_twoProcsPubSub\r\n43/90 Test #43: check_INTEGRATION_twoProcsPubSub .......................   Passed    0.03 sec\r\n      Start 44: INTEGRATION_twoProcsSrvCall\r\n44/90 Test #44: INTEGRATION_twoProcsSrvCall ............................***Exception: SegFault 35.44 sec\r\n      Start 45: check_INTEGRATION_twoProcsSrvCall\r\n45/90 Test #45: check_INTEGRATION_twoProcsSrvCall ......................   Passed    0.03 sec\r\n      Start 46: INTEGRATION_twoProcsSrvCallStress\r\n```\r\n\r\nThe tests hang here with low CPU usage for over one hour. There is a detailed log in the comments below.\r\n\r\n# Version\r\n\r\n* Fedora KDE 29 / 30\r\n* source install\r\n* latest ignition \\(blueprint\\)\r\n\r\n# Additional Information\r\n\r\n* I think this is the reason why [ign-gazebo does not start on my machine](#!/ignitionrobotics/ign-gazebo/issues/38/gazebo-hangs-at-requesting-list-of-world) \\(gazebo client cannot find the server and therefore waits forever\\).\r\n* The problem does not happen on classic Fedora \\(Gnome\\), as verified by spinning up several VMs\r\n* There is a workaround: Set `IGN_IP=127.0.0.1` environment variable.\r\n\r\n\u200c", "markup": "markdown", "html": "<h1 id=\"markdown-header-description\">Description</h1>\n<p><code>ign-transport</code> is compiled from source without errors. After that, <code>make test</code> is run. Some of the tests, most noticeably <code>UNIT_Discovery_TEST</code>, fails. Test <code>INTEGRATION_twoProcsSrvCallStress</code> hangs and blocks further tests.</p>\n<h1 id=\"markdown-header-steps-to-reproduce\">Steps to reproduce</h1>\n<ul>\n<li>use Fedora KDE 29 / 30</li>\n<li>install dependencies (migrated from the install instructions for ignition)</li>\n</ul>\n<div class=\"codehilite\"><pre><span></span>sudo dnf install cmake freeglut-devel ffmpeg-devel freeimage-devel gflags-devel glew-devel gts-devel ogre-devel protobuf-devel protobuf-c-devel qt5 tinyxml2-devel tinyxml-devel pkg-config protobuf-compiler python qt5-qtquickcontrols qt5-qtquickcontrols2 qt5-devel qt5-qtdeclarative-devel qt5-qtquickcontrols2-devel ruby rubygem-ronn uuid-devel libzip-devel jsoncpp-devel libcurl-devel libyaml-devel czmq-devel cppzmq-devel sqlite-devel libwebsockets-devel eigen3-devel openssl-devel git mercurial make g++\n</pre></div>\n\n\n<ul>\n<li>\n<p>build <code>dart</code>, <code>assimp</code> and <code>gflags</code> from source (unrelated to <code>ign-transport</code>, but important for the merge-install)</p>\n<ul>\n<li>On Fedora KDE 30 you can use <code>gflags-devel</code> from the repositories</li>\n</ul>\n</li>\n<li>\n<p>clone the sources as laid out in the official install instructions for ignition</p>\n</li>\n<li>build a merge-install</li>\n</ul>\n<div class=\"codehilite\"><pre><span></span>colcon build --merge-install\n</pre></div>\n\n\n<ul>\n<li>Execute the following:</li>\n</ul>\n<div class=\"codehilite language-shell\"><pre><span></span><span class=\"nb\">cd</span> ign-transport\nmkdir build <span class=\"o\">&amp;&amp;</span> <span class=\"nb\">cd</span> build\ncmake ..\nmake\nmake <span class=\"nb\">test</span>\n</pre></div>\n\n\n<p><strong>Expected behaviour</strong></p>\n<p>Compilation works. All tests pass.</p>\n<p><strong>Actual behaviour</strong></p>\n<p>Compilation works (no severe warnings printed, no dependencies not found). Test results:</p>\n<div class=\"codehilite\"><pre><span></span>Running tests...\nTest project /home/t/projects/debris/approach-simulator/ignitionrobotics/ign-transport/build\n      Start  1: UNIT_AdvertiseOptions_TEST\n 1/90 Test  #1: UNIT_AdvertiseOptions_TEST .............................   Passed    0.01 sec\n      Start  2: check_UNIT_AdvertiseOptions_TEST\n 2/90 Test  #2: check_UNIT_AdvertiseOptions_TEST .......................   Passed    0.02 sec\n      Start  3: UNIT_CIface_TEST\n 3/90 Test  #3: UNIT_CIface_TEST .......................................   Passed    0.37 sec\n      Start  4: check_UNIT_CIface_TEST\n 4/90 Test  #4: check_UNIT_CIface_TEST .................................   Passed    0.02 sec\n      Start  5: UNIT_Clock_TEST\n 5/90 Test  #5: UNIT_Clock_TEST ........................................   Passed    1.66 sec\n      Start  6: check_UNIT_Clock_TEST\n 6/90 Test  #6: check_UNIT_Clock_TEST ..................................   Passed    0.02 sec\n      Start  7: UNIT_Discovery_TEST\n 7/90 Test  #7: UNIT_Discovery_TEST ....................................***Failed   33.84 sec\n      Start  8: check_UNIT_Discovery_TEST\n 8/90 Test  #8: check_UNIT_Discovery_TEST ..............................   Passed    0.03 sec\n      Start  9: UNIT_HandlerStorage_TEST\n 9/90 Test  #9: UNIT_HandlerStorage_TEST ...............................   Passed    0.02 sec\n      Start 10: check_UNIT_HandlerStorage_TEST\n10/90 Test #10: check_UNIT_HandlerStorage_TEST .........................   Passed    0.03 sec\n      Start 11: UNIT_Helpers_TEST\n11/90 Test #11: UNIT_Helpers_TEST ......................................   Passed    0.01 sec\n      Start 12: check_UNIT_Helpers_TEST\n12/90 Test #12: check_UNIT_Helpers_TEST ................................   Passed    0.02 sec\n      Start 13: UNIT_MessageInfo_TEST\n13/90 Test #13: UNIT_MessageInfo_TEST ..................................   Passed    0.01 sec\n      Start 14: check_UNIT_MessageInfo_TEST\n14/90 Test #14: check_UNIT_MessageInfo_TEST ............................   Passed    0.02 sec\n      Start 15: UNIT_NetUtils_TEST\n15/90 Test #15: UNIT_NetUtils_TEST .....................................   Passed    0.02 sec\n      Start 16: check_UNIT_NetUtils_TEST\n16/90 Test #16: check_UNIT_NetUtils_TEST ...............................   Passed    0.03 sec\n      Start 17: UNIT_NodeOptions_TEST\n17/90 Test #17: UNIT_NodeOptions_TEST ..................................   Passed    0.01 sec\n      Start 18: check_UNIT_NodeOptions_TEST\n18/90 Test #18: check_UNIT_NodeOptions_TEST ............................   Passed    0.02 sec\n      Start 19: UNIT_Node_TEST\n19/90 Test #19: UNIT_Node_TEST .........................................   Passed   23.13 sec\n      Start 20: check_UNIT_Node_TEST\n20/90 Test #20: check_UNIT_Node_TEST ...................................   Passed    0.02 sec\n      Start 21: UNIT_Packet_TEST\n21/90 Test #21: UNIT_Packet_TEST .......................................   Passed    0.01 sec\n      Start 22: check_UNIT_Packet_TEST\n22/90 Test #22: check_UNIT_Packet_TEST .................................   Passed    0.03 sec\n      Start 23: UNIT_Publisher_TEST\n23/90 Test #23: UNIT_Publisher_TEST ....................................   Passed    0.01 sec\n      Start 24: check_UNIT_Publisher_TEST\n24/90 Test #24: check_UNIT_Publisher_TEST ..............................   Passed    0.02 sec\n      Start 25: UNIT_SubscribeOptions_TEST\n25/90 Test #25: UNIT_SubscribeOptions_TEST .............................   Passed    0.02 sec\n      Start 26: check_UNIT_SubscribeOptions_TEST\n26/90 Test #26: check_UNIT_SubscribeOptions_TEST .......................   Passed    0.02 sec\n      Start 27: UNIT_TopicStorage_TEST\n27/90 Test #27: UNIT_TopicStorage_TEST .................................   Passed    0.01 sec\n      Start 28: check_UNIT_TopicStorage_TEST\n28/90 Test #28: check_UNIT_TopicStorage_TEST ...........................   Passed    0.03 sec\n      Start 29: UNIT_TopicUtils_TEST\n29/90 Test #29: UNIT_TopicUtils_TEST ...................................   Passed    0.01 sec\n      Start 30: check_UNIT_TopicUtils_TEST\n30/90 Test #30: check_UNIT_TopicUtils_TEST .............................   Passed    0.02 sec\n      Start 31: UNIT_Uuid_TEST\n31/90 Test #31: UNIT_Uuid_TEST .........................................   Passed    0.01 sec\n      Start 32: check_UNIT_Uuid_TEST\n32/90 Test #32: check_UNIT_Uuid_TEST ...................................   Passed    0.02 sec\n      Start 33: UNIT_ign_TEST\n33/90 Test #33: UNIT_ign_TEST ..........................................***Timeout 240.03 sec\n      Start 34: check_UNIT_ign_TEST\n34/90 Test #34: check_UNIT_ign_TEST ....................................   Passed    0.02 sec\n      Start 35: UNIT_ign_src_TEST\n35/90 Test #35: UNIT_ign_src_TEST ......................................   Passed    6.45 sec\n      Start 36: check_UNIT_ign_src_TEST\n36/90 Test #36: check_UNIT_ign_src_TEST ................................   Passed    0.02 sec\n      Start 37: INTEGRATION_versioned_symbols\n37/90 Test #37: INTEGRATION_versioned_symbols ..........................   Passed    0.03 sec\n      Start 38: INTEGRATION_authPubSub\n38/90 Test #38: INTEGRATION_authPubSub .................................   Passed   10.81 sec\n      Start 39: check_INTEGRATION_authPubSub\n39/90 Test #39: check_INTEGRATION_authPubSub ...........................   Passed    0.03 sec\n      Start 40: INTEGRATION_scopedTopic\n40/90 Test #40: INTEGRATION_scopedTopic ................................   Passed   11.47 sec\n      Start 41: check_INTEGRATION_scopedTopic\n41/90 Test #41: check_INTEGRATION_scopedTopic ..........................   Passed    0.03 sec\n      Start 42: INTEGRATION_twoProcsPubSub\n42/90 Test #42: INTEGRATION_twoProcsPubSub .............................***Exception: SegFault 73.67 sec\n      Start 43: check_INTEGRATION_twoProcsPubSub\n43/90 Test #43: check_INTEGRATION_twoProcsPubSub .......................   Passed    0.03 sec\n      Start 44: INTEGRATION_twoProcsSrvCall\n44/90 Test #44: INTEGRATION_twoProcsSrvCall ............................***Exception: SegFault 35.44 sec\n      Start 45: check_INTEGRATION_twoProcsSrvCall\n45/90 Test #45: check_INTEGRATION_twoProcsSrvCall ......................   Passed    0.03 sec\n      Start 46: INTEGRATION_twoProcsSrvCallStress\n</pre></div>\n\n\n<p>The tests hang here with low CPU usage for over one hour. There is a detailed log in the comments below.</p>\n<h1 id=\"markdown-header-version\">Version</h1>\n<ul>\n<li>Fedora KDE 29 / 30</li>\n<li>source install</li>\n<li>latest ignition (blueprint)</li>\n</ul>\n<h1 id=\"markdown-header-additional-information\">Additional Information</h1>\n<ul>\n<li>I think this is the reason why <a data-is-external-link=\"true\" href=\"#!/ignitionrobotics/ign-gazebo/issues/38/gazebo-hangs-at-requesting-list-of-world\" rel=\"nofollow\">ign-gazebo does not start on my machine</a> (gazebo client cannot find the server and therefore waits forever).</li>\n<li>The problem does not happen on classic Fedora (Gnome), as verified by spinning up several VMs</li>\n<li>There is a workaround: Set <code>IGN_IP=127.0.0.1</code> environment variable.</li>\n</ul>\n<p>\u200c</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": null, "edited_on": null, "created_on": "2019-09-10T16:51:27.009868+00:00", "milestone": null, "updated_on": "2019-10-01T11:48:22.471056+00:00", "type": "issue", "id": 113}