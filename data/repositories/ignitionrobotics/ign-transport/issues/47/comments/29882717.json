{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/issues/47/comments/29882717.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport/issues/47#comment-29882717"}}, "issue": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport/issues/47.json"}}, "type": "issue", "id": 47, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-transport.json"}, "html": {"href": "#!/ignitionrobotics/ign-transport"}, "avatar": {"href": "data/bytebucket.org/ravatar/{4249390a-7f55-404b-990d-817ba94cc7ac}ts=1533306"}}, "type": "repository", "name": "ign-transport", "full_name": "ignitionrobotics/ign-transport", "uuid": "{4249390a-7f55-404b-990d-817ba94cc7ac}"}, "title": "WaitForSubscribers in ign.cc"}, "content": {"raw": "I have a problem with ```TopicWatcherStorage::RemoveWatchersForTopic()``` function. I don't understand how to delete topic watcher.\n\n\n```\n#!c++\n\n      /// \\brief Remove all the watchers for the topic.\n      /// \\param[in] _topic Topic name.\n      /// \\param[in] _typeName Message type.\n      /// \\return True when at least one watcher was removed or false otherwise.\n      public: bool RemoveWatchersForTopic(const std::string &_topic,\n        const std::string &_typeName)\n      {\n        size_t count = 0;\n        if (this->data.find(_topic) != this->data.end())\n        {\n          WatchersPerNode_M watchers = this->data.at(_topic);\n          for (auto &node : watchers)\n          {\n            for (auto &watcher : node.second)\n            {\n              std::shared_ptr<TopicWatcher> watcherPtr = watcher;\n              if (watcherPtr) {\n                if (watcherPtr->TopicType() == _typeName) {\n                  //TODO: delete topic watcher\n                  //this->data[_topic][node].erase(watcherPtr);\n                }\n              }\n              else\n                std::cerr << \"Topic watcher is NULL\" << std::endl;\n            }\n          }\n        }\n\n        return count > 0;\n      }\n```\n\nI create a ```new_watchers``` structure, but I can change this part of code.", "markup": "markdown", "html": "<p>I have a problem with <code>TopicWatcherStorage::RemoveWatchersForTopic()</code> function. I don't understand how to delete topic watcher.</p>\n<div class=\"codehilite language-c++\"><pre><span></span>      <span class=\"c1\">/// \\brief Remove all the watchers for the topic.</span>\n      <span class=\"c1\">/// \\param[in] _topic Topic name.</span>\n      <span class=\"c1\">/// \\param[in] _typeName Message type.</span>\n      <span class=\"c1\">/// \\return True when at least one watcher was removed or false otherwise.</span>\n      <span class=\"k\">public</span><span class=\"o\">:</span> <span class=\"kt\">bool</span> <span class=\"n\">RemoveWatchersForTopic</span><span class=\"p\">(</span><span class=\"k\">const</span> <span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">string</span> <span class=\"o\">&amp;</span><span class=\"n\">_topic</span><span class=\"p\">,</span>\n        <span class=\"k\">const</span> <span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">string</span> <span class=\"o\">&amp;</span><span class=\"n\">_typeName</span><span class=\"p\">)</span>\n      <span class=\"p\">{</span>\n        <span class=\"kt\">size_t</span> <span class=\"n\">count</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">find</span><span class=\"p\">(</span><span class=\"n\">_topic</span><span class=\"p\">)</span> <span class=\"o\">!=</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">end</span><span class=\"p\">())</span>\n        <span class=\"p\">{</span>\n          <span class=\"n\">WatchersPerNode_M</span> <span class=\"n\">watchers</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">data</span><span class=\"p\">.</span><span class=\"n\">at</span><span class=\"p\">(</span><span class=\"n\">_topic</span><span class=\"p\">);</span>\n          <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"k\">auto</span> <span class=\"o\">&amp;</span><span class=\"nl\">node</span> <span class=\"p\">:</span> <span class=\"n\">watchers</span><span class=\"p\">)</span>\n          <span class=\"p\">{</span>\n            <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"k\">auto</span> <span class=\"o\">&amp;</span><span class=\"nl\">watcher</span> <span class=\"p\">:</span> <span class=\"n\">node</span><span class=\"p\">.</span><span class=\"n\">second</span><span class=\"p\">)</span>\n            <span class=\"p\">{</span>\n              <span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">shared_ptr</span><span class=\"o\">&lt;</span><span class=\"n\">TopicWatcher</span><span class=\"o\">&gt;</span> <span class=\"n\">watcherPtr</span> <span class=\"o\">=</span> <span class=\"n\">watcher</span><span class=\"p\">;</span>\n              <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">watcherPtr</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n                <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">watcherPtr</span><span class=\"o\">-&gt;</span><span class=\"n\">TopicType</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"n\">_typeName</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n                  <span class=\"c1\">//TODO: delete topic watcher</span>\n                  <span class=\"c1\">//this-&gt;data[_topic][node].erase(watcherPtr);</span>\n                <span class=\"p\">}</span>\n              <span class=\"p\">}</span>\n              <span class=\"k\">else</span>\n                <span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">cerr</span> <span class=\"o\">&lt;&lt;</span> <span class=\"s\">&quot;Topic watcher is NULL&quot;</span> <span class=\"o\">&lt;&lt;</span> <span class=\"n\">std</span><span class=\"o\">::</span><span class=\"n\">endl</span><span class=\"p\">;</span>\n            <span class=\"p\">}</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">count</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n      <span class=\"p\">}</span>\n</pre></div>\n\n\n<p>I create a <code>new_watchers</code> structure, but I can change this part of code.</p>", "type": "rendered"}, "created_on": "2016-08-16T01:04:34.737563+00:00", "user": {"display_name": "nampi", "uuid": "{89a67bdd-09e6-4c17-8014-48d97fa5c4c8}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B89a67bdd-09e6-4c17-8014-48d97fa5c4c8%7D"}, "html": {"href": "https://bitbucket.org/%7B89a67bdd-09e6-4c17-8014-48d97fa5c4c8%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6509b6f8-6263-4504-9cee-d12b08b0b4e8/38230840-603b-4875-93fb-c2e81928dd69/128"}}, "nickname": "nampi", "type": "user", "account_id": "557058:6509b6f8-6263-4504-9cee-d12b08b0b4e8"}, "updated_on": "2016-08-16T13:32:38.057922+00:00", "type": "issue_comment", "id": 29882717}