{"rendered": {"description": {"raw": "A deadlock was observed when spawning models into the world through the `UserCommands `system. \r\n\r\nThe system locks a mutex in order to process a list of commands. Later service calls will be blocked until the current command is fully processed. However, it seems like if the model being spawned has plugins that also makes service call, it causes a deadlock\r\n\r\nFixed by making a copy of commands so execution of the command does not lock incoming services calls. \r\n\r\n\u200c\r\n\r\nI ran into the problem when spawning multiple robots in subt. Example cmd to reproduce the problem:\r\n\r\n```\r\nign launch -v 4 src/subt/subt_ign/launch/virtual_stix.ign robotName1:=X2_3 robotConfig1:=X2_SENSOR_CONFIG_1 robotName2:=X3_3 robotConfig2:=X3_SENSOR_CONFIG_2 robotName3:=X4_3 robotConfig3:=X4_SENSOR_CONFIG_4 robotName4:=X1_3 robotConfig4:=X1_SENSOR_CONFIG_1 robotName5:=X2_2 robotConfig5:=X2_SENSOR_CONFIG_2 robotName6:=X6 robotConfig6:=X2_SENSOR_CONFIG_1\r\n```", "markup": "markdown", "html": "<p>A deadlock was observed when spawning models into the world through the <code>UserCommands</code>system. </p>\n<p>The system locks a mutex in order to process a list of commands. Later service calls will be blocked until the current command is fully processed. However, it seems like if the model being spawned has plugins that also makes service call, it causes a deadlock</p>\n<p>Fixed by making a copy of commands so execution of the command does not lock incoming services calls. </p>\n<p>\u200c</p>\n<p>I ran into the problem when spawning multiple robots in subt. Example cmd to reproduce the problem:</p>\n<div class=\"codehilite\"><pre><span></span>ign launch -v 4 src/subt/subt_ign/launch/virtual_stix.ign robotName1:=X2_3 robotConfig1:=X2_SENSOR_CONFIG_1 robotName2:=X3_3 robotConfig2:=X3_SENSOR_CONFIG_2 robotName3:=X4_3 robotConfig3:=X4_SENSOR_CONFIG_4 robotName4:=X1_3 robotConfig4:=X1_SENSOR_CONFIG_1 robotName5:=X2_2 robotConfig5:=X2_SENSOR_CONFIG_2 robotName6:=X6 robotConfig6:=X2_SENSOR_CONFIG_1\n</pre></div>", "type": "rendered"}, "title": {"raw": "Fix deadlock when spawning robots", "markup": "markdown", "html": "<p>Fix deadlock when spawning robots</p>", "type": "rendered"}}, "type": "pullrequest", "description": "A deadlock was observed when spawning models into the world through the `UserCommands `system. \r\n\r\nThe system locks a mutex in order to process a list of commands. Later service calls will be blocked until the current command is fully processed. However, it seems like if the model being spawned has plugins that also makes service call, it causes a deadlock\r\n\r\nFixed by making a copy of commands so execution of the command does not lock incoming services calls. \r\n\r\n\u200c\r\n\r\nI ran into the problem when spawning multiple robots in subt. Example cmd to reproduce the problem:\r\n\r\n```\r\nign launch -v 4 src/subt/subt_ign/launch/virtual_stix.ign robotName1:=X2_3 robotConfig1:=X2_SENSOR_CONFIG_1 robotName2:=X3_3 robotConfig2:=X3_SENSOR_CONFIG_2 robotName3:=X4_3 robotConfig3:=X4_SENSOR_CONFIG_4 robotName4:=X1_3 robotConfig4:=X1_SENSOR_CONFIG_1 robotName5:=X2_2 robotConfig5:=X2_SENSOR_CONFIG_2 robotName6:=X6 robotConfig6:=X2_SENSOR_CONFIG_1\r\n```", "links": {"decline": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-gazebo/pullrequests/365/decline"}, "diffstat": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-gazebo/diffstat/ignitionrobotics/ign-gazebo:830d998700fc%0D7eefca722215?from_pullrequest_id=365"}, "commits": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/365/commits.json"}, "self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/365.json"}, "comments": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/365/comments_page=1.json"}, "merge": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-gazebo/pullrequests/365/merge"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/365"}, "activity": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/365/activity.json"}, "diff": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-gazebo/diff/ignitionrobotics/ign-gazebo:830d998700fc%0D7eefca722215?from_pullrequest_id=365"}, "approve": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-gazebo/pullrequests/365/approve"}, "statuses": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/365/statuses_page=1.json"}}, "title": "Fix deadlock when spawning robots", "close_source_branch": true, "reviewers": [], "id": 365, "destination": {"commit": {"hash": "7eefca722215", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/7eefca722215.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/7eefca722215"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "ign-gazebo2"}}, "created_on": "2019-06-25T23:04:12.737886+00:00", "summary": {"raw": "A deadlock was observed when spawning models into the world through the `UserCommands `system. \r\n\r\nThe system locks a mutex in order to process a list of commands. Later service calls will be blocked until the current command is fully processed. However, it seems like if the model being spawned has plugins that also makes service call, it causes a deadlock\r\n\r\nFixed by making a copy of commands so execution of the command does not lock incoming services calls. \r\n\r\n\u200c\r\n\r\nI ran into the problem when spawning multiple robots in subt. Example cmd to reproduce the problem:\r\n\r\n```\r\nign launch -v 4 src/subt/subt_ign/launch/virtual_stix.ign robotName1:=X2_3 robotConfig1:=X2_SENSOR_CONFIG_1 robotName2:=X3_3 robotConfig2:=X3_SENSOR_CONFIG_2 robotName3:=X4_3 robotConfig3:=X4_SENSOR_CONFIG_4 robotName4:=X1_3 robotConfig4:=X1_SENSOR_CONFIG_1 robotName5:=X2_2 robotConfig5:=X2_SENSOR_CONFIG_2 robotName6:=X6 robotConfig6:=X2_SENSOR_CONFIG_1\r\n```", "markup": "markdown", "html": "<p>A deadlock was observed when spawning models into the world through the <code>UserCommands</code>system. </p>\n<p>The system locks a mutex in order to process a list of commands. Later service calls will be blocked until the current command is fully processed. However, it seems like if the model being spawned has plugins that also makes service call, it causes a deadlock</p>\n<p>Fixed by making a copy of commands so execution of the command does not lock incoming services calls. </p>\n<p>\u200c</p>\n<p>I ran into the problem when spawning multiple robots in subt. Example cmd to reproduce the problem:</p>\n<div class=\"codehilite\"><pre><span></span>ign launch -v 4 src/subt/subt_ign/launch/virtual_stix.ign robotName1:=X2_3 robotConfig1:=X2_SENSOR_CONFIG_1 robotName2:=X3_3 robotConfig2:=X3_SENSOR_CONFIG_2 robotName3:=X4_3 robotConfig3:=X4_SENSOR_CONFIG_4 robotName4:=X1_3 robotConfig4:=X1_SENSOR_CONFIG_1 robotName5:=X2_2 robotConfig5:=X2_SENSOR_CONFIG_2 robotName6:=X6 robotConfig6:=X2_SENSOR_CONFIG_1\n</pre></div>", "type": "rendered"}, "source": {"commit": {"hash": "b1812dd66982", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/b1812dd66982.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/b1812dd66982"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "spawn_deadlock"}}, "comment_count": 3, "state": "MERGED", "task_count": 0, "participants": [{"role": "PARTICIPANT", "participated_on": "2019-06-26T00:04:35.858826+00:00", "type": "participant", "approved": false, "user": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}}, {"role": "PARTICIPANT", "participated_on": "2019-06-26T14:01:47.122269+00:00", "type": "participant", "approved": true, "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}}, {"role": "PARTICIPANT", "participated_on": "2019-06-26T03:37:40.530773+00:00", "type": "participant", "approved": true, "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}}], "reason": "", "updated_on": "2019-06-26T17:20:31.186240+00:00", "author": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "merge_commit": {"hash": "830d998700fc", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/830d998700fc.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/830d998700fc"}}}, "closed_by": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}}