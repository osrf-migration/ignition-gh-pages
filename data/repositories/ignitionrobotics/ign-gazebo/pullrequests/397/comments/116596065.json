{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/397/comments/116596065.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/397/_/diff#comment-116596065"}}, "parent": {"id": 115011053, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/397/comments/115011053.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/397/_/diff#comment-115011053"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 397, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/397.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/397"}}, "title": "[Blueprint] Logging meshes and materials"}, "content": {"raw": "I created a few checklist items to try to capture these.\n\n> I'm seeing the log.zip file being created even if I'm not recording resources. Is this expected?\n\nNo, there should have been a flag check. Added in 9b84b5f.\n\n> If I remember correctly, we were creating new numbered directories if the directory already existed?\n\nI saw that this had been removed before this PR. In `default` branch, it still has this line:\n\n```\nlogPath = common::uniqueDirectoryPath(logPath);\n```\n\nBut it is no longer in `ign-gazebo2` branch. It existed in `ign-gazebo` [f9963d8](#!/ignitionrobotics/ign-gazebo/src/f9963d81807019ae75cadf7c8bcf7f2090f65691/src/systems/log/LogRecord.cc?at=ign-gazebo2#lines-184) but was removed in [22d7915](#!/ignitionrobotics/ign-gazebo/src/22d79157d28d5d2984f70f0128413998476d1565/src/systems/log/LogRecord.cc?at=ign-gazebo2#lines-165), where the behavior has been changed to overwrite existing directory, but that doesn\u2019t seem to be implemented correctly right now. I think it just needs a remove of the existing directory and compressed file.\n\n> The `zip` file is created as a sibling to the record path, i.e.:\n\nSo... yeah... the directory organization was an issue that got kind of tricky and I wasn't sure what's the best way. Right now it zips the whole directory purely becase `` `Zip()`` takes a directory only, so I could not give it multiple files \\(the sub-directory, the `state.tlog` and the console file\\). So it sits outside the directory it zips.\n\n> Should we delete the directory after zipping it?\n\nThat was the original and most intuitive way I tried. There were problems with it, which I tried to describe in the last paragraph of the PR description. I think it\u2019s cleaner to delete it, but we need to resolve the other directory problems, which comes down to whether we want to just overwrite things.\n\n> Should we make zipping optional?\n\nI don\u2019t know the right answer to this. Zipping keeps the file smaller, but I don\u2019t know how big the file will end up after 1 hour run. If zipping takes forever, then maybe people don\u2019t want the program to run forever - they might want it to just terminate, and they can compress it themselves later.\n\n> Should we support playing back directly from the zip file?\n\nThis is already implemented in `LogPlayback::ExtractStateAndResources()`. For context, the `log` directory is only kept because of the directory overwrite problem above. It is not needed; `log.zip` file alone should already be sufficient for playback.\n\n> Instead of loading the logged mesh, the simulation prints these errors:\n\nDoes this have to do with the `model://` and `file://` differences? I still need to replace all `file` with `model`. I haven\u2019t done that yet.", "markup": "markdown", "html": "<p>I created a few checklist items to try to capture these.</p>\n<blockquote>\n<p>I'm seeing the log.zip file being created even if I'm not recording resources. Is this expected?</p>\n</blockquote>\n<p>No, there should have been a flag check. Added in <a href=\"#!/ignitionrobotics/ign-gazebo/commits/9b84b5f\" rel=\"nofollow\" class=\"ap-connect-link\">9b84b5f</a>.</p>\n<blockquote>\n<p>If I remember correctly, we were creating new numbered directories if the directory already existed?</p>\n</blockquote>\n<p>I saw that this had been removed before this PR. In <code>default</code> branch, it still has this line:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nt\">logPath</span> <span class=\"o\">=</span> <span class=\"nt\">common</span><span class=\"p\">::</span><span class=\"nd\">uniqueDirectoryPath</span><span class=\"o\">(</span><span class=\"nt\">logPath</span><span class=\"o\">);</span>\n</pre></div>\n\n\n<p>But it is no longer in <code>ign-gazebo2</code> branch. It existed in <code>ign-gazebo</code> <a data-is-external-link=\"true\" href=\"#!/ignitionrobotics/ign-gazebo/src/f9963d81807019ae75cadf7c8bcf7f2090f65691/src/systems/log/LogRecord.cc?at=ign-gazebo2#lines-184\" rel=\"nofollow\">f9963d8</a> but was removed in <a data-is-external-link=\"true\" href=\"#!/ignitionrobotics/ign-gazebo/src/22d79157d28d5d2984f70f0128413998476d1565/src/systems/log/LogRecord.cc?at=ign-gazebo2#lines-165\" rel=\"nofollow\">22d7915</a>, where the behavior has been changed to overwrite existing directory, but that doesn\u2019t seem to be implemented correctly right now. I think it just needs a remove of the existing directory and compressed file.</p>\n<blockquote>\n<p>The <code>zip</code> file is created as a sibling to the record path, i.e.:</p>\n</blockquote>\n<p>So... yeah... the directory organization was an issue that got kind of tricky and I wasn't sure what's the best way. Right now it zips the whole directory purely becase <code>`Zip()</code> takes a directory only, so I could not give it multiple files (the sub-directory, the <code>state.tlog</code> and the console file). So it sits outside the directory it zips.</p>\n<blockquote>\n<p>Should we delete the directory after zipping it?</p>\n</blockquote>\n<p>That was the original and most intuitive way I tried. There were problems with it, which I tried to describe in the last paragraph of the PR description. I think it\u2019s cleaner to delete it, but we need to resolve the other directory problems, which comes down to whether we want to just overwrite things.</p>\n<blockquote>\n<p>Should we make zipping optional?</p>\n</blockquote>\n<p>I don\u2019t know the right answer to this. Zipping keeps the file smaller, but I don\u2019t know how big the file will end up after 1 hour run. If zipping takes forever, then maybe people don\u2019t want the program to run forever - they might want it to just terminate, and they can compress it themselves later.</p>\n<blockquote>\n<p>Should we support playing back directly from the zip file?</p>\n</blockquote>\n<p>This is already implemented in <code>LogPlayback::ExtractStateAndResources()</code>. For context, the <code>log</code> directory is only kept because of the directory overwrite problem above. It is not needed; <code>log.zip</code> file alone should already be sufficient for playback.</p>\n<blockquote>\n<p>Instead of loading the logged mesh, the simulation prints these errors:</p>\n</blockquote>\n<p>Does this have to do with the <code>model://</code> and <code>file://</code> differences? I still need to replace all <code>file</code> with <code>model</code>. I haven\u2019t done that yet.</p>", "type": "rendered"}, "created_on": "2019-09-12T05:40:29.987625+00:00", "user": {"display_name": "Mabel Zhang", "uuid": "{4b0e38fb-bf50-45c0-a496-61147518b2bf}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B4b0e38fb-bf50-45c0-a496-61147518b2bf%7D"}, "html": {"href": "https://bitbucket.org/%7B4b0e38fb-bf50-45c0-a496-61147518b2bf%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:ceb5942c-6843-408c-8550-3ce4899d299b/4d48e5ea-cf28-4fa7-9715-8fc9e315d831/128"}}, "nickname": "mabelmzhang", "type": "user", "account_id": "557058:ceb5942c-6843-408c-8550-3ce4899d299b"}, "updated_on": "2019-09-12T05:50:45.398423+00:00", "type": "pullrequest_comment", "id": 116596065}