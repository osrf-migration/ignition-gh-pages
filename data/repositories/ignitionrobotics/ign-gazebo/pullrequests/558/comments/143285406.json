{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/558/comments/143285406.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/558/_/diff#comment-143285406"}}, "parent": {"id": 142998879, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/558/comments/142998879.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/558/_/diff#comment-142998879"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 558, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/558.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/558"}}, "title": "Added support for removing sensors at runtime"}, "content": {"raw": "Bit of an update from my findings, the Destroy function is called [here](#!/ignitionrobotics/ign-sensors/src/d11378818fbeb223549c5881da415c9d7e3ee583/src/GpuLidarSensor.cc#lines-91) from the BaseStore class \\(as shown in the stack trace\\) and [here](#!/ignitionrobotics/ign-sensors/src/d11378818fbeb223549c5881da415c9d7e3ee583/src/GpuLidarSensor.cc#lines-93) \\(shared pointer reset\\(\\) call\\).\n\nA simple fix is to make sure that all the pointers get reset to nullptr \\(i.e. [here](#!/ignitionrobotics/ign-rendering/src/2b5ae0cbbf263958ddceb869f8b0441176ad905b/ogre2/src/Ogre2GpuRays.cc#lines-170), which is done already in the Ogre1 version [here](#!/ignitionrobotics/ign-rendering/src/2b5ae0cbbf263958ddceb869f8b0441176ad905b/ogre/src/OgreGpuRays.cc#lines-179)\\). **However!** This might fix the crash but it doesn\u2019t fix the root issue which is the destroy function being called twice \\(it just doesn\u2019t do anything in the second run\\).\n\nAlso while Ogre2 behaves OK with this fix Ogre1 still goes into random segmentation faults even when removing normal cameras, so this will be quite hairy to fix.", "markup": "markdown", "html": "<p>Bit of an update from my findings, the Destroy function is called <a data-is-external-link=\"true\" href=\"#!/ignitionrobotics/ign-sensors/src/d11378818fbeb223549c5881da415c9d7e3ee583/src/GpuLidarSensor.cc#lines-91\" rel=\"nofollow\">here</a> from the BaseStore class (as shown in the stack trace) and <a data-is-external-link=\"true\" href=\"#!/ignitionrobotics/ign-sensors/src/d11378818fbeb223549c5881da415c9d7e3ee583/src/GpuLidarSensor.cc#lines-93\" rel=\"nofollow\">here</a> (shared pointer reset() call).</p>\n<p>A simple fix is to make sure that all the pointers get reset to nullptr (i.e. <a data-is-external-link=\"true\" href=\"#!/ignitionrobotics/ign-rendering/src/2b5ae0cbbf263958ddceb869f8b0441176ad905b/ogre2/src/Ogre2GpuRays.cc#lines-170\" rel=\"nofollow\">here</a>, which is done already in the Ogre1 version <a data-is-external-link=\"true\" href=\"#!/ignitionrobotics/ign-rendering/src/2b5ae0cbbf263958ddceb869f8b0441176ad905b/ogre/src/OgreGpuRays.cc#lines-179\" rel=\"nofollow\">here</a>). <strong>However!</strong> This might fix the crash but it doesn\u2019t fix the root issue which is the destroy function being called twice (it just doesn\u2019t do anything in the second run).</p>\n<p>Also while Ogre2 behaves OK with this fix Ogre1 still goes into random segmentation faults even when removing normal cameras, so this will be quite hairy to fix.</p>", "type": "rendered"}, "created_on": "2020-04-02T09:36:44.499775+00:00", "user": {"display_name": "Luca Della Vedova", "uuid": "{dff01cd5-37c0-4865-84bc-7e6bc480a09c}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bdff01cd5-37c0-4865-84bc-7e6bc480a09c%7D"}, "html": {"href": "https://bitbucket.org/%7Bdff01cd5-37c0-4865-84bc-7e6bc480a09c%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/5b24bfc2f4a3853203ffffb2a97b47dbd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsLV-3.png"}}, "nickname": "luca_della_vedova", "type": "user", "account_id": "557058:798a6cdf-d171-444d-b8af-5d088f9feb2d"}, "updated_on": "2020-04-02T09:36:44.514898+00:00", "type": "pullrequest_comment", "id": 143285406}