{"pagelen": 50, "values": [{"update": {"description": "There is a potential for concurrent access to the internal view cache in the EntityComponentManager.  This adds protection from multiple threads updating views concurrently.", "title": "Add mutex to protect views from potential concurrent access", "destination": {"commit": {"hash": "2ff2b974cd61", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/2ff2b974cd61.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/2ff2b974cd61"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "ign-gazebo2"}}, "reason": "", "source": {"commit": {"hash": "dcdf69e5c269", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/dcdf69e5c269.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/dcdf69e5c269"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "protect_ecm_views"}}, "state": "MERGED", "author": {"display_name": "Michael Carroll", "uuid": "{17dbbc15-cbc0-42f0-a985-cde9061c78a0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D"}, "html": {"href": "https://bitbucket.org/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:65740f22-cc56-4418-9608-7e17d0ed47b7/2aa259f5-4de1-4f68-9156-eded72041d84/128"}}, "nickname": "Michael Carroll", "type": "user", "account_id": "557058:65740f22-cc56-4418-9608-7e17d0ed47b7"}, "date": "2019-10-08T23:28:25.948615+00:00"}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}, {"approval": {"date": "2019-10-08T21:43:40.413441+00:00", "pullrequest": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}, "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}, {"approval": {"date": "2019-10-08T21:35:30.799289+00:00", "pullrequest": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}, "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}, {"comment": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435/comments/119970140.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435/_/diff#comment-119970140"}}, "parent": {"id": 119965293, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435/comments/119965293.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435/_/diff#comment-119965293"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}, "content": {"raw": "The failing tests are known to fail on macOS. Approving!", "markup": "markdown", "html": "<p>The failing tests are known to fail on macOS. Approving!</p>", "type": "rendered"}, "created_on": "2019-10-08T21:34:47.856042+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2019-10-08T21:34:47.866030+00:00", "type": "pullrequest_comment", "id": 119970140}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}, {"comment": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435/comments/119965293.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435/_/diff#comment-119965293"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}, "content": {"raw": "I'm rerunning the macOS build. I think Ultron was lot logged in when this build ran.\n  \n[![Build Status](https://build.osrfoundation.org/job/ignition_gazebo-ci-pr_any-homebrew-amd64/2006/badge/icon)](https://build.osrfoundation.org/job/ignition_gazebo-ci-pr_any-homebrew-amd64/2006/)", "markup": "markdown", "html": "<p>I'm rerunning the macOS build. I think Ultron was lot logged in when this build ran.</p>\n<p><a data-is-external-link=\"true\" href=\"https://build.osrfoundation.org/job/ignition_gazebo-ci-pr_any-homebrew-amd64/2006/\" rel=\"nofollow\"><img alt=\"Build Status\" src=\"https://build.osrfoundation.org/job/ignition_gazebo-ci-pr_any-homebrew-amd64/2006/badge/icon\" /></a></p>", "type": "rendered"}, "created_on": "2019-10-08T20:45:32.679303+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2019-10-08T20:45:32.689562+00:00", "type": "pullrequest_comment", "id": 119965293}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}, {"update": {"description": "There is a potential for concurrent access to the internal view cache in the EntityComponentManager.  This adds protection from multiple threads updating views concurrently.", "title": "Add mutex to protect views from potential concurrent access", "destination": {"commit": {"hash": "2ff2b974cd61", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/2ff2b974cd61.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/2ff2b974cd61"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "ign-gazebo2"}}, "reason": "", "source": {"commit": {"hash": "dcdf69e5c269", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/dcdf69e5c269.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/dcdf69e5c269"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "protect_ecm_views"}}, "state": "OPEN", "author": {"display_name": "Michael Carroll", "uuid": "{17dbbc15-cbc0-42f0-a985-cde9061c78a0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D"}, "html": {"href": "https://bitbucket.org/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:65740f22-cc56-4418-9608-7e17d0ed47b7/2aa259f5-4de1-4f68-9156-eded72041d84/128"}}, "nickname": "Michael Carroll", "type": "user", "account_id": "557058:65740f22-cc56-4418-9608-7e17d0ed47b7"}, "date": "2019-10-08T15:45:05.688806+00:00"}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}, {"update": {"description": "There is a potential for concurrent access to the internal view cache in the EntityComponentManager.  This adds protection from multiple threads updating views concurrently.", "title": "Add mutex to protect views from potential concurrent access", "destination": {"commit": {"hash": "2ff2b974cd61", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/2ff2b974cd61.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/2ff2b974cd61"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "ign-gazebo2"}}, "reason": "", "source": {"commit": {"hash": "1640fd71691e", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/1640fd71691e.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/1640fd71691e"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "protect_ecm_views"}}, "state": "OPEN", "author": {"display_name": "Michael Carroll", "uuid": "{17dbbc15-cbc0-42f0-a985-cde9061c78a0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D"}, "html": {"href": "https://bitbucket.org/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:65740f22-cc56-4418-9608-7e17d0ed47b7/2aa259f5-4de1-4f68-9156-eded72041d84/128"}}, "nickname": "Michael Carroll", "type": "user", "account_id": "557058:65740f22-cc56-4418-9608-7e17d0ed47b7"}, "date": "2019-10-08T15:43:51.593532+00:00"}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}, {"comment": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435/comments/119922620.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435/_/diff#comment-119922620"}}, "parent": {"id": 119916735, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435/comments/119916735.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435/_/diff#comment-119916735"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}, "content": {"raw": "I agree that we aren\u2019t thread safe in the ECM.  My concern with trying to make that happen in the PostUpdates is that the mutex will be stored away from the data and it will be a bit more difficult to reason about to guarantee thread safety.\n\nI agree with reducing the scope of the locking to only the `FindView` and `AddView`, which is consistent with the backtrace that Alfredo saw.", "markup": "markdown", "html": "<p>I agree that we aren\u2019t thread safe in the ECM.  My concern with trying to make that happen in the PostUpdates is that the mutex will be stored away from the data and it will be a bit more difficult to reason about to guarantee thread safety.</p>\n<p>I agree with reducing the scope of the locking to only the <code>FindView</code> and <code>AddView</code>, which is consistent with the backtrace that Alfredo saw.</p>", "type": "rendered"}, "created_on": "2019-10-08T15:35:17.972178+00:00", "user": {"display_name": "Michael Carroll", "uuid": "{17dbbc15-cbc0-42f0-a985-cde9061c78a0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D"}, "html": {"href": "https://bitbucket.org/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:65740f22-cc56-4418-9608-7e17d0ed47b7/2aa259f5-4de1-4f68-9156-eded72041d84/128"}}, "nickname": "Michael Carroll", "type": "user", "account_id": "557058:65740f22-cc56-4418-9608-7e17d0ed47b7"}, "updated_on": "2019-10-08T15:35:17.993257+00:00", "type": "pullrequest_comment", "id": 119922620}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}, {"comment": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435/comments/119916735.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435/_/diff#comment-119916735"}}, "parent": {"id": 119736371, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435/comments/119736371.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435/_/diff#comment-119736371"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}, "content": {"raw": "@{557058:65740f22-cc56-4418-9608-7e17d0ed47b7} , what do you think about this suggestion?", "markup": "markdown", "html": "<p><span class=\"ap-mention\" data-atlassian-id=\"557058:65740f22-cc56-4418-9608-7e17d0ed47b7\">@Michael Carroll</span> , what do you think about this suggestion?</p>", "type": "rendered"}, "created_on": "2019-10-08T15:07:34.193660+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "updated_on": "2019-10-08T15:07:34.222637+00:00", "type": "pullrequest_comment", "id": 119916735}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}, {"comment": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435/comments/119736371.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435/_/diff#comment-119736371"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}, "content": {"raw": "Here's my opinion: I don't believe the ECM is generally thread safe. By that I mean, if we allowed concurrent access to the ECM in any of the `*Update` steps of systems, we would have a number of race conditions. So, I think the best thing to do right now is to keep only the `PostUpdate` step thread safe. With that being said, I believe this PR helps achieve thread safety in `PostUpdate`, but I think the `viewsMutex` is locked in more places than necessary. I think we only need to lock it in `FindView` and `AddView`. The other places it is locked (`ClearNewlyCreatedEntities`, `ProcessRemoveEntityRequests`, `UpdateViews`, `RebuildViews`) don't seem to be necessary right now because they should not get called in the `PostUpdate` step.\n\nWith this line of reasoning, I would say `entityRemoveMutex` and `entityCreatedMutex` are not necessary either until we tackle thread safety in general. But that's probably a discussion for another time. Thoughts?", "markup": "markdown", "html": "<p>Here's my opinion: I don't believe the ECM is generally thread safe. By that I mean, if we allowed concurrent access to the ECM in any of the <code>*Update</code> steps of systems, we would have a number of race conditions. So, I think the best thing to do right now is to keep only the <code>PostUpdate</code> step thread safe. With that being said, I believe this PR helps achieve thread safety in <code>PostUpdate</code>, but I think the <code>viewsMutex</code> is locked in more places than necessary. I think we only need to lock it in <code>FindView</code> and <code>AddView</code>. The other places it is locked (<code>ClearNewlyCreatedEntities</code>, <code>ProcessRemoveEntityRequests</code>, <code>UpdateViews</code>, <code>RebuildViews</code>) don't seem to be necessary right now because they should not get called in the <code>PostUpdate</code> step.</p>\n<p>With this line of reasoning, I would say <code>entityRemoveMutex</code> and <code>entityCreatedMutex</code> are not necessary either until we tackle thread safety in general. But that's probably a discussion for another time. Thoughts?</p>", "type": "rendered"}, "created_on": "2019-10-07T15:02:44.708639+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2019-10-07T15:03:10.490770+00:00", "type": "pullrequest_comment", "id": 119736371}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}, {"update": {"description": "There is a potential for concurrent access to the internal view cache in the EntityComponentManager.  This adds protection from multiple threads updating views concurrently.", "title": "Add mutex to protect views from potential concurrent access", "destination": {"commit": {"hash": "2ff2b974cd61", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/2ff2b974cd61.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/2ff2b974cd61"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "ign-gazebo2"}}, "reason": "", "source": {"commit": {"hash": "0a763d26bbf3", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/0a763d26bbf3.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/0a763d26bbf3"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "protect_ecm_views"}}, "state": "OPEN", "author": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "date": "2019-10-07T14:17:58.614950+00:00"}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}, {"comment": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435/comments/118863198.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435/_/diff#comment-118863198"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}, "content": {"raw": "I think there is also a potential for this iterator to be invalidated by another view being inserted.  I haven\u2019t seen any backtraces that indicate this happening, so far, though.", "markup": "markdown", "html": "<p>I think there is also a potential for this iterator to be invalidated by another view being inserted.  I haven\u2019t seen any backtraces that indicate this happening, so far, though.</p>", "type": "rendered"}, "created_on": "2019-09-30T15:08:19.577358+00:00", "user": {"display_name": "Michael Carroll", "uuid": "{17dbbc15-cbc0-42f0-a985-cde9061c78a0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D"}, "html": {"href": "https://bitbucket.org/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:65740f22-cc56-4418-9608-7e17d0ed47b7/2aa259f5-4de1-4f68-9156-eded72041d84/128"}}, "nickname": "Michael Carroll", "type": "user", "account_id": "557058:65740f22-cc56-4418-9608-7e17d0ed47b7"}, "inline": {}, "updated_on": "2019-09-30T15:08:19.590014+00:00", "type": "pullrequest_comment", "id": 118863198}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}, {"update": {"description": "There is a potential for concurrent access to the internal view cache in the EntityComponentManager.  This adds protection from multiple threads updating views concurrently.", "title": "Add mutex to protect views from potential concurrent access", "destination": {"commit": {"hash": "890e28ea75d0", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/890e28ea75d0.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/890e28ea75d0"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "ign-gazebo2"}}, "reason": "", "source": {"commit": {"hash": "5a9e5e53dd1c", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/5a9e5e53dd1c.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/5a9e5e53dd1c"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "protect_ecm_views"}}, "state": "OPEN", "author": {"display_name": "Michael Carroll", "uuid": "{17dbbc15-cbc0-42f0-a985-cde9061c78a0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D"}, "html": {"href": "https://bitbucket.org/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:65740f22-cc56-4418-9608-7e17d0ed47b7/2aa259f5-4de1-4f68-9156-eded72041d84/128"}}, "nickname": "Michael Carroll", "type": "user", "account_id": "557058:65740f22-cc56-4418-9608-7e17d0ed47b7"}, "date": "2019-09-30T15:07:17.589098+00:00"}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}, {"update": {"description": "There is a potential for concurrent access to the internal view cache in the EntityComponentManager.  This adds protection from multiple threads updating views concurrently.", "title": "Add mutex to protect views from potential concurrent access", "destination": {"commit": {"hash": "890e28ea75d0", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/890e28ea75d0.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/890e28ea75d0"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "ign-gazebo2"}}, "reason": "", "source": {"commit": {"hash": "5a9e5e53dd1c", "type": "commit", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/commit/5a9e5e53dd1c.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/commits/5a9e5e53dd1c"}}}, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "branch": {"name": "protect_ecm_views"}}, "state": "OPEN", "author": {"display_name": "Michael Carroll", "uuid": "{17dbbc15-cbc0-42f0-a985-cde9061c78a0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D"}, "html": {"href": "https://bitbucket.org/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:65740f22-cc56-4418-9608-7e17d0ed47b7/2aa259f5-4de1-4f68-9156-eded72041d84/128"}}, "nickname": "Michael Carroll", "type": "user", "account_id": "557058:65740f22-cc56-4418-9608-7e17d0ed47b7"}, "date": "2019-09-30T15:07:17.481306+00:00"}, "pull_request": {"type": "pullrequest", "id": 435, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/435.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/435"}}, "title": "Add mutex to protect views from potential concurrent access"}}]}