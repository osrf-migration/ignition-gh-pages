{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/62/comments/79320434.json"}, "code": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-gazebo/diff/ignitionrobotics/ign-gazebo:ab020bc83e73..14a619f929f7?path=src%2FSimulationRunner.cc"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/62/_/diff#comment-79320434"}}, "parent": {"id": 79316706, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/62/comments/79316706.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/62/_/diff#comment-79316706"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 62, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/62.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/62"}}, "title": "Erase entity [Ready for review]"}, "content": {"raw": "So I _think_ what\u2019s happening is:\n\n* The entity is scheduled for removal\n* The entity is removed from the entity component manager\n* All components associated with the entity are removed by swapping them to the end of their corresponding storage vector and then popping them off\n* Any View that contains the entity has the EraseEntity method called on it, and removes the entity from it\u2019s internal set, as well as pointers to Components.\n\nThe issue is not with the removed entity/components, but the one that is swapped into that location.  The view is storing a `void *` to the previous location of the component, and it never gets updated \\(probably should happen in `View::EraseEntity`?\\), causing it to point to something off the end of the ComponentStorage internal vector.\n\nI\u2019ll try and work on a fix, but if you get a chance @nkoenig can you confirm that my understanding of the behvavior is correct?", "markup": "markdown", "html": "<p>So I <em>think</em> what\u2019s happening is:</p>\n<ul>\n<li>The entity is scheduled for removal</li>\n<li>The entity is removed from the entity component manager</li>\n<li>All components associated with the entity are removed by swapping them to the end of their corresponding storage vector and then popping them off</li>\n<li>Any View that contains the entity has the EraseEntity method called on it, and removes the entity from it\u2019s internal set, as well as pointers to Components.</li>\n</ul>\n<p>The issue is not with the removed entity/components, but the one that is swapped into that location.  The view is storing a <code>void *</code> to the previous location of the component, and it never gets updated (probably should happen in <code>View::EraseEntity</code>?), causing it to point to something off the end of the ComponentStorage internal vector.</p>\n<p>I\u2019ll try and work on a fix, but if you get a chance @nkoenig can you confirm that my understanding of the behvavior is correct?</p>", "type": "rendered"}, "created_on": "2018-10-17T03:37:55.532207+00:00", "user": {"display_name": "Michael Carroll", "uuid": "{17dbbc15-cbc0-42f0-a985-cde9061c78a0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D"}, "html": {"href": "https://bitbucket.org/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:65740f22-cc56-4418-9608-7e17d0ed47b7/2aa259f5-4de1-4f68-9156-eded72041d84/128"}}, "nickname": "Michael Carroll", "type": "user", "account_id": "557058:65740f22-cc56-4418-9608-7e17d0ed47b7"}, "inline": {"to": null, "from": 586, "outdated": true, "path": "src/SimulationRunner.cc"}, "updated_on": "2018-10-17T03:37:55.545819+00:00", "type": "pullrequest_comment", "id": 79320434}