{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/507/comments/134495217.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/507/_/diff#comment-134495217"}}, "parent": {"id": 134314666, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/507/comments/134314666.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/507/_/diff#comment-134314666"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 507, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/507.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/507"}}, "title": "Add GUI to configure grid"}, "content": {"raw": "I\u2019m testing the committed changes. I observed a slightly longer \\(~2s\\) \"black window\u201c time in the start up when scene is getting generated. I experienced one crash which trace back to\n\n```shell\n/home/claire/blueprint_ws/install/lib/ign-gazebo-2/plugins/gui/libGzScene3D.so(_ZN8ignition6gazebo2v212RenderThread8ShutDownEv+0x2e) \n[0x7f46dccaa6be] /home/claire/blueprint_ws/src/ign-gazebo/src/gui/plugins/scene3d/Scene3D.cc:1005\n```\n\n```c++\nvoid RenderThread::ShutDown()\n{\n  this->context->makeCurrent(this->surface);\n\n  this->ignRenderer.Destroy();\n\n  this->context->doneCurrent(); // Scene3D.cc: 1005, error traceback line\n  delete this->context;\n\n  // schedule this to be deleted only after we're done cleaning up\n  this->surface->deleteLater();\n\n  // Stop event processing, move the thread to GUI and make sure it is deleted.\n  this->moveToThread(QGuiApplication::instance()->thread());\n}\n```\n\nand one `mutex` related error message after closing the GUI window.\n\n```\nruby: /usr/include/boost/thread/pthread/recursive_mutex.hpp:113: \nvoid boost::recursive_mutex::lock(): Assertion `!pthread_mutex_lock(&m)' failed.\n```\n\nThe above errors are happening no matter if grid is enabled and disabled in sdf file.\n\nHowever, if the grid is not set in the sdf file \\(no <grid>\\). Grid is enabled by default. Another error pops up and seems to be related to threading.\n\n```shell\n/home/claire/blueprint_ws/install/lib/ign-gazebo-2/plugins/gui/libGzScene3D.so(_ZN8ignition6gazebo2v212RenderThread8ShutDownEv+0x55) \n[0x7fee214ab6e5] /home/claire/blueprint_ws/src/ign-gazebo/src/gui/plugins/scene3d/Scene3D.cc:1012\n```\n\n```c++\nvoid RenderThread::ShutDown()\n{\n  this->context->makeCurrent(this->surface);\n\n  this->ignRenderer.Destroy();\n\n  this->context->doneCurrent();\n  delete this->context;\n\n  // schedule this to be deleted only after we're done cleaning up\n  this->surface->deleteLater();\n\n  // Stop event processing, move the thread to GUI and make sure it is deleted.\n  this->moveToThread(QGuiApplication::instance()->thread()); // Scene3D.cc: 1012, error traceback line \n}\n```\n\n\u200c", "markup": "markdown", "html": "<p>I\u2019m testing the committed changes. I observed a slightly longer (~2s) \"black window\u201c time in the start up when scene is getting generated. I experienced one crash which trace back to</p>\n<div class=\"codehilite language-shell\"><pre><span></span>/home/claire/blueprint_ws/install/lib/ign-gazebo-2/plugins/gui/libGzScene3D.so<span class=\"o\">(</span>_ZN8ignition6gazebo2v212RenderThread8ShutDownEv+0x2e<span class=\"o\">)</span> \n<span class=\"o\">[</span>0x7f46dccaa6be<span class=\"o\">]</span> /home/claire/blueprint_ws/src/ign-gazebo/src/gui/plugins/scene3d/Scene3D.cc:1005\n</pre></div>\n\n\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"kt\">void</span> <span class=\"n\">RenderThread</span><span class=\"o\">::</span><span class=\"n\">ShutDown</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>\n  <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">context</span><span class=\"o\">-&gt;</span><span class=\"n\">makeCurrent</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">surface</span><span class=\"p\">);</span>\n\n  <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">ignRenderer</span><span class=\"p\">.</span><span class=\"n\">Destroy</span><span class=\"p\">();</span>\n\n  <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">context</span><span class=\"o\">-&gt;</span><span class=\"n\">doneCurrent</span><span class=\"p\">();</span> <span class=\"c1\">// Scene3D.cc: 1005, error traceback line</span>\n  <span class=\"k\">delete</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">context</span><span class=\"p\">;</span>\n\n  <span class=\"c1\">// schedule this to be deleted only after we&#39;re done cleaning up</span>\n  <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">surface</span><span class=\"o\">-&gt;</span><span class=\"n\">deleteLater</span><span class=\"p\">();</span>\n\n  <span class=\"c1\">// Stop event processing, move the thread to GUI and make sure it is deleted.</span>\n  <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">moveToThread</span><span class=\"p\">(</span><span class=\"n\">QGuiApplication</span><span class=\"o\">::</span><span class=\"n\">instance</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"kr\">thread</span><span class=\"p\">());</span>\n<span class=\"p\">}</span>\n</pre></div>\n\n\n<p>and one <code>mutex</code> related error message after closing the GUI window.</p>\n<div class=\"codehilite\"><pre><span></span>ruby: /usr/include/boost/thread/pthread/recursive_mutex.hpp:113: \nvoid boost::recursive_mutex::lock(): Assertion `!pthread_mutex_lock(&amp;m)&#39; failed.\n</pre></div>\n\n\n<p>The above errors are happening no matter if grid is enabled and disabled in sdf file.</p>\n<p>However, if the grid is not set in the sdf file (no &lt;grid&gt;). Grid is enabled by default. Another error pops up and seems to be related to threading.</p>\n<div class=\"codehilite language-shell\"><pre><span></span>/home/claire/blueprint_ws/install/lib/ign-gazebo-2/plugins/gui/libGzScene3D.so<span class=\"o\">(</span>_ZN8ignition6gazebo2v212RenderThread8ShutDownEv+0x55<span class=\"o\">)</span> \n<span class=\"o\">[</span>0x7fee214ab6e5<span class=\"o\">]</span> /home/claire/blueprint_ws/src/ign-gazebo/src/gui/plugins/scene3d/Scene3D.cc:1012\n</pre></div>\n\n\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"kt\">void</span> <span class=\"n\">RenderThread</span><span class=\"o\">::</span><span class=\"n\">ShutDown</span><span class=\"p\">()</span>\n<span class=\"p\">{</span>\n  <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">context</span><span class=\"o\">-&gt;</span><span class=\"n\">makeCurrent</span><span class=\"p\">(</span><span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">surface</span><span class=\"p\">);</span>\n\n  <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">ignRenderer</span><span class=\"p\">.</span><span class=\"n\">Destroy</span><span class=\"p\">();</span>\n\n  <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">context</span><span class=\"o\">-&gt;</span><span class=\"n\">doneCurrent</span><span class=\"p\">();</span>\n  <span class=\"k\">delete</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">context</span><span class=\"p\">;</span>\n\n  <span class=\"c1\">// schedule this to be deleted only after we&#39;re done cleaning up</span>\n  <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">surface</span><span class=\"o\">-&gt;</span><span class=\"n\">deleteLater</span><span class=\"p\">();</span>\n\n  <span class=\"c1\">// Stop event processing, move the thread to GUI and make sure it is deleted.</span>\n  <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">moveToThread</span><span class=\"p\">(</span><span class=\"n\">QGuiApplication</span><span class=\"o\">::</span><span class=\"n\">instance</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"kr\">thread</span><span class=\"p\">());</span> <span class=\"c1\">// Scene3D.cc: 1012, error traceback line </span>\n<span class=\"p\">}</span>\n</pre></div>\n\n\n<p>\u200c</p>", "type": "rendered"}, "created_on": "2020-02-04T22:20:51.622659+00:00", "user": {"display_name": "Claire Wang", "uuid": "{4b4ab2f2-8148-463e-a671-2eed1e6ccd42}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B4b4ab2f2-8148-463e-a671-2eed1e6ccd42%7D"}, "html": {"href": "https://bitbucket.org/%7B4b4ab2f2-8148-463e-a671-2eed1e6ccd42%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/5d3f35705e485d0dab01c896/a44642e6-28d8-4727-b9cc-b4c18e91d167/128"}}, "nickname": "Claire Wang", "type": "user", "account_id": "5d3f35705e485d0dab01c896"}, "updated_on": "2020-02-05T00:09:02.897473+00:00", "type": "pullrequest_comment", "id": 134495217}