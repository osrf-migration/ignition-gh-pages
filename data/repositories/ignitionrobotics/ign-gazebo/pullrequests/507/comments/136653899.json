{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/507/comments/136653899.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/507/_/diff#comment-136653899"}}, "parent": {"id": 134495217, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/507/comments/134495217.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/507/_/diff#comment-134495217"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 507, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/507.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/507"}}, "title": "Add GUI to configure grid"}, "content": {"raw": "Aside from the above two crashes related to `renderthread shutdown` , I also got another seg fault while updating `gridptr` related features. This seg fault shuts down the grid simulation window and interferes with the grid update process.\n\n```\nThread 18 \"ignition::gazeb\" received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7fff97597700 (LWP 8513)]\n0x00007ffff170fdf0 in QObject::thread() const ()\n   from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(0x7ffff170fdf0) [0x7ffff170fdf0]\n/home/claire/blueprint_ws/install/lib/ign-gazebo-2/plugins/gui/libGzScene3D.so(_ZN8ignition6gazebo2v212RenderThread8ShutDownEv+0x55) [0x7fffac59f455]\n/home/claire/blueprint_ws/src/ign-gazebo/src/gui/plugins/scene3d/Scene3D.cc:1253\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN7QObject5eventEP6QEvent+0xe2) [0x7ffff17130c2]\n```\n\nRelated code block\n\n```\n/////////////////////////////////////////////////\nvoid RenderThread::ShutDown()\n{\n  this->context->makeCurrent(this->surface);\n\n  this->ignRenderer.Destroy();\n\n  this->context->doneCurrent();\n  delete this->context;\n\n  // schedule this to be deleted only after we're done cleaning up\n  this->surface->deleteLater();\n\n  // Stop event processing, move the thread to GUI and make sure it is deleted.\n  this->moveToThread(QGuiApplication::instance()->thread()); // seg fault backtrace line\n}\n```\n\n\u200c", "markup": "markdown", "html": "<p>Aside from the above two crashes related to <code>renderthread shutdown</code> , I also got another seg fault while updating <code>gridptr</code> related features. This seg fault shuts down the grid simulation window and interferes with the grid update process.</p>\n<div class=\"codehilite\"><pre><span></span>Thread 18 &quot;ignition::gazeb&quot; received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7fff97597700 (LWP 8513)]\n0x00007ffff170fdf0 in QObject::thread() const ()\n   from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(0x7ffff170fdf0) [0x7ffff170fdf0]\n/home/claire/blueprint_ws/install/lib/ign-gazebo-2/plugins/gui/libGzScene3D.so(_ZN8ignition6gazebo2v212RenderThread8ShutDownEv+0x55) [0x7fffac59f455]\n/home/claire/blueprint_ws/src/ign-gazebo/src/gui/plugins/scene3d/Scene3D.cc:1253\n/usr/lib/x86_64-linux-gnu/libQt5Core.so.5(_ZN7QObject5eventEP6QEvent+0xe2) [0x7ffff17130c2]\n</pre></div>\n\n\n<p>Related code block</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"o\">/////////////////////////////////////////////////</span>\n<span class=\"nt\">void</span> <span class=\"nt\">RenderThread</span><span class=\"p\">::</span><span class=\"nd\">ShutDown</span><span class=\"o\">()</span>\n<span class=\"p\">{</span>\n  <span class=\"err\">this-&gt;context-&gt;makeCurrent(this-&gt;surface)</span><span class=\"p\">;</span>\n\n  <span class=\"err\">this-&gt;ignRenderer.Destroy()</span><span class=\"p\">;</span>\n\n  <span class=\"err\">this-&gt;context-&gt;doneCurrent()</span><span class=\"p\">;</span>\n  <span class=\"err\">delete</span> <span class=\"err\">this-&gt;context</span><span class=\"p\">;</span>\n\n  <span class=\"err\">//</span> <span class=\"err\">schedule</span> <span class=\"err\">this</span> <span class=\"err\">to</span> <span class=\"err\">be</span> <span class=\"err\">deleted</span> <span class=\"err\">only</span> <span class=\"err\">after</span> <span class=\"err\">we&#39;re</span> <span class=\"err\">done</span> <span class=\"err\">cleaning</span> <span class=\"err\">up</span>\n  <span class=\"err\">this-&gt;surface-&gt;deleteLater()</span><span class=\"p\">;</span>\n\n  <span class=\"err\">//</span> <span class=\"err\">Stop</span> <span class=\"err\">event</span> <span class=\"err\">processing,</span> <span class=\"err\">move</span> <span class=\"err\">the</span> <span class=\"err\">thread</span> <span class=\"err\">to</span> <span class=\"err\">GUI</span> <span class=\"err\">and</span> <span class=\"err\">make</span> <span class=\"err\">sure</span> <span class=\"err\">it</span> <span class=\"err\">is</span> <span class=\"err\">deleted.</span>\n  <span class=\"err\">this-&gt;moveToThread(</span><span class=\"n\">QGuiApplication</span><span class=\"p\">:</span><span class=\"o\">:</span><span class=\"nf\">instance</span><span class=\"p\">()</span><span class=\"o\">-&gt;</span><span class=\"nf\">thread</span><span class=\"p\">());</span> <span class=\"err\">//</span> <span class=\"err\">seg</span> <span class=\"err\">fault</span> <span class=\"err\">backtrace</span> <span class=\"err\">line</span>\n<span class=\"p\">}</span>\n</pre></div>\n\n\n<p>\u200c</p>", "type": "rendered"}, "created_on": "2020-02-19T18:53:33.701666+00:00", "user": {"display_name": "Claire Wang", "uuid": "{4b4ab2f2-8148-463e-a671-2eed1e6ccd42}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B4b4ab2f2-8148-463e-a671-2eed1e6ccd42%7D"}, "html": {"href": "https://bitbucket.org/%7B4b4ab2f2-8148-463e-a671-2eed1e6ccd42%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/5d3f35705e485d0dab01c896/a44642e6-28d8-4727-b9cc-b4c18e91d167/128"}}, "nickname": "Claire Wang", "type": "user", "account_id": "5d3f35705e485d0dab01c896"}, "updated_on": "2020-02-19T18:55:20.117884+00:00", "type": "pullrequest_comment", "id": 136653899}