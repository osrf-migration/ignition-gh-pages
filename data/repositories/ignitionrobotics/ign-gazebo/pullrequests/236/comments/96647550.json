{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/236/comments/96647550.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/236/_/diff#comment-96647550"}}, "parent": {"id": 96642354, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/236/comments/96642354.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/236/_/diff#comment-96642354"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 236, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/236.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/236"}}, "title": "[Acropolis] Enforce component type uniqueness"}, "content": {"raw": "I'm able to reproduce the segfault locally. I did a build where all the dependencies came from debs.\n\nHere's the backtrace. \n```\n#0  0x00007ffff75b0284 in ignition::gazebo::v1::SimulationRunner::UpdateSystems (this=0x55555636cac0) at /home/addisu/ws/ign-gazebo/src/ign_gazebo/src/SimulationRunner.cc:300\n#1  0x00007ffff75b163d in ignition::gazebo::v1::SimulationRunner::Run (this=0x55555636cac0, _iterations=100) at /home/addisu/ws/ign-gazebo/src/ign_gazebo/src/SimulationRunner.cc:440\n#2  0x00007ffff7593c2e in ignition::gazebo::v1::ServerPrivate::Run (this=0x555555aab480, _iterations=100, _cond=std::optional<std::condition_variable *> [no contained value]) at /home/addisu/ws/ign-gazebo/src/ign_gazebo/src/ServerPrivate.cc:114\n#3  0x00007ffff7581062 in ignition::gazebo::v1::Server::Run (this=0x555555923300, _blocking=true, _iterations=100, _paused=false) at /home/addisu/ws/ign-gazebo/src/ign_gazebo/src/Server.cc:221\n#4  0x00005555555d9cf9 in TouchPluginTest_SpawnedEntities_Test::<lambda(const string&, const string&)>::operator()(const std::__cxx11::string &, const std::__cxx11::string &) const (__closure=0x7fffffffd1d0,\n    _box1=\"\\n  <?xml version=\\\"1.0\\\" ?>\\n  <sdf version=\\\"1.6\\\">\\n      <model name=\\\"white_box\\\">\\n        <pose>0 0 4 0 0 0</pose>\\n        <link name=\\\"link\\\">\\n          <collision name=\\\"collision\\\">\\n\", ' ' <repeats 12 times>, \"<geometry>\"...,\n    _box2=\"\\n  <?xml version=\\\"1.0\\\" ?>\\n  <sdf version=\\\"1.6\\\">\\n      <model name=\\\"green_box_for_white\\\">\\n        <static>1</static>\\n        <pose>0 0 0.5 0 0 0</pose>\\n        <link name=\\\"link\\\">\\n          <collision n\"...)\n    at /home/addisu/ws/ign-gazebo/src/ign_gazebo/test/integration/touch_plugin.cc:307\n#5  0x00005555555db602 in TouchPluginTest_SpawnedEntities_Test::TestBody (this=0x55555593a790) at /home/addisu/ws/ign-gazebo/src/ign_gazebo/test/integration/touch_plugin.cc:338\n#6  0x00005555556610e4 in testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void> (object=0x55555593a790, method=&virtual testing::Test::TestBody(), location=0x55555567fe4b \"the test body\") at ../../test/gtest/src/gtest.cc:2079\n#7  0x0000555555655a33 in testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void> (object=0x55555593a790, method=&virtual testing::Test::TestBody(), location=0x55555567fe4b \"the test body\") at ../../test/gtest/src/gtest.cc:2115\n#8  0x00005555556190cc in testing::Test::Run (this=0x55555593a790) at ../../test/gtest/src/gtest.cc:2151\n#9  0x000055555561a3a6 in testing::TestInfo::Run (this=0x555555a464a0) at ../../test/gtest/src/gtest.cc:2327\n#10 0x000055555561b08b in testing::TestCase::Run (this=0x555555a228b0) at ../../test/gtest/src/gtest.cc:2445\n#11 0x000055555562ad09 in testing::internal::UnitTestImpl::RunAllTests (this=0x55555595ed20) at ../../test/gtest/src/gtest.cc:4316\n#12 0x000055555566341f in testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool> (object=0x55555595ed20,\n    method=(bool (testing::internal::UnitTestImpl::*)(testing::internal::UnitTestImpl * const)) 0x55555562a792 <testing::internal::UnitTestImpl::RunAllTests() at ../../test/gtest/src/gtest.cc:4223>,\n    location=0x555555680658 \"auxiliary test code (environments or event listeners)\") at ../../test/gtest/src/gtest.cc:2079\n#13 0x0000555555657bb3 in testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool> (object=0x55555595ed20,\n    method=(bool (testing::internal::UnitTestImpl::*)(testing::internal::UnitTestImpl * const)) 0x55555562a792 <testing::internal::UnitTestImpl::RunAllTests() at ../../test/gtest/src/gtest.cc:4223>,\n    location=0x555555680658 \"auxiliary test code (environments or event listeners)\") at ../../test/gtest/src/gtest.cc:2115\n#14 0x000055555562822f in testing::UnitTest::Run (this=0x5555558f2e00 <testing::UnitTest::GetInstance()::instance>) at ../../test/gtest/src/gtest.cc:3927\n#15 0x000055555567b0c6 in RUN_ALL_TESTS () at ../../test/gtest/include/gtest/gtest.h:2288\n#16 0x000055555567af7c in main (argc=1, argv=0x7fffffffd788) at /home/addisu/ws/ign-gazebo/src/ign_gazebo/test/gtest/src/gtest_main.cc:37\n```\n\nIt looks like the same problem as the homebrew segfault where the system pointer is corrupt.\n```\n297       {\n298         IGN_PROFILE(\"PreUpdate\");\n299         for (auto& system : this->systemsPreupdate)\n300           system->PreUpdate(this->currentInfo, this->entityCompMgr);\n301       }\n```\n", "markup": "markdown", "html": "<p>I'm able to reproduce the segfault locally. I did a build where all the dependencies came from debs.</p>\n<p>Here's the backtrace. </p>\n<div class=\"codehilite\"><pre><span></span>#0  0x00007ffff75b0284 in ignition::gazebo::v1::SimulationRunner::UpdateSystems (this=0x55555636cac0) at /home/addisu/ws/ign-gazebo/src/ign_gazebo/src/SimulationRunner.cc:300\n#1  0x00007ffff75b163d in ignition::gazebo::v1::SimulationRunner::Run (this=0x55555636cac0, _iterations=100) at /home/addisu/ws/ign-gazebo/src/ign_gazebo/src/SimulationRunner.cc:440\n#2  0x00007ffff7593c2e in ignition::gazebo::v1::ServerPrivate::Run (this=0x555555aab480, _iterations=100, _cond=std::optional&lt;std::condition_variable *&gt; [no contained value]) at /home/addisu/ws/ign-gazebo/src/ign_gazebo/src/ServerPrivate.cc:114\n#3  0x00007ffff7581062 in ignition::gazebo::v1::Server::Run (this=0x555555923300, _blocking=true, _iterations=100, _paused=false) at /home/addisu/ws/ign-gazebo/src/ign_gazebo/src/Server.cc:221\n#4  0x00005555555d9cf9 in TouchPluginTest_SpawnedEntities_Test::&lt;lambda(const string&amp;, const string&amp;)&gt;::operator()(const std::__cxx11::string &amp;, const std::__cxx11::string &amp;) const (__closure=0x7fffffffd1d0,\n    _box1=&quot;\\n  &lt;?xml version=\\&quot;1.0\\&quot; ?&gt;\\n  &lt;sdf version=\\&quot;1.6\\&quot;&gt;\\n      &lt;model name=\\&quot;white_box\\&quot;&gt;\\n        &lt;pose&gt;0 0 4 0 0 0&lt;/pose&gt;\\n        &lt;link name=\\&quot;link\\&quot;&gt;\\n          &lt;collision name=\\&quot;collision\\&quot;&gt;\\n&quot;, &#39; &#39; &lt;repeats 12 times&gt;, &quot;&lt;geometry&gt;&quot;...,\n    _box2=&quot;\\n  &lt;?xml version=\\&quot;1.0\\&quot; ?&gt;\\n  &lt;sdf version=\\&quot;1.6\\&quot;&gt;\\n      &lt;model name=\\&quot;green_box_for_white\\&quot;&gt;\\n        &lt;static&gt;1&lt;/static&gt;\\n        &lt;pose&gt;0 0 0.5 0 0 0&lt;/pose&gt;\\n        &lt;link name=\\&quot;link\\&quot;&gt;\\n          &lt;collision n&quot;...)\n    at /home/addisu/ws/ign-gazebo/src/ign_gazebo/test/integration/touch_plugin.cc:307\n#5  0x00005555555db602 in TouchPluginTest_SpawnedEntities_Test::TestBody (this=0x55555593a790) at /home/addisu/ws/ign-gazebo/src/ign_gazebo/test/integration/touch_plugin.cc:338\n#6  0x00005555556610e4 in testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::Test, void&gt; (object=0x55555593a790, method=&amp;virtual testing::Test::TestBody(), location=0x55555567fe4b &quot;the test body&quot;) at ../../test/gtest/src/gtest.cc:2079\n#7  0x0000555555655a33 in testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::Test, void&gt; (object=0x55555593a790, method=&amp;virtual testing::Test::TestBody(), location=0x55555567fe4b &quot;the test body&quot;) at ../../test/gtest/src/gtest.cc:2115\n#8  0x00005555556190cc in testing::Test::Run (this=0x55555593a790) at ../../test/gtest/src/gtest.cc:2151\n#9  0x000055555561a3a6 in testing::TestInfo::Run (this=0x555555a464a0) at ../../test/gtest/src/gtest.cc:2327\n#10 0x000055555561b08b in testing::TestCase::Run (this=0x555555a228b0) at ../../test/gtest/src/gtest.cc:2445\n#11 0x000055555562ad09 in testing::internal::UnitTestImpl::RunAllTests (this=0x55555595ed20) at ../../test/gtest/src/gtest.cc:4316\n#12 0x000055555566341f in testing::internal::HandleSehExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt; (object=0x55555595ed20,\n    method=(bool (testing::internal::UnitTestImpl::*)(testing::internal::UnitTestImpl * const)) 0x55555562a792 &lt;testing::internal::UnitTestImpl::RunAllTests() at ../../test/gtest/src/gtest.cc:4223&gt;,\n    location=0x555555680658 &quot;auxiliary test code (environments or event listeners)&quot;) at ../../test/gtest/src/gtest.cc:2079\n#13 0x0000555555657bb3 in testing::internal::HandleExceptionsInMethodIfSupported&lt;testing::internal::UnitTestImpl, bool&gt; (object=0x55555595ed20,\n    method=(bool (testing::internal::UnitTestImpl::*)(testing::internal::UnitTestImpl * const)) 0x55555562a792 &lt;testing::internal::UnitTestImpl::RunAllTests() at ../../test/gtest/src/gtest.cc:4223&gt;,\n    location=0x555555680658 &quot;auxiliary test code (environments or event listeners)&quot;) at ../../test/gtest/src/gtest.cc:2115\n#14 0x000055555562822f in testing::UnitTest::Run (this=0x5555558f2e00 &lt;testing::UnitTest::GetInstance()::instance&gt;) at ../../test/gtest/src/gtest.cc:3927\n#15 0x000055555567b0c6 in RUN_ALL_TESTS () at ../../test/gtest/include/gtest/gtest.h:2288\n#16 0x000055555567af7c in main (argc=1, argv=0x7fffffffd788) at /home/addisu/ws/ign-gazebo/src/ign_gazebo/test/gtest/src/gtest_main.cc:37\n</pre></div>\n\n\n<p>It looks like the same problem as the homebrew segfault where the system pointer is corrupt.</p>\n<div class=\"codehilite\"><pre><span></span>297       {\n298         IGN_PROFILE(&quot;PreUpdate&quot;);\n299         for (auto&amp; system : this-&gt;systemsPreupdate)\n300           system-&gt;PreUpdate(this-&gt;currentInfo, this-&gt;entityCompMgr);\n301       }\n</pre></div>", "type": "rendered"}, "created_on": "2019-03-27T19:45:41.492251+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": "2019-03-27T19:45:41.504236+00:00", "type": "pullrequest_comment", "id": 96647550}