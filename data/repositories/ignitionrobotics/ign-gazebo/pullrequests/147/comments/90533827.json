{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/147/comments/90533827.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/147/_/diff#comment-90533827"}}, "parent": {"id": 90404339, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/147/comments/90404339.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/147/_/diff#comment-90404339"}}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 147, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/pullrequests/147.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/pull-requests/147"}}, "title": "[A-4] Component factory"}, "content": {"raw": "I built this branch on Linux with `clang7` and , and I\u2019m getting some more consistent segfaults.\n\n    #0  0x00007fffbfd33680 in ?? ()\n    #1  0x00007ffff7a77024 in std::_Function_base::~_Function_base (this=0x775048) at /usr/bin/../lib/gcc/x86_64-linux-gnu/8/../../../../include/c++/8/bits/std_function.h:257\n    #2  0x00007ffff7a76fe5 in std::function<std::unique_ptr<ignition::gazebo::v0::components::Component, std::default_delete<ignition::gazebo::v0::components::Component> > ()>::~function() (this=0x775048) at /usr/bin/../lib/gcc/x86_64-linux-gnu/8/../../../../include/c++/8/bits/std_functi\n    on.h:128\n    #3  0x00007ffff7a76fc9 in std::pair<unsigned long const, std::function<std::unique_ptr<ignition::gazebo::v0::components::Component, std::default_delete<ignition::gazebo::v0::components::Component> > ()> >::~pair() (this=0x775040) at /usr/bin/../lib/gcc/x86_64-linux-gnu/8/../../../../\n    include/c++/8/bits/stl_pair.h:198\n    ...\n    #11 0x00007ffff7a76ca5 in std::map<unsigned long, std::function<std::unique_ptr<ignition::gazebo::v0::components::Component, std::default_delete<ignition::gazebo::v0::components::Component> > ()>, std::less<unsigned long>, std::allocator<std::pair<unsigned long const, std::function<s\n    td::unique_ptr<ignition::gazebo::v0::components::Component, std::default_delete<ignition::gazebo::v0::components::Component> > ()> > > >::~map() (this=0x7ffff7dd3e08 <ignition::common::SingletonT<ignition::gazebo::v0::components::Factory>::GetInstance()::t+56>) at /usr/bin/../lib/gcc\n    /x86_64-linux-gnu/8/../../../../include/c++/8/bits/stl_map.h:300\n    #12 0x00007ffff7a76a51 in ignition::gazebo::v0::components::Factory::~Factory (this=0x7ffff7dd3dd0 <ignition::common::SingletonT<ignition::gazebo::v0::components::Factory>::GetInstance()::t>) at /home/michael/repos/ign-gazebo/include/ignition/gazebo/components/Factory.hh:39\n\n\u200c\n\nMy initial thought is that it looks like _maybe_ the memory that the function was in is no longer valid, so calling the destructor of the `std::function` causes the segfault.", "markup": "markdown", "html": "<p>I built this branch on Linux with <code>clang7</code> and , and I\u2019m getting some more consistent segfaults.</p>\n<div class=\"codehilite\"><pre><span></span>#0  0x00007fffbfd33680 in ?? ()\n#1  0x00007ffff7a77024 in std::_Function_base::~_Function_base (this=0x775048) at /usr/bin/../lib/gcc/x86_64-linux-gnu/8/../../../../include/c++/8/bits/std_function.h:257\n#2  0x00007ffff7a76fe5 in std::function&lt;std::unique_ptr&lt;ignition::gazebo::v0::components::Component, std::default_delete&lt;ignition::gazebo::v0::components::Component&gt; &gt; ()&gt;::~function() (this=0x775048) at /usr/bin/../lib/gcc/x86_64-linux-gnu/8/../../../../include/c++/8/bits/std_functi\non.h:128\n#3  0x00007ffff7a76fc9 in std::pair&lt;unsigned long const, std::function&lt;std::unique_ptr&lt;ignition::gazebo::v0::components::Component, std::default_delete&lt;ignition::gazebo::v0::components::Component&gt; &gt; ()&gt; &gt;::~pair() (this=0x775040) at /usr/bin/../lib/gcc/x86_64-linux-gnu/8/../../../../\ninclude/c++/8/bits/stl_pair.h:198\n...\n#11 0x00007ffff7a76ca5 in std::map&lt;unsigned long, std::function&lt;std::unique_ptr&lt;ignition::gazebo::v0::components::Component, std::default_delete&lt;ignition::gazebo::v0::components::Component&gt; &gt; ()&gt;, std::less&lt;unsigned long&gt;, std::allocator&lt;std::pair&lt;unsigned long const, std::function&lt;s\ntd::unique_ptr&lt;ignition::gazebo::v0::components::Component, std::default_delete&lt;ignition::gazebo::v0::components::Component&gt; &gt; ()&gt; &gt; &gt; &gt;::~map() (this=0x7ffff7dd3e08 &lt;ignition::common::SingletonT&lt;ignition::gazebo::v0::components::Factory&gt;::GetInstance()::t+56&gt;) at /usr/bin/../lib/gcc\n/x86_64-linux-gnu/8/../../../../include/c++/8/bits/stl_map.h:300\n#12 0x00007ffff7a76a51 in ignition::gazebo::v0::components::Factory::~Factory (this=0x7ffff7dd3dd0 &lt;ignition::common::SingletonT&lt;ignition::gazebo::v0::components::Factory&gt;::GetInstance()::t&gt;) at /home/michael/repos/ign-gazebo/include/ignition/gazebo/components/Factory.hh:39\n</pre></div>\n\n\n<p>\u200c</p>\n<p>My initial thought is that it looks like <em>maybe</em> the memory that the function was in is no longer valid, so calling the destructor of the <code>std::function</code> causes the segfault.</p>", "type": "rendered"}, "created_on": "2019-02-05T20:00:24.779056+00:00", "user": {"display_name": "Michael Carroll", "uuid": "{17dbbc15-cbc0-42f0-a985-cde9061c78a0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D"}, "html": {"href": "https://bitbucket.org/%7B17dbbc15-cbc0-42f0-a985-cde9061c78a0%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:65740f22-cc56-4418-9608-7e17d0ed47b7/2aa259f5-4de1-4f68-9156-eded72041d84/128"}}, "nickname": "Michael Carroll", "type": "user", "account_id": "557058:65740f22-cc56-4418-9608-7e17d0ed47b7"}, "updated_on": "2019-02-05T20:00:24.800534+00:00", "type": "pullrequest_comment", "id": 90533827}