{"pagelen": 100, "values": [{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18/comments/51208971.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/issues/18#comment-51208971"}}, "issue": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18.json"}}, "type": "issue", "id": 18, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "title": "Support for multiple worlds"}, "content": {"raw": "This might be something that needs to be addressed in the `ignition-physics-dartsim` plugin.\n\nIs this happening due to multi-threading, or will it still happen even with only a single thread? If it's a multi-threading race condition issue, then maybe we just need to put a mutex in a sensible place in the `ignition-physics-dartsim` plugin.", "markup": "markdown", "html": "<p>This might be something that needs to be addressed in the <code>ignition-physics-dartsim</code> plugin.</p>\n<p>Is this happening due to multi-threading, or will it still happen even with only a single thread? If it's a multi-threading race condition issue, then maybe we just need to put a mutex in a sensible place in the <code>ignition-physics-dartsim</code> plugin.</p>", "type": "rendered"}, "created_on": "2019-03-19T02:57:33.286928+00:00", "user": {"display_name": "Michael Grey", "uuid": "{c1cdfe52-2887-474c-ae99-72fdc53a59c9}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc1cdfe52-2887-474c-ae99-72fdc53a59c9%7D"}, "html": {"href": "https://bitbucket.org/%7Bc1cdfe52-2887-474c-ae99-72fdc53a59c9%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:67759e29-d1df-465f-868d-047738e36fc9/d42d74cf-c1bd-4431-8288-07f543bbe325/128"}}, "nickname": "mxgrey", "type": "user", "account_id": "557058:67759e29-d1df-465f-868d-047738e36fc9"}, "updated_on": null, "type": "issue_comment", "id": 51208971}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18/comments/51220697.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/issues/18#comment-51220697"}}, "issue": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18.json"}}, "type": "issue", "id": 18, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "title": "Support for multiple worlds"}, "content": {"raw": "I believe this is a race condition on global variables in ODE. I was experimenting with a solution [here](#!/ignitionrobotics/ign-gazebo/commits/aed4210bb52c4786c793c1c799ed904f15add0a3?at=ode_race_fix), but `ignition-physics-dartsim` is probably a more appropriate place to put the mutex.", "markup": "markdown", "html": "<p>I believe this is a race condition on global variables in ODE. I was experimenting with a solution <a data-is-external-link=\"true\" href=\"#!/ignitionrobotics/ign-gazebo/commits/aed4210bb52c4786c793c1c799ed904f15add0a3?at=ode_race_fix\" rel=\"nofollow\">here</a>, but <code>ignition-physics-dartsim</code> is probably a more appropriate place to put the mutex.</p>", "type": "rendered"}, "created_on": "2019-03-19T15:22:33.466044+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": null, "type": "issue_comment", "id": 51220697}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18/comments/51402926.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/issues/18#comment-51402926"}}, "issue": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18.json"}}, "type": "issue", "id": 18, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "title": "Support for multiple worlds"}, "content": {"raw": "By the way, the same problem happens if we try to spin up 2 secondary servers running physics simulation in the same test, to test distributed simulation.", "markup": "markdown", "html": "<p>By the way, the same problem happens if we try to spin up 2 secondary servers running physics simulation in the same test, to test distributed simulation.</p>", "type": "rendered"}, "created_on": "2019-03-29T22:36:52.826217+00:00", "user": {"display_name": "Louise Poubel", "uuid": "{5cfa2075-477b-4ded-bdb9-8d2479544ec4}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D"}, "html": {"href": "https://bitbucket.org/%7B5cfa2075-477b-4ded-bdb9-8d2479544ec4%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8/7d903d90-c5ea-4182-b7ef-0d467e9e1c74/128"}}, "nickname": "chapulina", "type": "user", "account_id": "557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8"}, "updated_on": null, "type": "issue_comment", "id": 51402926}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18/comments/56801360.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/issues/18#comment-56801360"}}, "issue": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18.json"}}, "type": "issue", "id": 18, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "title": "Support for multiple worlds"}, "content": {"raw": "Is there any update on this problem? I started testing multi-world simulations and I stumbled upon this problem right away.\n\nIf this feature is not yet completed, it would be nice at least having a warning printed when the world file is loaded and multiple worlds are found.", "markup": "markdown", "html": "<p>Is there any update on this problem? I started testing multi-world simulations and I stumbled upon this problem right away.</p>\n<p>If this feature is not yet completed, it would be nice at least having a warning printed when the world file is loaded and multiple worlds are found.</p>", "type": "rendered"}, "created_on": "2020-04-05T15:40:27.606785+00:00", "user": {"display_name": "Diego Ferigo", "uuid": "{994b27a5-7d6d-42b2-8aa7-2ea82fbe7bf6}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B994b27a5-7d6d-42b2-8aa7-2ea82fbe7bf6%7D"}, "html": {"href": "https://bitbucket.org/%7B994b27a5-7d6d-42b2-8aa7-2ea82fbe7bf6%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:054df869-5cda-48f2-8b4e-81a61c133346/130cd3bf-aa0a-4355-bec2-c90f195acc4c/128"}}, "nickname": "dgferigo", "type": "user", "account_id": "557058:054df869-5cda-48f2-8b4e-81a61c133346"}, "updated_on": null, "type": "issue_comment", "id": 56801360}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18/comments/56801684.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/issues/18#comment-56801684"}}, "issue": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18.json"}}, "type": "issue", "id": 18, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "title": "Support for multiple worlds"}, "content": {"raw": "Thanks @{557058:90bc87b0-2886-4377-a17c-3a6629a697ff} for the fix you proposed. I know it\u2019s a hacky workaround, though it works reliably. Do you see any better solution that does not involve static mutexes?", "markup": "markdown", "html": "<p>Thanks <span class=\"ap-mention\" data-atlassian-id=\"557058:90bc87b0-2886-4377-a17c-3a6629a697ff\">@Addisu Z. Taddese</span> for the fix you proposed. I know it\u2019s a hacky workaround, though it works reliably. Do you see any better solution that does not involve static mutexes?</p>", "type": "rendered"}, "created_on": "2020-04-05T16:27:31.691714+00:00", "user": {"display_name": "Diego Ferigo", "uuid": "{994b27a5-7d6d-42b2-8aa7-2ea82fbe7bf6}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B994b27a5-7d6d-42b2-8aa7-2ea82fbe7bf6%7D"}, "html": {"href": "https://bitbucket.org/%7B994b27a5-7d6d-42b2-8aa7-2ea82fbe7bf6%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:054df869-5cda-48f2-8b4e-81a61c133346/130cd3bf-aa0a-4355-bec2-c90f195acc4c/128"}}, "nickname": "dgferigo", "type": "user", "account_id": "557058:054df869-5cda-48f2-8b4e-81a61c133346"}, "updated_on": null, "type": "issue_comment", "id": 56801684}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18/comments/56806838.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/issues/18#comment-56806838"}}, "issue": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18.json"}}, "type": "issue", "id": 18, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "title": "Support for multiple worlds"}, "content": {"raw": "Quick update. With fixed-base simple models like pendulum and cartpole the mutex workaround is effective as I reported in my last comment.\n\nHowever, with complex floating-base models like a humanoid robot with meshes both for visual and collisions, a multiworld setup still segfaults.\n\nI managed to \u201cisolate\u201d the problem, if we can say it. In `PhysicsPrivate::Step`, locking the same mutex in [this scope](#!/ignitionrobotics/ign-gazebo/src/8064b9eb40bec9b02d1417a7b252a6402ce32980/src/systems/physics/Physics.cc#lines-821:823) prevents the segfault. Though, this is _not_ a solution since it means that the real step of the world is not concurrently executed by the threads that handle the different worlds \\(one for each `SimulationRunner`\\). In other words, this mutex prevents stepping the worlds in parallel. I think that parallel execution within a single process is the main feature that triggers downstream users to use a multiworld setup.\n\nHere below the stack trace \\([text here](https://pastebin.com/BRC6NeLu)\\):\n\n![](data/bitbucket.org/repo/8zodKzn/images/370193615-Screenshot_20200406_094157.png)\n\u200c", "markup": "markdown", "html": "<p>Quick update. With fixed-base simple models like pendulum and cartpole the mutex workaround is effective as I reported in my last comment.</p>\n<p>However, with complex floating-base models like a humanoid robot with meshes both for visual and collisions, a multiworld setup still segfaults.</p>\n<p>I managed to \u201cisolate\u201d the problem, if we can say it. In <code>PhysicsPrivate::Step</code>, locking the same mutex in <a data-is-external-link=\"true\" href=\"#!/ignitionrobotics/ign-gazebo/src/8064b9eb40bec9b02d1417a7b252a6402ce32980/src/systems/physics/Physics.cc#lines-821:823\" rel=\"nofollow\">this scope</a> prevents the segfault. Though, this is <em>not</em> a solution since it means that the real step of the world is not concurrently executed by the threads that handle the different worlds (one for each <code>SimulationRunner</code>). In other words, this mutex prevents stepping the worlds in parallel. I think that parallel execution within a single process is the main feature that triggers downstream users to use a multiworld setup.</p>\n<p>Here below the stack trace (<a data-is-external-link=\"true\" href=\"https://pastebin.com/BRC6NeLu\" rel=\"nofollow\">text here</a>):</p>\n<p><img alt=\"\" src=\"data/bitbucket.org/repo/8zodKzn/images/370193615-Screenshot_20200406_094157.png\" />\n\u200c</p>", "type": "rendered"}, "created_on": "2020-04-06T07:44:26.589131+00:00", "user": {"display_name": "Diego Ferigo", "uuid": "{994b27a5-7d6d-42b2-8aa7-2ea82fbe7bf6}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B994b27a5-7d6d-42b2-8aa7-2ea82fbe7bf6%7D"}, "html": {"href": "https://bitbucket.org/%7B994b27a5-7d6d-42b2-8aa7-2ea82fbe7bf6%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:054df869-5cda-48f2-8b4e-81a61c133346/130cd3bf-aa0a-4355-bec2-c90f195acc4c/128"}}, "nickname": "dgferigo", "type": "user", "account_id": "557058:054df869-5cda-48f2-8b4e-81a61c133346"}, "updated_on": null, "type": "issue_comment", "id": 56806838}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18/comments/56847166.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/issues/18#comment-56847166"}}, "issue": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18.json"}}, "type": "issue", "id": 18, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "title": "Support for multiple worlds"}, "content": {"raw": "Looks like there is a [global cache](https://bitbucket.org/odedevs/ode/src/a77b1d06e3a62b0116e7d3c4be4c6beaac8726ea/ode/src/collision_trimesh_internal.h#lines-203) used by the collision detector in ODE. One thing to try would be to build ode with `--enable-ou`,", "markup": "markdown", "html": "<p>Looks like there is a <a data-is-external-link=\"true\" href=\"https://bitbucket.org/odedevs/ode/src/a77b1d06e3a62b0116e7d3c4be4c6beaac8726ea/ode/src/collision_trimesh_internal.h#lines-203\" rel=\"nofollow\">global cache</a> used by the collision detector in ODE. One thing to try would be to build ode with <code>--enable-ou</code>,</p>", "type": "rendered"}, "created_on": "2020-04-07T21:03:22.715039+00:00", "user": {"display_name": "Addisu Z. Taddese", "uuid": "{9d7fdc68-d270-4080-bf03-4df0d0dbf635}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D"}, "html": {"href": "https://bitbucket.org/%7B9d7fdc68-d270-4080-bf03-4df0d0dbf635%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:90bc87b0-2886-4377-a17c-3a6629a697ff/afbf9be5-1e4c-4810-89d4-e58831f34b11/128"}}, "nickname": "azeey", "type": "user", "account_id": "557058:90bc87b0-2886-4377-a17c-3a6629a697ff"}, "updated_on": null, "type": "issue_comment", "id": 56847166}, {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18/comments/56876607.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/issues/18#comment-56876607"}}, "issue": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/18.json"}}, "type": "issue", "id": 18, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "title": "Support for multiple worlds"}, "content": {"raw": "Thanks for the suggestion! From my side recompiling ODE would mean that all the chain ODE \u2192 DART \u2192 ign-physics should be compiled from sources. In this moment I doubt I can dedicate enough time to set everything up and start debugging the problem \\(also considering that ODE code is not very straighforward to read\\) :confused:", "markup": "markdown", "html": "<p>Thanks for the suggestion! From my side recompiling ODE would mean that all the chain ODE \u2192 DART \u2192 ign-physics should be compiled from sources. In this moment I doubt I can dedicate enough time to set everything up and start debugging the problem (also considering that ODE code is not very straighforward to read) <img class=\"emoji\" src=\"data/pf-emoji-service--cdn.us-east-1.prod.public.atl-paas.net/standard/551c9814-1d37-4573-819d-afab3afeaf32/48x48/1f615.png\" alt=\"\ud83d\ude15\" title=\":confused:\" data-emoji-short-name=\":confused:\" /></p>", "type": "rendered"}, "created_on": "2020-04-09T13:45:07.268178+00:00", "user": {"display_name": "Diego Ferigo", "uuid": "{994b27a5-7d6d-42b2-8aa7-2ea82fbe7bf6}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B994b27a5-7d6d-42b2-8aa7-2ea82fbe7bf6%7D"}, "html": {"href": "https://bitbucket.org/%7B994b27a5-7d6d-42b2-8aa7-2ea82fbe7bf6%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:054df869-5cda-48f2-8b4e-81a61c133346/130cd3bf-aa0a-4355-bec2-c90f195acc4c/128"}}, "nickname": "dgferigo", "type": "user", "account_id": "557058:054df869-5cda-48f2-8b4e-81a61c133346"}, "updated_on": null, "type": "issue_comment", "id": 56876607}], "page": 1, "size": 8}