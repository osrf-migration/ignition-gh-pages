{"changes": {"content": {"new": "# Prerequisites\r\n\r\n* \\[ X\\] Put an X between the brackets on this line if you have done all of the following:\r\n\r\n    * Checked the Q&A board for common solutions: [http://answers.gazebosim.org](http://answers.gazebosim.org)\r\n    * Checked that your issue isn't already filed.\r\n    * Checked that there is not already an Ignition package that provides the described functionality: [https://ignitionrobotics.org/libs](https://ignitionrobotics.org/libs)\r\n    \r\n\r\n# Description\r\n\r\n`double free or corruption (fasttop)` after executing a simple program using `Server`.\r\n\r\n# Steps to Reproduce\r\n\r\nBuild and run the following test program:\r\n\r\n```c++\r\n#include <ignition/gazebo/Server.hh>\r\n\r\nusing namespace ignition;\r\nusing namespace gazebo;\r\n\r\n/////////////////////////////////////////////////\r\nint main()\r\n{\r\n  ServerConfig serverConfig;\r\n  Server server(serverConfig);\r\n  server.Run();\r\n  return 0;\r\n}\r\n```\r\n\r\n**Expected behavior:**\r\n\r\nThe program should run and finish without any problems.\r\n\r\n**Actual behavior:**\r\n\r\nAt the end of the execution, the program fails with this output:\r\n\r\n`double free or corruption (fasttop)`  \r\n`Aborted (core dumped)`\r\n\r\n**Reproduces how often:**\r\n\r\nAlways.\r\n\r\n# Versions\r\n\r\ngcc \\(Ubuntu 8.3.0-6ubuntu1~18.04.1\\) 8.3.0\r\n\r\nldd \\(Ubuntu GLIBC 2.27-3ubuntu1\\) 2.27\r\n\r\n# Additional Information\r\n\r\nWhen running with valgrind:\r\n\r\n`valgrind --keep-stacktraces=alloc-and-free crash_test`\r\n\r\n> ==29049== Memcheck, a memory error detector  \r\n> ==29049== Copyright \\(C\\) 2002-2017, and GNU GPL'd, by Julian Seward et al.  \r\n> ==29049== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info  \r\n> ==29049== Command: bin/crash\\_test  \r\n> ==29049==  \r\n> ==29049== Invalid free\\(\\) / delete / delete\\[\\] / realloc\\(\\)  \r\n> ==29049== at 0x4C3123B: operator delete\\(void\\*\\) \\(in /usr/lib/valgrind/vgpreload\\_memcheck-amd64-linux.so\\)  \r\n> ==29049== by 0x580F040: \\_\\_run\\_exit\\_handlers \\(exit.c:108\\)  \r\n> ==29049== by 0x580F139: exit \\(exit.c:139\\)  \r\n> ==29049== by 0x57EDB9D: \\(below main\\) \\(libc-start.c:344\\)  \r\n> ==29049== Address 0x1f97e1d0 is 0 bytes inside a block of size 29 free'd  \r\n> ==29049== at 0x4C3123B: operator delete\\(void\\*\\) \\(in /usr/lib/valgrind/vgpreload\\_memcheck-amd64-linux.so\\)  \r\n> ==29049== by 0x580F040: \\_\\_run\\_exit\\_handlers \\(exit.c:108\\)  \r\n> ==29049== by 0x580F139: exit \\(exit.c:139\\)  \r\n> ==29049== by 0x57EDB9D: \\(below main\\) \\(libc-start.c:344\\)  \r\n> ==29049== Block was alloc'd at  \r\n> ==29049== at 0x4C3017F: operator new\\(unsigned long\\) \\(in /usr/lib/valgrind/vgpreload\\_memcheck-amd64-linux.so\\)  \r\n> ==29049== by 0x2ABF365D: ??? \\(in /opt/ros/melodic/lib/liboctomap.so.1.9.0\\)  \r\n> ==29049== by 0x4010732: call\\_init \\(dl-init.c:72\\)  \r\n> ==29049== by 0x4010732: \\_dl\\_init \\(dl-init.c:119\\)  \r\n> ==29049== by 0x40151FE: dl\\_open\\_worker \\(dl-open.c:522\\)  \r\n> ==29049== by 0x59332DE: \\_dl\\_catch\\_exception \\(dl-error-skeleton.c:196\\)  \r\n> ==29049== by 0x40147C9: \\_dl\\_open \\(dl-open.c:605\\)  \r\n> ==29049== by 0x972CF95: dlopen\\_doit \\(dlopen.c:66\\)  \r\n> ==29049== by 0x59332DE: \\_dl\\_catch\\_exception \\(dl-error-skeleton.c:196\\)  \r\n> ==29049== by 0x593336E: \\_dl\\_catch\\_error \\(dl-error-skeleton.c:215\\)  \r\n> ==29049== by 0x972D734: \\_dlerror\\_run \\(dlerror.c:162\\)  \r\n> ==29049== by 0x972D050: dlopen@@GLIBC\\_2.2.5 \\(dlopen.c:87\\)  \r\n> ==29049== by 0x663A3A9: ignition::plugin::Loader::Implementation::LoadLib\\(std::\\_\\_cxx11::basic\\_string<char, std::char\\_traits<char>, std::allocator<char> > const&\\) \\([Loader.cc:457](http://Loader.cc:457)\\)  \r\n> ==29049==  \r\n> ==29049==  \r\n> ==29049== HEAP SUMMARY:  \r\n> ==29049== in use at exit: 663,703 bytes in 9,163 blocks  \r\n> ==29049== total heap usage: 211,095 allocs, 201,934 frees, 31,648,420 bytes allocated  \r\n> ==29049==  \r\n> ==29049== LEAK SUMMARY:  \r\n> ==29049== definitely lost: 3,573 bytes in 212 blocks  \r\n> ==29049== indirectly lost: 0 bytes in 0 blocks  \r\n> ==29049== possibly lost: 0 bytes in 0 blocks  \r\n> ==29049== still reachable: 660,130 bytes in 8,951 blocks  \r\n> ==29049== suppressed: 0 bytes in 0 blocks  \r\n> ==29049== Rerun with --leak-check=full to see details of leaked memory  \r\n> ==29049==  \r\n> ==29049== For counts of detected and suppressed errors, rerun with: -v  \r\n> ==29049== ERROR SUMMARY: 2 errors from 1 contexts \\(suppressed: 0 from 0\\)\r\n\r\nPointed to line: [#!/ignitionrobotics/ign-plugin/src/8f724376b94bf6e298a7d66a37e5e5a68a329409/loader/src/Loader.cc#lines-457](#!/ignitionrobotics/ign-plugin/src/8f724376b94bf6e298a7d66a37e5e5a68a329409/loader/src/Loader.cc#lines-457)\r\n\r\nIf running with address sanitizer, we get:\r\n\r\n> =================================================================  \r\n> ==16996==ERROR: AddressSanitizer: attempting double-free on 0x60300026dc10 in thread T0:  \r\n> \\#0 0x55fafdc08dc0 in operator delete\\(void\\*\\) \\(bin/crash\\_test\\+0xd7dc0\\)  \r\n> ~~#1~~ 0x7f658031e040 \\(/lib/x86\\_64-linux-gnu/libc.so.6\\+0x43040\\)  \r\n> ~~#2~~ 0x7f658031e139 in exit \\(/lib/x86\\_64-linux-gnu/libc.so.6\\+0x43139\\)  \r\n> \\#3 0x7f65802fcb9d in \\_\\_libc\\_start\\_main \\(/lib/x86\\_64-linux-gnu/libc.so.6\\+0x21b9d\\)  \r\n> \\#4 0x55fafdb39b89 in \\_start \\(build/bin/crash\\_test\\+0x8b89\\)\r\n>\r\n> 0x60300026dc10 is located 0 bytes inside of 29-byte region \\[0x60300026dc10,0x60300026dc2d\\)  \r\n> freed by thread T0 here:  \r\n> \\#0 0x55fafdc08dc0 in operator delete\\(void\\*\\) \\(build/bin/crash\\_test\\+0xd7dc0\\)  \r\n> ~~#1~~ 0x7f658031e040 \\(/lib/x86\\_64-linux-gnu/libc.so.6\\+0x43040\\)\r\n>\r\n> previously allocated by thread T0 here:  \r\n> \\#0 0x55fafdc07f10 in operator new\\(unsigned long\\) \\(build/bin/crash\\_test\\+0xd6f10\\)  \r\n> ~~#1~~ 0x7f655b39565d \\(/opt/ros/melodic/lib/liboctomap.so.1.9\\+0x1465d\\)\r\n>\r\n> SUMMARY: AddressSanitizer: double-free \\(build/bin/crash\\_test\\+0xd7dc0\\) in operator delete\\(void\\*\\)  \r\n> ==16996==ABORTING\r\n\r\n\u200c", "old": "# Prerequisites\r\n\r\n* \\[ X\\] Put an X between the brackets on this line if you have done all of the following:\r\n\r\n    * Checked the Q&A board for common solutions: [http://answers.gazebosim.org](http://answers.gazebosim.org)\r\n    * Checked that your issue isn't already filed.\r\n    * Checked that there is not already an Ignition package that provides the described functionality: [https://ignitionrobotics.org/libs](https://ignitionrobotics.org/libs)\r\n    \r\n\r\n# Description\r\n\r\n`double free or corruption (fasttop)` after executing a simple program using `Server`.\r\n\r\n# Steps to Reproduce\r\n\r\nBuild and run the following test program:\r\n\r\n```c++\r\n#include <ignition/gazebo/Server.hh>\r\n\r\nusing namespace ignition;\r\nusing namespace gazebo;\r\n\r\n/////////////////////////////////////////////////\r\nint main()\r\n{\r\n  ServerConfig serverConfig;\r\n  Server server(serverConfig);\r\n  server.Run();\r\n  return 0;\r\n}\r\n```\r\n\r\n**Expected behavior:**\r\n\r\nThe program should run and finish without any problems.\r\n\r\n**Actual behavior:**\r\n\r\nAt the end of the execution, the program fails with this output:\r\n\r\n`double free or corruption (fasttop)`  \r\n`Aborted (core dumped)`\r\n\r\n**Reproduces how often:**\r\n\r\nAlways.\r\n\r\n# Versions\r\n\r\ngcc \\(Ubuntu 8.3.0-6ubuntu1~18.04.1\\) 8.3.0\r\n\r\nldd \\(Ubuntu GLIBC 2.27-3ubuntu1\\) 2.27\r\n\r\n# Additional Information\r\n\r\nWhen running with valgrind:\r\n\r\n`valgrind --keep-stacktraces=alloc-and-free crash_test`\r\n\r\n> ==29049== Memcheck, a memory error detector  \r\n> ==29049== Copyright \\(C\\) 2002-2017, and GNU GPL'd, by Julian Seward et al.  \r\n> ==29049== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info  \r\n> ==29049== Command: bin/crash\\_test  \r\n> ==29049==  \r\n> ==29049== Invalid free\\(\\) / delete / delete\\[\\] / realloc\\(\\)  \r\n> ==29049== at 0x4C3123B: operator delete\\(void\\*\\) \\(in /usr/lib/valgrind/vgpreload\\_memcheck-amd64-linux.so\\)  \r\n> ==29049== by 0x580F040: \\_\\_run\\_exit\\_handlers \\(exit.c:108\\)  \r\n> ==29049== by 0x580F139: exit \\(exit.c:139\\)  \r\n> ==29049== by 0x57EDB9D: \\(below main\\) \\(libc-start.c:344\\)  \r\n> ==29049== Address 0x1f97e1d0 is 0 bytes inside a block of size 29 free'd  \r\n> ==29049== at 0x4C3123B: operator delete\\(void\\*\\) \\(in /usr/lib/valgrind/vgpreload\\_memcheck-amd64-linux.so\\)  \r\n> ==29049== by 0x580F040: \\_\\_run\\_exit\\_handlers \\(exit.c:108\\)  \r\n> ==29049== by 0x580F139: exit \\(exit.c:139\\)  \r\n> ==29049== by 0x57EDB9D: \\(below main\\) \\(libc-start.c:344\\)  \r\n> ==29049== Block was alloc'd at  \r\n> ==29049== at 0x4C3017F: operator new\\(unsigned long\\) \\(in /usr/lib/valgrind/vgpreload\\_memcheck-amd64-linux.so\\)  \r\n> ==29049== by 0x2ABF365D: ??? \\(in /opt/ros/melodic/lib/liboctomap.so.1.9.0\\)  \r\n> ==29049== by 0x4010732: call\\_init \\(dl-init.c:72\\)  \r\n> ==29049== by 0x4010732: \\_dl\\_init \\(dl-init.c:119\\)  \r\n> ==29049== by 0x40151FE: dl\\_open\\_worker \\(dl-open.c:522\\)  \r\n> ==29049== by 0x59332DE: \\_dl\\_catch\\_exception \\(dl-error-skeleton.c:196\\)  \r\n> ==29049== by 0x40147C9: \\_dl\\_open \\(dl-open.c:605\\)  \r\n> ==29049== by 0x972CF95: dlopen\\_doit \\(dlopen.c:66\\)  \r\n> ==29049== by 0x59332DE: \\_dl\\_catch\\_exception \\(dl-error-skeleton.c:196\\)  \r\n> ==29049== by 0x593336E: \\_dl\\_catch\\_error \\(dl-error-skeleton.c:215\\)  \r\n> ==29049== by 0x972D734: \\_dlerror\\_run \\(dlerror.c:162\\)  \r\n> ==29049== by 0x972D050: dlopen@@GLIBC\\_2.2.5 \\(dlopen.c:87\\)  \r\n> ==29049== by 0x663A3A9: ignition::plugin::Loader::Implementation::LoadLib\\(std::\\_\\_cxx11::basic\\_string<char, std::char\\_traits<char>, std::allocator<char> > const&\\) \\([Loader.cc:457](http://Loader.cc:457)\\)  \r\n> ==29049==  \r\n> ==29049==  \r\n> ==29049== HEAP SUMMARY:  \r\n> ==29049== in use at exit: 663,703 bytes in 9,163 blocks  \r\n> ==29049== total heap usage: 211,095 allocs, 201,934 frees, 31,648,420 bytes allocated  \r\n> ==29049==  \r\n> ==29049== LEAK SUMMARY:  \r\n> ==29049== definitely lost: 3,573 bytes in 212 blocks  \r\n> ==29049== indirectly lost: 0 bytes in 0 blocks  \r\n> ==29049== possibly lost: 0 bytes in 0 blocks  \r\n> ==29049== still reachable: 660,130 bytes in 8,951 blocks  \r\n> ==29049== suppressed: 0 bytes in 0 blocks  \r\n> ==29049== Rerun with --leak-check=full to see details of leaked memory  \r\n> ==29049==  \r\n> ==29049== For counts of detected and suppressed errors, rerun with: -v  \r\n> ==29049== ERROR SUMMARY: 2 errors from 1 contexts \\(suppressed: 0 from 0\\)\r\n\r\nPointed to line: [#!/ignitionrobotics/ign-plugin/src/8f724376b94bf6e298a7d66a37e5e5a68a329409/loader/src/Loader.cc#lines-457](#!/ignitionrobotics/ign-plugin/src/8f724376b94bf6e298a7d66a37e5e5a68a329409/loader/src/Loader.cc#lines-457)\r\n\r\nIf running with address sanitizer, we get:\r\n\r\n> =================================================================  \r\n> ==16996==ERROR: AddressSanitizer: attempting double-free on 0x60300026dc10 in thread T0:  \r\n> \\#0 0x55fafdc08dc0 in operator delete\\(void\\*\\) \\(/home/juan/ignition\\_workspace/src/ign-vicarious/build/bin/crash\\_test\\+0xd7dc0\\)  \r\n> \\#1 0x7f658031e040  \\(/lib/x86\\_64-linux-gnu/libc.so.6\\+0x43040\\)  \r\n> \\#2 0x7f658031e139 in exit \\(/lib/x86\\_64-linux-gnu/libc.so.6\\+0x43139\\)  \r\n> \\#3 0x7f65802fcb9d in \\_\\_libc\\_start\\_main \\(/lib/x86\\_64-linux-gnu/libc.so.6\\+0x21b9d\\)  \r\n> \\#4 0x55fafdb39b89 in \\_start \\(/home/juan/ignition\\_workspace/src/ign-vicarious/build/bin/crash\\_test\\+0x8b89\\)\r\n>\r\n> 0x60300026dc10 is located 0 bytes inside of 29-byte region \\[0x60300026dc10,0x60300026dc2d\\)  \r\n> freed by thread T0 here:  \r\n> \\#0 0x55fafdc08dc0 in operator delete\\(void\\*\\) \\(/home/juan/ignition\\_workspace/src/ign-vicarious/build/bin/crash\\_test\\+0xd7dc0\\)  \r\n> \\#1 0x7f658031e040  \\(/lib/x86\\_64-linux-gnu/libc.so.6\\+0x43040\\)\r\n>\r\n> previously allocated by thread T0 here:  \r\n> \\#0 0x55fafdc07f10 in operator new\\(unsigned long\\) \\(/home/juan/ignition\\_workspace/src/ign-vicarious/build/bin/crash\\_test\\+0xd6f10\\)  \r\n> \\#1 0x7f655b39565d  \\(/opt/ros/melodic/lib/liboctomap.so.1.9\\+0x1465d\\)\r\n>\r\n> SUMMARY: AddressSanitizer: double-free \\(/home/juan/ignition\\_workspace/src/ign-vicarious/build/bin/crash\\_test\\+0xd7dc0\\) in operator delete\\(void\\*\\)  \r\n> ==16996==ABORTING\r\n\r\n\u200c"}}, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/54/changes/56698722.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/issues/54#comment-56698722"}}, "issue": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/54.json"}}, "type": "issue", "id": 54, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "title": "double free or corruption (fasttop)"}, "created_on": "2020-03-28T00:32:51.547148+00:00", "user": {"display_name": "Juan Oxoby", "uuid": "{7d3743fc-bfd8-4e48-a53b-9cc0a264f66d}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B7d3743fc-bfd8-4e48-a53b-9cc0a264f66d%7D"}, "html": {"href": "https://bitbucket.org/%7B7d3743fc-bfd8-4e48-a53b-9cc0a264f66d%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/3d4b2394d4fc0cf52ce2d5d797d60b25d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJO-0.png"}}, "nickname": "Juan Oxoby", "type": "user", "account_id": "5e544adb96f7d50ca05430ce"}, "message": {"raw": null, "markup": "markdown", "html": "", "type": "rendered"}, "type": "issue_change", "id": 56698722}