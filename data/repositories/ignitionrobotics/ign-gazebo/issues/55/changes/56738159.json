{"changes": {"content": {"new": "# Description\r\n\r\nIf the plugin libignition-gazebo-linearbatteryplugin-system.so is loaded together with a model that has a joint which is controlled with a torque i.e. JointForceCmd, the joint is frozen and does not move.\r\n\r\n# Steps to Reproduce\r\n\r\n1. Get a torque controlled model \\(joint\\_force\\_example for instance\\)\r\n2. Add the battery plugin \\(libignition-gazebo-linearbatteryplugin-system.so\\)\r\n3. Try to apply a force to the joint \\(e.g. ign topic -t \"/model/joint\\_force\\_example/joint/j1/cmd\\_force\" -m ignition.msgs.Double -p \"data: 0.001\"\\)\r\n\r\n**Expected behavior:**\r\n\r\nThe joint and so the upper plate should start rotating due to the applied force.\r\n\r\n**Actual behavior:**\r\n\r\nThe joint is frozen and the upper plate does not move.\r\n\r\n**Reproduces how often:**\r\n\r\nThree out of three times with this configuration.\r\n\r\n# Versions\r\n\r\nUbuntu 18.04, Ignition Gazebo, version 2.16.0\r\n\r\n# Additional Information\r\n\r\nSDF file attached that was used to observe the problem.\r\n\r\n\u200c\r\n\r\n```xml\r\n<?xml version=\"1.0\" ?>\r\n<sdf version=\"1.6\">\r\n  <world name=\"battery_plugin_debug\">\r\n    <physics name=\"1ms\" type=\"ode\">\r\n      <max_step_size>0.001</max_step_size>\r\n      <real_time_factor>1.0</real_time_factor>\r\n    </physics>\r\n    <plugin\r\n      filename=\"libignition-gazebo-physics-system.so\"\r\n      name=\"ignition::gazebo::systems::Physics\">\r\n    </plugin>\r\n    <plugin\r\n      filename=\"libignition-gazebo-user-commands-system.so\"\r\n      name=\"ignition::gazebo::systems::UserCommands\">\r\n    </plugin>\r\n    <plugin\r\n      filename=\"libignition-gazebo-scene-broadcaster-system.so\"\r\n      name=\"ignition::gazebo::systems::SceneBroadcaster\">\r\n    </plugin>\r\n    <plugin\r\n      filename=\"libignition-gazebo-contact-system.so\"\r\n      name=\"ignition::gazebo::systems::Contact\">\r\n    </plugin>\r\n\r\n    <gui fullscreen=\"0\">\r\n\r\n      <!-- 3D scene -->\r\n      <plugin filename=\"GzScene3D\" name=\"3D View\">\r\n        <ignition-gui>\r\n          <title>3D View</title>\r\n          <property type=\"bool\" key=\"showTitleBar\">false</property>\r\n          <property type=\"string\" key=\"state\">docked</property>\r\n        </ignition-gui>\r\n\r\n        <engine>ogre2</engine>\r\n        <scene>scene</scene>\r\n        <ambient_light>0.4 0.4 0.4</ambient_light>\r\n        <background_color>0.8 0.8 0.8</background_color>\r\n        <camera_pose>-6 0 6 0 0.5 0</camera_pose>\r\n      </plugin>\r\n\r\n      <!-- World control -->\r\n      <plugin filename=\"WorldControl\" name=\"World control\">\r\n        <ignition-gui>\r\n          <title>World control</title>\r\n          <property type=\"bool\" key=\"showTitleBar\">false</property>\r\n          <property type=\"bool\" key=\"resizable\">false</property>\r\n          <property type=\"double\" key=\"height\">72</property>\r\n          <property type=\"double\" key=\"width\">121</property>\r\n          <property type=\"double\" key=\"z\">1</property>\r\n\r\n          <property type=\"string\" key=\"state\">floating</property>\r\n          <anchors target=\"3D View\">\r\n            <line own=\"left\" target=\"left\"/>\r\n            <line own=\"bottom\" target=\"bottom\"/>\r\n          </anchors>\r\n        </ignition-gui>\r\n\r\n        <play_pause>true</play_pause>\r\n        <step>true</step>\r\n        <start_paused>true</start_paused>\r\n        <service>/world/battery_plugin_debug/control</service>\r\n        <stats_topic>/world/battery_plugin_debug/stats</stats_topic>\r\n\r\n      </plugin>\r\n\r\n      <!-- World statistics -->\r\n      <plugin filename=\"WorldStats\" name=\"World stats\">\r\n        <ignition-gui>\r\n          <title>World stats</title>\r\n          <property type=\"bool\" key=\"showTitleBar\">false</property>\r\n          <property type=\"bool\" key=\"resizable\">false</property>\r\n          <property type=\"double\" key=\"height\">110</property>\r\n          <property type=\"double\" key=\"width\">290</property>\r\n          <property type=\"double\" key=\"z\">1</property>\r\n\r\n          <property type=\"string\" key=\"state\">floating</property>\r\n          <anchors target=\"3D View\">\r\n            <line own=\"right\" target=\"right\"/>\r\n            <line own=\"bottom\" target=\"bottom\"/>\r\n          </anchors>\r\n        </ignition-gui>\r\n\r\n        <sim_time>true</sim_time>\r\n        <real_time>true</real_time>\r\n        <real_time_factor>true</real_time_factor>\r\n        <iterations>true</iterations>\r\n        <topic>/world/battery_plugin_debug/stats</topic>\r\n\r\n      </plugin>\r\n\r\n      <!-- Entity tree -->\r\n      <plugin filename=\"EntityTree\" name=\"Entity tree\">\r\n      </plugin>\r\n\r\n    </gui>\r\n\r\n    <light type=\"directional\" name=\"sun\">\r\n      <cast_shadows>true</cast_shadows>\r\n      <pose>0 0 10 0 0 0</pose>\r\n      <diffuse>0.8 0.8 0.8 1</diffuse>\r\n      <specular>0.2 0.2 0.2 1</specular>\r\n      <attenuation>\r\n        <range>1000</range>\r\n        <constant>0.9</constant>\r\n        <linear>0.01</linear>\r\n        <quadratic>0.001</quadratic>\r\n      </attenuation>\r\n      <direction>-0.5 0.1 -0.9</direction>\r\n    </light>\r\n\r\n    <model name=\"ground_plane\">\r\n      <static>true</static>\r\n      <link name=\"link\">\r\n        <collision name=\"collision\">\r\n          <geometry>\r\n            <plane>\r\n              <normal>0 0 1</normal>\r\n            </plane>\r\n          </geometry>\r\n        </collision>\r\n        <visual name=\"visual\">\r\n          <geometry>\r\n            <plane>\r\n              <normal>0 0 1</normal>\r\n              <size>100 100</size>\r\n            </plane>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.8 0.8 0.8 1</ambient>\r\n            <diffuse>0.8 0.8 0.8 1</diffuse>\r\n            <specular>0.8 0.8 0.8 1</specular>\r\n          </material>\r\n        </visual>\r\n      </link>\r\n    </model>\r\n\r\n    <model name=\"joint_force_example\">\r\n     <pose>0 0 0.005 0 0 0</pose>\r\n     <link name=\"base_link\">\r\n       <pose>0.0 0.0 0.0 0 0 0</pose>\r\n       <inertial>\r\n         <inertia>\r\n           <ixx>2.501</ixx>\r\n           <ixy>0</ixy>\r\n           <ixz>0</ixz>\r\n           <iyy>2.501</iyy>\r\n           <iyz>0</iyz>\r\n           <izz>5</izz>\r\n         </inertia>\r\n         <mass>120.0</mass>\r\n       </inertial>\r\n       <visual name=\"base_visual\">\r\n         <pose>0.0 0.0 0.0 0 0 0</pose>\r\n         <geometry>\r\n           <box>\r\n             <size>0.5 0.5 0.01</size>\r\n           </box>\r\n         </geometry>\r\n         <material>\r\n           <ambient>1.0 0.0 0.0 1</ambient>\r\n           <diffuse>1.0 0.0 0.0 1</diffuse>\r\n           <specular>1.0 0.0 0.0 1</specular>\r\n         </material>\r\n       </visual>\r\n       <collision name=\"base_collision\">\r\n         <pose>0.0 0.0 0.0 0 0 0</pose>\r\n         <geometry>\r\n           <box>\r\n             <size>0.5 0.5 0.01</size>\r\n           </box>\r\n         </geometry>\r\n       </collision>\r\n     </link>\r\n     <link name=\"rotor\">\r\n       <pose>0.0 0.0 1.0 0.0 0 0</pose>\r\n       <inertial>\r\n         <pose>0.0 0.0 0.0 0 0 0</pose>\r\n         <inertia>\r\n           <ixx>0.032</ixx>\r\n           <ixy>0</ixy>\r\n           <ixz>0</ixz>\r\n           <iyy>0.032</iyy>\r\n           <iyz>0</iyz>\r\n           <izz>0.00012</izz>\r\n         </inertia>\r\n         <mass>0.6</mass>\r\n       </inertial>\r\n       <visual name=\"visual\">\r\n         <geometry>\r\n           <box>\r\n             <size>0.25 0.25 0.05</size>\r\n           </box>\r\n         </geometry>\r\n         <material>\r\n           <ambient>0.0 0.0 1.0 1</ambient>\r\n           <diffuse>0.0 0.0 1.0 1</diffuse>\r\n           <specular>0.0 0.0 1.0 1</specular>\r\n         </material>\r\n       </visual>\r\n       <collision name=\"collision\">\r\n         <geometry>\r\n           <box>\r\n             <size>0.25 0.25 0.05</size>\r\n           </box>\r\n         </geometry>\r\n       </collision>\r\n     </link>\r\n\r\n     <joint name=\"j1\" type=\"revolute\">\r\n       <pose>0 0 -0.5 0 0 0</pose>\r\n       <parent>base_link</parent>\r\n       <child>rotor</child>\r\n       <axis>\r\n         <xyz>0 0 1</xyz>\r\n         <dynamics>\r\n           <damping>0.0001</damping>\r\n         </dynamics>\r\n       </axis>\r\n     </joint>\r\n     <plugin\r\n       filename=\"libignition-gazebo-apply-joint-force-system.so\"\r\n       name=\"ignition::gazebo::systems::ApplyJointForce\">\r\n       <joint_name>j1</joint_name>\r\n     </plugin>\r\n\r\n     <plugin filename=\"libignition-gazebo-linearbatteryplugin-system.so\"\r\n       name=\"ignition::gazebo::systems::LinearBatteryPlugin\">\r\n       <battery_name>linear_battery</batt", "old": "# Description\r\n\r\nIf the plugin libignition-gazebo-linearbatteryplugin-system.so is loaded together with a model that has a joint which is controlled with a torque i.e. JointForceCmd, the joint is frozen and does not move.\r\n\r\n# Steps to Reproduce\r\n\r\n1. \\[Get a torque controlled model \\(joint\\_force\\_example for instance\\)\\]\r\n2.  \\[Add the battery plugin \\(libignition-gazebo-linearbatteryplugin-system.so\\)\\]\r\n3.  \\[Try to apply a force to the joint \\(e.g. ign topic -t \"/model/joint\\_force\\_example/joint/j1/cmd\\_force\" -m ignition.msgs.Double -p \"data: 0.001\"\\)\\]\r\n\r\n**Expected behavior:**\r\n\r\nThe joint and so the upper plate should start rotating due to the applied force.\r\n\r\n**Actual behavior:**\r\n\r\nThe joint is frozen and the upper plate does not move.\r\n\r\n**Reproduces how often:**\r\n\r\nThree out of three times with this configuration.\r\n\r\n# Versions\r\n\r\nUbuntu 18.04, Ignition Gazebo, version 2.16.0\r\n\r\n# Additional Information\r\n\r\nSDF file attached that was used to observe the problem.\r\n\r\n\u200c\r\n\r\n```xml\r\n<?xml version=\"1.0\" ?>\r\n<sdf version=\"1.6\">\r\n  <world name=\"battery_plugin_debug\">\r\n    <physics name=\"1ms\" type=\"ode\">\r\n      <max_step_size>0.001</max_step_size>\r\n      <real_time_factor>1.0</real_time_factor>\r\n    </physics>\r\n    <plugin\r\n      filename=\"libignition-gazebo-physics-system.so\"\r\n      name=\"ignition::gazebo::systems::Physics\">\r\n    </plugin>\r\n    <plugin\r\n      filename=\"libignition-gazebo-user-commands-system.so\"\r\n      name=\"ignition::gazebo::systems::UserCommands\">\r\n    </plugin>\r\n    <plugin\r\n      filename=\"libignition-gazebo-scene-broadcaster-system.so\"\r\n      name=\"ignition::gazebo::systems::SceneBroadcaster\">\r\n    </plugin>\r\n    <plugin\r\n      filename=\"libignition-gazebo-contact-system.so\"\r\n      name=\"ignition::gazebo::systems::Contact\">\r\n    </plugin>\r\n\r\n    <gui fullscreen=\"0\">\r\n\r\n      <!-- 3D scene -->\r\n      <plugin filename=\"GzScene3D\" name=\"3D View\">\r\n        <ignition-gui>\r\n          <title>3D View</title>\r\n          <property type=\"bool\" key=\"showTitleBar\">false</property>\r\n          <property type=\"string\" key=\"state\">docked</property>\r\n        </ignition-gui>\r\n\r\n        <engine>ogre2</engine>\r\n        <scene>scene</scene>\r\n        <ambient_light>0.4 0.4 0.4</ambient_light>\r\n        <background_color>0.8 0.8 0.8</background_color>\r\n        <camera_pose>-6 0 6 0 0.5 0</camera_pose>\r\n      </plugin>\r\n\r\n      <!-- World control -->\r\n      <plugin filename=\"WorldControl\" name=\"World control\">\r\n        <ignition-gui>\r\n          <title>World control</title>\r\n          <property type=\"bool\" key=\"showTitleBar\">false</property>\r\n          <property type=\"bool\" key=\"resizable\">false</property>\r\n          <property type=\"double\" key=\"height\">72</property>\r\n          <property type=\"double\" key=\"width\">121</property>\r\n          <property type=\"double\" key=\"z\">1</property>\r\n\r\n          <property type=\"string\" key=\"state\">floating</property>\r\n          <anchors target=\"3D View\">\r\n            <line own=\"left\" target=\"left\"/>\r\n            <line own=\"bottom\" target=\"bottom\"/>\r\n          </anchors>\r\n        </ignition-gui>\r\n\r\n        <play_pause>true</play_pause>\r\n        <step>true</step>\r\n        <start_paused>true</start_paused>\r\n        <service>/world/battery_plugin_debug/control</service>\r\n        <stats_topic>/world/battery_plugin_debug/stats</stats_topic>\r\n\r\n      </plugin>\r\n\r\n      <!-- World statistics -->\r\n      <plugin filename=\"WorldStats\" name=\"World stats\">\r\n        <ignition-gui>\r\n          <title>World stats</title>\r\n          <property type=\"bool\" key=\"showTitleBar\">false</property>\r\n          <property type=\"bool\" key=\"resizable\">false</property>\r\n          <property type=\"double\" key=\"height\">110</property>\r\n          <property type=\"double\" key=\"width\">290</property>\r\n          <property type=\"double\" key=\"z\">1</property>\r\n\r\n          <property type=\"string\" key=\"state\">floating</property>\r\n          <anchors target=\"3D View\">\r\n            <line own=\"right\" target=\"right\"/>\r\n            <line own=\"bottom\" target=\"bottom\"/>\r\n          </anchors>\r\n        </ignition-gui>\r\n\r\n        <sim_time>true</sim_time>\r\n        <real_time>true</real_time>\r\n        <real_time_factor>true</real_time_factor>\r\n        <iterations>true</iterations>\r\n        <topic>/world/battery_plugin_debug/stats</topic>\r\n\r\n      </plugin>\r\n\r\n      <!-- Entity tree -->\r\n      <plugin filename=\"EntityTree\" name=\"Entity tree\">\r\n      </plugin>\r\n\r\n    </gui>\r\n\r\n    <light type=\"directional\" name=\"sun\">\r\n      <cast_shadows>true</cast_shadows>\r\n      <pose>0 0 10 0 0 0</pose>\r\n      <diffuse>0.8 0.8 0.8 1</diffuse>\r\n      <specular>0.2 0.2 0.2 1</specular>\r\n      <attenuation>\r\n        <range>1000</range>\r\n        <constant>0.9</constant>\r\n        <linear>0.01</linear>\r\n        <quadratic>0.001</quadratic>\r\n      </attenuation>\r\n      <direction>-0.5 0.1 -0.9</direction>\r\n    </light>\r\n\r\n    <model name=\"ground_plane\">\r\n      <static>true</static>\r\n      <link name=\"link\">\r\n        <collision name=\"collision\">\r\n          <geometry>\r\n            <plane>\r\n              <normal>0 0 1</normal>\r\n            </plane>\r\n          </geometry>\r\n        </collision>\r\n        <visual name=\"visual\">\r\n          <geometry>\r\n            <plane>\r\n              <normal>0 0 1</normal>\r\n              <size>100 100</size>\r\n            </plane>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.8 0.8 0.8 1</ambient>\r\n            <diffuse>0.8 0.8 0.8 1</diffuse>\r\n            <specular>0.8 0.8 0.8 1</specular>\r\n          </material>\r\n        </visual>\r\n      </link>\r\n    </model>\r\n\r\n    <model name=\"joint_force_example\">\r\n     <pose>0 0 0.005 0 0 0</pose>\r\n     <link name=\"base_link\">\r\n       <pose>0.0 0.0 0.0 0 0 0</pose>\r\n       <inertial>\r\n         <inertia>\r\n           <ixx>2.501</ixx>\r\n           <ixy>0</ixy>\r\n           <ixz>0</ixz>\r\n           <iyy>2.501</iyy>\r\n           <iyz>0</iyz>\r\n           <izz>5</izz>\r\n         </inertia>\r\n         <mass>120.0</mass>\r\n       </inertial>\r\n       <visual name=\"base_visual\">\r\n         <pose>0.0 0.0 0.0 0 0 0</pose>\r\n         <geometry>\r\n           <box>\r\n             <size>0.5 0.5 0.01</size>\r\n           </box>\r\n         </geometry>\r\n         <material>\r\n           <ambient>1.0 0.0 0.0 1</ambient>\r\n           <diffuse>1.0 0.0 0.0 1</diffuse>\r\n           <specular>1.0 0.0 0.0 1</specular>\r\n         </material>\r\n       </visual>\r\n       <collision name=\"base_collision\">\r\n         <pose>0.0 0.0 0.0 0 0 0</pose>\r\n         <geometry>\r\n           <box>\r\n             <size>0.5 0.5 0.01</size>\r\n           </box>\r\n         </geometry>\r\n       </collision>\r\n     </link>\r\n     <link name=\"rotor\">\r\n       <pose>0.0 0.0 1.0 0.0 0 0</pose>\r\n       <inertial>\r\n         <pose>0.0 0.0 0.0 0 0 0</pose>\r\n         <inertia>\r\n           <ixx>0.032</ixx>\r\n           <ixy>0</ixy>\r\n           <ixz>0</ixz>\r\n           <iyy>0.032</iyy>\r\n           <iyz>0</iyz>\r\n           <izz>0.00012</izz>\r\n         </inertia>\r\n         <mass>0.6</mass>\r\n       </inertial>\r\n       <visual name=\"visual\">\r\n         <geometry>\r\n           <box>\r\n             <size>0.25 0.25 0.05</size>\r\n           </box>\r\n         </geometry>\r\n         <material>\r\n           <ambient>0.0 0.0 1.0 1</ambient>\r\n           <diffuse>0.0 0.0 1.0 1</diffuse>\r\n           <specular>0.0 0.0 1.0 1</specular>\r\n         </material>\r\n       </visual>\r\n       <collision name=\"collision\">\r\n         <geometry>\r\n           <box>\r\n             <size>0.25 0.25 0.05</size>\r\n           </box>\r\n         </geometry>\r\n       </collision>\r\n     </link>\r\n\r\n     <joint name=\"j1\" type=\"revolute\">\r\n       <pose>0 0 -0.5 0 0 0</pose>\r\n       <parent>base_link</parent>\r\n       <child>rotor</child>\r\n       <axis>\r\n         <xyz>0 0 1</xyz>\r\n         <dynamics>\r\n           <damping>0.0001</damping>\r\n         </dynamics>\r\n       </axis>\r\n     </joint>\r\n     <plugin\r\n       filename=\"libignition-gazebo-apply-joint-force-system.so\"\r\n       name=\"ignition::gazebo::systems::ApplyJointForce\">\r\n       <joint_name>j1</joint_name>\r\n     </plugin>\r\n\r\n     <plugin filename=\"libignition-gazebo-linearbatteryplugin-system.so\"\r\n       name=\"ignition::gazebo::systems::LinearBatteryPlugin\">\r\n       <battery_name>linear"}}, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/55/changes/56738159.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo/issues/55#comment-56738159"}}, "issue": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo/issues/55.json"}}, "type": "issue", "id": 55, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-gazebo.json"}, "html": {"href": "#!/ignitionrobotics/ign-gazebo"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f98d11fe-f287-4dfb-99c3-e2b76a13232e}ts=2082645"}}, "type": "repository", "name": "ign-gazebo", "full_name": "ignitionrobotics/ign-gazebo", "uuid": "{f98d11fe-f287-4dfb-99c3-e2b76a13232e}"}, "title": "Battery Plugin freezes Joints"}, "created_on": "2020-03-31T14:36:33.882091+00:00", "user": {"display_name": "Samuel Zimmermann", "uuid": "{5428542f-076a-4f88-b082-75a914e95fd3}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B5428542f-076a-4f88-b082-75a914e95fd3%7D"}, "html": {"href": "https://bitbucket.org/%7B5428542f-076a-4f88-b082-75a914e95fd3%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:d9ff1b52-e1bf-4f76-bf85-b93e0280d3c3/c0bf86f2-cf31-4d83-9739-1bf3e02de481/128"}}, "nickname": "zsamuel", "type": "user", "account_id": "557058:d9ff1b52-e1bf-4f76-bf85-b93e0280d3c3"}, "message": {"raw": null, "markup": "markdown", "html": "", "type": "rendered"}, "type": "issue_change", "id": 56738159}