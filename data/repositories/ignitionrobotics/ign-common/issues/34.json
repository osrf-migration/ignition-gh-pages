{"priority": "major", "kind": "proposal", "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-common.json"}, "html": {"href": "#!/ignitionrobotics/ign-common"}, "avatar": {"href": "data/bytebucket.org/ravatar/{1dfbdd30-34c5-4b09-82ef-9bfe2917877b}ts=1533303"}}, "type": "repository", "name": "ign-common", "full_name": "ignitionrobotics/ign-common", "uuid": "{1dfbdd30-34c5-4b09-82ef-9bfe2917877b}"}, "links": {"attachments": {"href": "data/repositories/ignitionrobotics/ign-common/issues/34/attachments_page=1.json"}, "self": {"href": "data/repositories/ignitionrobotics/ign-common/issues/34.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-common/issues/34/watch"}, "comments": {"href": "data/repositories/ignitionrobotics/ign-common/issues/34/comments_page=1.json"}, "html": {"href": "#!/ignitionrobotics/ign-common/issues/34/rtld_lazy-vs-rtld_now-in-pluginloader"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-common/issues/34/vote"}}, "reporter": {"display_name": "Carlos Ag\u00fcero", "uuid": "{da8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D"}, "html": {"href": "https://bitbucket.org/%7Bda8a8e89-4bb0-421b-bd0e-dbbed3d4ed6a%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/692bf15758111acaddae4da15a47f9e5d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsCA-0.png"}}, "nickname": "caguero", "type": "user", "account_id": "557058:4ded1ddf-947e-4154-bbd1-3dba24f1bdbd"}, "title": "RTLD_LAZY vs RTLD_NOW in PluginLoader", "component": null, "votes": 0, "watches": 1, "content": {"raw": "Looking at the `PluginLoader` implementation, we're using the `RTLD_LAZY` as the flag parameter when calling `dlopen`.  [Here's](http://tldp.org/HOWTO/Program-Library-HOWTO/dl-libraries.html) a description of the available flags.\r\n\r\nBased on the documentation and a chat with @mxgrey, we conclude that Ignition Common doesn't have a particular preference between `RTLD_LAZY` or `RTLD_NOW`. The main implications seem to affect performance. `RTLD_NOW` front-loads some of the work when `dlopen()` is called at the cost of resolving symbols that might not be used. On the other hand, `RTLD_LAZY` returns faster from `dlopen()` but it will require to resolve the symbol the first time is really used.\r\n\r\nTo accommodate the different use cases from the Ignition Common users, we could expose the ability to choose the mode to the users. We discussed two options:\r\n\r\n* Expose the flag at the `PluginLoader` class. All subsequent calls to `LoadLibrary()` will use the previously set flag.\r\n* Expose the flag as a new `LoadLibrary()` parameter (possibly with a default option).", "markup": "markdown", "html": "<p>Looking at the <code>PluginLoader</code> implementation, we're using the <code>RTLD_LAZY</code> as the flag parameter when calling <code>dlopen</code>.  <a data-is-external-link=\"true\" href=\"http://tldp.org/HOWTO/Program-Library-HOWTO/dl-libraries.html\" rel=\"nofollow\">Here's</a> a description of the available flags.</p>\n<p>Based on the documentation and a chat with @mxgrey, we conclude that Ignition Common doesn't have a particular preference between <code>RTLD_LAZY</code> or <code>RTLD_NOW</code>. The main implications seem to affect performance. <code>RTLD_NOW</code> front-loads some of the work when <code>dlopen()</code> is called at the cost of resolving symbols that might not be used. On the other hand, <code>RTLD_LAZY</code> returns faster from <code>dlopen()</code> but it will require to resolve the symbol the first time is really used.</p>\n<p>To accommodate the different use cases from the Ignition Common users, we could expose the ability to choose the mode to the users. We discussed two options:</p>\n<ul>\n<li>Expose the flag at the <code>PluginLoader</code> class. All subsequent calls to <code>LoadLibrary()</code> will use the previously set flag.</li>\n<li>Expose the flag as a new <code>LoadLibrary()</code> parameter (possibly with a default option).</li>\n</ul>", "type": "rendered"}, "assignee": null, "state": "closed", "version": null, "edited_on": null, "created_on": "2018-04-16T23:45:21.367533+00:00", "milestone": null, "updated_on": "2019-04-23T07:39:18.569245+00:00", "type": "issue", "id": 34}