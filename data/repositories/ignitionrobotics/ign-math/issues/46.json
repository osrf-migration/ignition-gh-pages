{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-math.json"}, "html": {"href": "#!/ignitionrobotics/ign-math"}, "avatar": {"href": "data/bytebucket.org/ravatar/{18503e50-08ea-4d88-ab99-110fde3c7256}ts=1533305"}}, "type": "repository", "name": "ign-math", "full_name": "ignitionrobotics/ign-math", "uuid": "{18503e50-08ea-4d88-ab99-110fde3c7256}"}, "links": {"attachments": {"href": "data/repositories/ignitionrobotics/ign-math/issues/46/attachments_page=1.json"}, "self": {"href": "data/repositories/ignitionrobotics/ign-math/issues/46.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-math/issues/46/watch"}, "comments": {"href": "data/repositories/ignitionrobotics/ign-math/issues/46/comments_page=1.json"}, "html": {"href": "#!/ignitionrobotics/ign-math/issues/46/gazebo-needs-an-operator-from-quaternion3d"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-math/issues/46/vote"}}, "reporter": {"display_name": "John Hsu", "uuid": "{0a186eae-abf0-4514-a951-23db5eccc286}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D"}, "html": {"href": "https://bitbucket.org/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:f3968cd3-4910-4384-8349-482a6c7889ec/5445ce6e-6273-47f0-84eb-621c86ca11cb/128"}}, "nickname": "hsu", "type": "user", "account_id": "557058:f3968cd3-4910-4384-8349-482a6c7889ec"}, "title": "Gazebo needs an operator= from Quaternion3d to Matrix3d", "component": null, "votes": 0, "watches": 1, "content": {"raw": "compiling\r\n\r\nign-math - ign-math2 branch, 1025:832e60ff03d5\r\n\r\nsdformat - sdf3 branch, 1948:5e77af4e606b\r\n\r\ngazebo - gazebo6 branch, 30538:b259500cf75a\r\n\r\nencountered error:\r\n\r\n~~~\r\n[ 53%] Building CXX object gazebo/gui/model/CMakeFiles/gazebo_gui_model.dir/moc_JointMaker.cxx.o\r\ncd /home/hsu/projects/gazebo_6/build_release/gazebo/gui/model && /usr/bin/c++   -DLIBBULLET_VERSION=2.83 -DLIBBULLET_VERSION_GT_282 -DQT_CORE_LIB -DQT_GUI_LIB -DQT_NO_DEBUG -Dgazebo_gui_model_EXPORTS -Wall -Wextra -Wno-long-long -Wno-unused-value -Wno-unused-value -Wno-unused-value -Wno-unused-value -Wfloat-equal -Wshadow -Winit-self -Wswitch-default -Wmissing-include-dirs -pedantic -fvisibility=hidden -fvisibility-inlines-hidden -std=c++11 -DBUILDING_DLL_GZ_GUI_MODEL  -s -O3 -DNDEBUG -msse4.2 -msse4.1 -mssse3 -msse3 -mfpmath=sse -msse -msse2  -fPIC -I/home/hsu/projects/gazebo_6/test/gtest/include -I/home/hsu/projects/gazebo_6 -I/home/hsu/projects/gazebo_6/build_release -I/home/hsu/projects/gazebo_6/deps -I/home/hsu/projects/gazebo_6/build_release/gazebo/gui/model -I/usr/include/libusb-1.0 -isystem /home/hsu/local_ign-math/include/ignition/math2 -isystem /usr/include/OGRE/RTShaderSystem -isystem /usr/include/OGRE -isystem /usr/include/OGRE/Terrain -isystem /usr/include/OGRE/Paging -isystem /home/hsu/local_sdformat_3/include/sdformat-3.7 -isystem /usr/include/qt4 -isystem /usr/include/qt4/QtGui -isystem /usr/include/qt4/QtCore    -fPIC -std=c++11 -o CMakeFiles/gazebo_gui_model.dir/moc_JointMaker.cxx.o -c /home/hsu/projects/gazebo_6/build_release/gazebo/gui/model/moc_JointMaker.cxx\r\n/home/hsu/projects/gazebo_6/gazebo/sensors/ForceTorqueSensor.cc: In member function \u2018virtual void gazebo::sensors::ForceTorqueSensor::Load(const string&, sdf::ElementPtr)\u2019:\r\n/home/hsu/projects/gazebo_6/gazebo/sensors/ForceTorqueSensor.cc:112:29: error: no match for \u2018operator=\u2019 (operand types are \u2018ignition::math::Matrix3d {aka ignition::math::Matrix3<double>}\u2019 and \u2018ignition::math::Quaternion<double>\u2019)\r\n   this->rotationSensorChild = rotationChildSensor.Inverse();\r\n                             ^\r\n/home/hsu/projects/gazebo_6/gazebo/sensors/ForceTorqueSensor.cc:112:29: note: candidate is:\r\nIn file included from /home/hsu/local_ign-math/include/ignition/math2/ignition/math/MassMatrix3.hh:28:0,\r\n                 from /home/hsu/local_ign-math/include/ignition/math2/ignition/math.hh:13,\r\n                 from /home/hsu/local_sdformat_3/include/sdformat-3.7/sdf/Param.hh:35,\r\n                 from /home/hsu/local_sdformat_3/include/sdformat-3.7/sdf/Element.hh:25,\r\n                 from /home/hsu/local_sdformat_3/include/sdformat-3.7/sdf/sdf.hh:5,\r\n                 from /home/hsu/projects/gazebo_6/gazebo/physics/World.hh:35,\r\n                 from /home/hsu/projects/gazebo_6/gazebo/sensors/ForceTorqueSensor.cc:25:\r\n/home/hsu/local_ign-math/include/ignition/math2/ignition/math/Matrix3.hh:33:11: note: ignition::math::Matrix3<double>& ignition::math::Matrix3<double>::operator=(const ignition::math::Matrix3<double>&)\r\n     class Matrix3\r\n           ^\r\n/home/hsu/local_ign-math/include/ignition/math2/ignition/math/Matrix3.hh:33:11: note:   no known conversion for argument 1 from \u2018ignition::math::Quaternion<double>\u2019 to \u2018const ignition::math::Matrix3<double>&\u2019\r\n/usr/bin/cmake -E cmake_progress_report /home/hsu/projects/gazebo_6/build_release/CMakeFiles \r\n...\r\n~~~\r\n\r\nfollowing patch fixed the problem:\r\n\r\n~~~\r\ndiff -r 832e60ff03d5 include/ignition/math/Matrix3.hh\r\n--- a/include/ignition/math/Matrix3.hh\tWed May 11 09:54:09 2016 -0700\r\n+++ b/include/ignition/math/Matrix3.hh\tThu May 26 16:18:32 2016 -0700\r\n@@ -364,6 +364,22 @@\r\n         return this->Equal(_m, static_cast<T>(1e-6));\r\n       }\r\n \r\n+      public: Matrix3<T> operator=(const Quaternion<T> &_q)\r\n+      {\r\n+        Quaternion<T> qt = _q;\r\n+        qt.Normalize();\r\n+        this->Set(1 - 2*qt.Y()*qt.Y() - 2 *qt.Z()*qt.Z(),\r\n+                  2 * qt.X()*qt.Y() - 2*qt.Z()*qt.W(),\r\n+                  2 * qt.X() * qt.Z() + 2 * qt.Y() * qt.W(),\r\n+                  2 * qt.X() * qt.Y() + 2 * qt.Z() * qt.W(),\r\n+                  1 - 2*qt.X()*qt.X() - 2 * qt.Z()*qt.Z(),\r\n+                  2 * qt.Y() * qt.Z() - 2 * qt.X() * qt.W(),\r\n+                  2 * qt.X() * qt.Z() - 2 * qt.Y() * qt.W(),\r\n+                  2 * qt.Y() * qt.Z() + 2 * qt.X() * qt.W(),\r\n+                  1 - 2 * qt.X()*qt.X() - 2 * qt.Y()*qt.Y());\r\n+        return *this;\r\n+      }\r\n+\r\n       /// \\brief Inequality test operator\r\n       /// \\param[in] _m Matrix3<T> to test\r\n       /// \\return True if not equal (using the default tolerance of 1e-6)\r\n~~~", "markup": "markdown", "html": "<p>compiling</p>\n<p>ign-math - ign-math2 branch, 1025:<a href=\"#!/ignitionrobotics/ign-math/commits/832e60ff03d5\" rel=\"nofollow\" class=\"ap-connect-link\">832e60ff03d5</a></p>\n<p>sdformat - sdf3 branch, 1948:<a href=\"#!/ignitionrobotics/ign-math/commits/5e77af4e606b\" rel=\"nofollow\" class=\"ap-connect-link\">5e77af4e606b</a></p>\n<p>gazebo - gazebo6 branch, 30538:<a href=\"#!/ignitionrobotics/ign-math/commits/b259500cf75a\" rel=\"nofollow\" class=\"ap-connect-link\">b259500cf75a</a></p>\n<p>encountered error:</p>\n<div class=\"codehilite\"><pre><span></span>[ 53%] Building CXX object gazebo/gui/model/CMakeFiles/gazebo_gui_model.dir/moc_JointMaker.cxx.o\ncd /home/hsu/projects/gazebo_6/build_release/gazebo/gui/model &amp;&amp; /usr/bin/c++   -DLIBBULLET_VERSION=2.83 -DLIBBULLET_VERSION_GT_282 -DQT_CORE_LIB -DQT_GUI_LIB -DQT_NO_DEBUG -Dgazebo_gui_model_EXPORTS -Wall -Wextra -Wno-long-long -Wno-unused-value -Wno-unused-value -Wno-unused-value -Wno-unused-value -Wfloat-equal -Wshadow -Winit-self -Wswitch-default -Wmissing-include-dirs -pedantic -fvisibility=hidden -fvisibility-inlines-hidden -std=c++11 -DBUILDING_DLL_GZ_GUI_MODEL  -s -O3 -DNDEBUG -msse4.2 -msse4.1 -mssse3 -msse3 -mfpmath=sse -msse -msse2  -fPIC -I/home/hsu/projects/gazebo_6/test/gtest/include -I/home/hsu/projects/gazebo_6 -I/home/hsu/projects/gazebo_6/build_release -I/home/hsu/projects/gazebo_6/deps -I/home/hsu/projects/gazebo_6/build_release/gazebo/gui/model -I/usr/include/libusb-1.0 -isystem /home/hsu/local_ign-math/include/ignition/math2 -isystem /usr/include/OGRE/RTShaderSystem -isystem /usr/include/OGRE -isystem /usr/include/OGRE/Terrain -isystem /usr/include/OGRE/Paging -isystem /home/hsu/local_sdformat_3/include/sdformat-3.7 -isystem /usr/include/qt4 -isystem /usr/include/qt4/QtGui -isystem /usr/include/qt4/QtCore    -fPIC -std=c++11 -o CMakeFiles/gazebo_gui_model.dir/moc_JointMaker.cxx.o -c /home/hsu/projects/gazebo_6/build_release/gazebo/gui/model/moc_JointMaker.cxx\n/home/hsu/projects/gazebo_6/gazebo/sensors/ForceTorqueSensor.cc: In member function \u2018virtual void gazebo::sensors::ForceTorqueSensor::Load(const string&amp;, sdf::ElementPtr)\u2019:\n/home/hsu/projects/gazebo_6/gazebo/sensors/ForceTorqueSensor.cc:112:29: error: no match for \u2018operator=\u2019 (operand types are \u2018ignition::math::Matrix3d {aka ignition::math::Matrix3&lt;double&gt;}\u2019 and \u2018ignition::math::Quaternion&lt;double&gt;\u2019)\n   this-&gt;rotationSensorChild = rotationChildSensor.Inverse();\n                             ^\n/home/hsu/projects/gazebo_6/gazebo/sensors/ForceTorqueSensor.cc:112:29: note: candidate is:\nIn file included from /home/hsu/local_ign-math/include/ignition/math2/ignition/math/MassMatrix3.hh:28:0,\n                 from /home/hsu/local_ign-math/include/ignition/math2/ignition/math.hh:13,\n                 from /home/hsu/local_sdformat_3/include/sdformat-3.7/sdf/Param.hh:35,\n                 from /home/hsu/local_sdformat_3/include/sdformat-3.7/sdf/Element.hh:25,\n                 from /home/hsu/local_sdformat_3/include/sdformat-3.7/sdf/sdf.hh:5,\n                 from /home/hsu/projects/gazebo_6/gazebo/physics/World.hh:35,\n                 from /home/hsu/projects/gazebo_6/gazebo/sensors/ForceTorqueSensor.cc:25:\n/home/hsu/local_ign-math/include/ignition/math2/ignition/math/Matrix3.hh:33:11: note: ignition::math::Matrix3&lt;double&gt;&amp; ignition::math::Matrix3&lt;double&gt;::operator=(const ignition::math::Matrix3&lt;double&gt;&amp;)\n     class Matrix3\n           ^\n/home/hsu/local_ign-math/include/ignition/math2/ignition/math/Matrix3.hh:33:11: note:   no known conversion for argument 1 from \u2018ignition::math::Quaternion&lt;double&gt;\u2019 to \u2018const ignition::math::Matrix3&lt;double&gt;&amp;\u2019\n/usr/bin/cmake -E cmake_progress_report /home/hsu/projects/gazebo_6/build_release/CMakeFiles \n...\n</pre></div>\n\n\n<p>following patch fixed the problem:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 832e60ff03d5 include/ignition/math/Matrix3.hh</span>\n<span class=\"gd\">--- a/include/ignition/math/Matrix3.hh  Wed May 11 09:54:09 2016 -0700</span>\n<span class=\"gi\">+++ b/include/ignition/math/Matrix3.hh  Thu May 26 16:18:32 2016 -0700</span>\n<span class=\"gu\">@@ -364,6 +364,22 @@</span>\n         return this-&gt;Equal(_m, static_cast&lt;T&gt;(1e-6));\n       }\n\n<span class=\"gi\">+      public: Matrix3&lt;T&gt; operator=(const Quaternion&lt;T&gt; &amp;_q)</span>\n<span class=\"gi\">+      {</span>\n<span class=\"gi\">+        Quaternion&lt;T&gt; qt = _q;</span>\n<span class=\"gi\">+        qt.Normalize();</span>\n<span class=\"gi\">+        this-&gt;Set(1 - 2*qt.Y()*qt.Y() - 2 *qt.Z()*qt.Z(),</span>\n<span class=\"gi\">+                  2 * qt.X()*qt.Y() - 2*qt.Z()*qt.W(),</span>\n<span class=\"gi\">+                  2 * qt.X() * qt.Z() + 2 * qt.Y() * qt.W(),</span>\n<span class=\"gi\">+                  2 * qt.X() * qt.Y() + 2 * qt.Z() * qt.W(),</span>\n<span class=\"gi\">+                  1 - 2*qt.X()*qt.X() - 2 * qt.Z()*qt.Z(),</span>\n<span class=\"gi\">+                  2 * qt.Y() * qt.Z() - 2 * qt.X() * qt.W(),</span>\n<span class=\"gi\">+                  2 * qt.X() * qt.Z() - 2 * qt.Y() * qt.W(),</span>\n<span class=\"gi\">+                  2 * qt.Y() * qt.Z() + 2 * qt.X() * qt.W(),</span>\n<span class=\"gi\">+                  1 - 2 * qt.X()*qt.X() - 2 * qt.Y()*qt.Y());</span>\n<span class=\"gi\">+        return *this;</span>\n<span class=\"gi\">+      }</span>\n<span class=\"gi\">+</span>\n       /// \\brief Inequality test operator\n       /// \\param[in] _m Matrix3&lt;T&gt; to test\n       /// \\return True if not equal (using the default tolerance of 1e-6)\n</pre></div>", "type": "rendered"}, "assignee": null, "state": "wontfix", "version": null, "edited_on": null, "created_on": "2016-05-26T23:39:23.519870+00:00", "milestone": null, "updated_on": "2017-12-19T01:33:23.295931+00:00", "type": "issue", "id": 46}