{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-math/pullrequests/216/comments/52199136.json"}, "html": {"href": "#!/ignitionrobotics/ign-math/pull-requests/216/_/diff#comment-52199136"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 216, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-math/pullrequests/216.json"}, "html": {"href": "#!/ignitionrobotics/ign-math/pull-requests/216"}}, "title": "Versioned inline namespaces"}, "content": {"raw": "Note, bumped into a drawback: Ignition math types can't be forward declared by user code. As a workaround if a user wants to reference a math type they must include the header.\n\nThis code is in ignition rendering\n\n```c++\nnamespace ignition\n{\n  // forward declaration\n  namespace math\n  {\n    class Color;\n  }\n\n  namespace rendering\n  {\n    class RenderTarget\n  /// ...\n      public: virtual math::Color BackgroundColor() const = 0;\n```\nBut it fails to build with the error\n\n```\nIn file included from /workspace/ws_ign/src/ign-rendering/include/ignition/rendering/base/BaseRenderTarget.hh:22:0,\n                 from /workspace/ws_ign/src/ign-rendering/include/ignition/rendering/base/BaseCamera.hh:32,\n                 from /workspace/ws_ign/build_isolated/ign_rendering/include/ignition/rendering/base/base.hh:5,\n                 from /workspace/ws_ign/src/ign-rendering/src/base/BaseScene.cc:27:\n/workspace/ws_ign/src/ign-rendering/include/ignition/rendering/RenderTarget.hh:80:23: error: reference to 'Color' is ambiguous\n       public: virtual math::Color BackgroundColor() const = 0;\n                       ^\n/workspace/ws_ign/src/ign-rendering/include/ignition/rendering/RenderTarget.hh:32:11: note: candidates are: class ignition::math::Color\n     class Color;\n           ^\nIn file included from /workspace/ws_ign/install_isolated/ign_common/include/ignition/common0/ignition/common/Material.hh:24:0,\n                 from /workspace/ws_ign/src/ign-rendering/include/ignition/rendering/Scene.hh:23,\n                 from /workspace/ws_ign/src/ign-rendering/include/ignition/rendering/base/BaseArrowVisual.hh:21,\n                 from /workspace/ws_ign/build_isolated/ign_rendering/include/ignition/rendering/base/base.hh:3,\n                 from /workspace/ws_ign/src/ign-rendering/src/base/BaseScene.cc:27:\n/workspace/ws_ign/install_isolated/ign_math/include/ignition/math4/ignition/math/Color.hh:35:33: note:                 class ignition::ma\nth::v4::Color\n     class IGNITION_MATH_VISIBLE Color\n                                 ^\n```\n\nThe forward declaration created a type `ignition::math::Color`, while the true type is `ignition::math::v4::Color`. Both can be referred to as `ignition::math::Color` so the compiler doesn't know which one to pick.\n", "markup": "markdown", "html": "<p>Note, bumped into a drawback: Ignition math types can't be forward declared by user code. As a workaround if a user wants to reference a math type they must include the header.</p>\n<p>This code is in ignition rendering</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"k\">namespace</span> <span class=\"n\">ignition</span>\n<span class=\"p\">{</span>\n  <span class=\"c1\">// forward declaration</span>\n  <span class=\"k\">namespace</span> <span class=\"n\">math</span>\n  <span class=\"p\">{</span>\n    <span class=\"k\">class</span> <span class=\"nc\">Color</span><span class=\"p\">;</span>\n  <span class=\"p\">}</span>\n\n  <span class=\"k\">namespace</span> <span class=\"n\">rendering</span>\n  <span class=\"p\">{</span>\n    <span class=\"k\">class</span> <span class=\"nc\">RenderTarget</span>\n  <span class=\"c1\">/// ...</span>\n      <span class=\"k\">public</span><span class=\"o\">:</span> <span class=\"k\">virtual</span> <span class=\"n\">math</span><span class=\"o\">::</span><span class=\"n\">Color</span> <span class=\"n\">BackgroundColor</span><span class=\"p\">()</span> <span class=\"k\">const</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n</pre></div>\n\n\n<p>But it fails to build with the error</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nt\">In</span> <span class=\"nt\">file</span> <span class=\"nt\">included</span> <span class=\"nt\">from</span> <span class=\"o\">/</span><span class=\"nt\">workspace</span><span class=\"o\">/</span><span class=\"nt\">ws_ign</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">ign-rendering</span><span class=\"o\">/</span><span class=\"nt\">include</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">rendering</span><span class=\"o\">/</span><span class=\"nt\">base</span><span class=\"o\">/</span><span class=\"nt\">BaseRenderTarget</span><span class=\"p\">.</span><span class=\"nc\">hh</span><span class=\"p\">:</span><span class=\"nd\">22</span><span class=\"p\">:</span><span class=\"nd\">0</span><span class=\"o\">,</span>\n                 <span class=\"nt\">from</span> <span class=\"o\">/</span><span class=\"nt\">workspace</span><span class=\"o\">/</span><span class=\"nt\">ws_ign</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">ign-rendering</span><span class=\"o\">/</span><span class=\"nt\">include</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">rendering</span><span class=\"o\">/</span><span class=\"nt\">base</span><span class=\"o\">/</span><span class=\"nt\">BaseCamera</span><span class=\"p\">.</span><span class=\"nc\">hh</span><span class=\"p\">:</span><span class=\"nd\">32</span><span class=\"o\">,</span>\n                 <span class=\"nt\">from</span> <span class=\"o\">/</span><span class=\"nt\">workspace</span><span class=\"o\">/</span><span class=\"nt\">ws_ign</span><span class=\"o\">/</span><span class=\"nt\">build_isolated</span><span class=\"o\">/</span><span class=\"nt\">ign_rendering</span><span class=\"o\">/</span><span class=\"nt\">include</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">rendering</span><span class=\"o\">/</span><span class=\"nt\">base</span><span class=\"o\">/</span><span class=\"nt\">base</span><span class=\"p\">.</span><span class=\"nc\">hh</span><span class=\"p\">:</span><span class=\"nd\">5</span><span class=\"o\">,</span>\n                 <span class=\"nt\">from</span> <span class=\"o\">/</span><span class=\"nt\">workspace</span><span class=\"o\">/</span><span class=\"nt\">ws_ign</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">ign-rendering</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">base</span><span class=\"o\">/</span><span class=\"nt\">BaseScene</span><span class=\"p\">.</span><span class=\"nc\">cc</span><span class=\"p\">:</span><span class=\"nd\">27</span><span class=\"o\">:</span>\n<span class=\"o\">/</span><span class=\"nt\">workspace</span><span class=\"o\">/</span><span class=\"nt\">ws_ign</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">ign-rendering</span><span class=\"o\">/</span><span class=\"nt\">include</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">rendering</span><span class=\"o\">/</span><span class=\"nt\">RenderTarget</span><span class=\"p\">.</span><span class=\"nc\">hh</span><span class=\"p\">:</span><span class=\"nd\">80</span><span class=\"p\">:</span><span class=\"nd\">23</span><span class=\"o\">:</span> <span class=\"nt\">error</span><span class=\"o\">:</span> <span class=\"nt\">reference</span> <span class=\"nt\">to</span> <span class=\"s1\">&#39;Color&#39;</span> <span class=\"nt\">is</span> <span class=\"nt\">ambiguous</span>\n       <span class=\"nt\">public</span><span class=\"o\">:</span> <span class=\"nt\">virtual</span> <span class=\"nt\">math</span><span class=\"p\">::</span><span class=\"nd\">Color</span> <span class=\"nt\">BackgroundColor</span><span class=\"o\">()</span> <span class=\"nt\">const</span> <span class=\"o\">=</span> <span class=\"nt\">0</span><span class=\"o\">;</span>\n                       <span class=\"o\">^</span>\n<span class=\"o\">/</span><span class=\"nt\">workspace</span><span class=\"o\">/</span><span class=\"nt\">ws_ign</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">ign-rendering</span><span class=\"o\">/</span><span class=\"nt\">include</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">rendering</span><span class=\"o\">/</span><span class=\"nt\">RenderTarget</span><span class=\"p\">.</span><span class=\"nc\">hh</span><span class=\"p\">:</span><span class=\"nd\">32</span><span class=\"p\">:</span><span class=\"nd\">11</span><span class=\"o\">:</span> <span class=\"nt\">note</span><span class=\"o\">:</span> <span class=\"nt\">candidates</span> <span class=\"nt\">are</span><span class=\"o\">:</span> <span class=\"nt\">class</span> <span class=\"nt\">ignition</span><span class=\"p\">::</span><span class=\"nd\">math</span><span class=\"p\">::</span><span class=\"nd\">Color</span>\n     <span class=\"nt\">class</span> <span class=\"nt\">Color</span><span class=\"o\">;</span>\n           <span class=\"o\">^</span>\n<span class=\"nt\">In</span> <span class=\"nt\">file</span> <span class=\"nt\">included</span> <span class=\"nt\">from</span> <span class=\"o\">/</span><span class=\"nt\">workspace</span><span class=\"o\">/</span><span class=\"nt\">ws_ign</span><span class=\"o\">/</span><span class=\"nt\">install_isolated</span><span class=\"o\">/</span><span class=\"nt\">ign_common</span><span class=\"o\">/</span><span class=\"nt\">include</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">common0</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">common</span><span class=\"o\">/</span><span class=\"nt\">Material</span><span class=\"p\">.</span><span class=\"nc\">hh</span><span class=\"p\">:</span><span class=\"nd\">24</span><span class=\"p\">:</span><span class=\"nd\">0</span><span class=\"o\">,</span>\n                 <span class=\"nt\">from</span> <span class=\"o\">/</span><span class=\"nt\">workspace</span><span class=\"o\">/</span><span class=\"nt\">ws_ign</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">ign-rendering</span><span class=\"o\">/</span><span class=\"nt\">include</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">rendering</span><span class=\"o\">/</span><span class=\"nt\">Scene</span><span class=\"p\">.</span><span class=\"nc\">hh</span><span class=\"p\">:</span><span class=\"nd\">23</span><span class=\"o\">,</span>\n                 <span class=\"nt\">from</span> <span class=\"o\">/</span><span class=\"nt\">workspace</span><span class=\"o\">/</span><span class=\"nt\">ws_ign</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">ign-rendering</span><span class=\"o\">/</span><span class=\"nt\">include</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">rendering</span><span class=\"o\">/</span><span class=\"nt\">base</span><span class=\"o\">/</span><span class=\"nt\">BaseArrowVisual</span><span class=\"p\">.</span><span class=\"nc\">hh</span><span class=\"p\">:</span><span class=\"nd\">21</span><span class=\"o\">,</span>\n                 <span class=\"nt\">from</span> <span class=\"o\">/</span><span class=\"nt\">workspace</span><span class=\"o\">/</span><span class=\"nt\">ws_ign</span><span class=\"o\">/</span><span class=\"nt\">build_isolated</span><span class=\"o\">/</span><span class=\"nt\">ign_rendering</span><span class=\"o\">/</span><span class=\"nt\">include</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">rendering</span><span class=\"o\">/</span><span class=\"nt\">base</span><span class=\"o\">/</span><span class=\"nt\">base</span><span class=\"p\">.</span><span class=\"nc\">hh</span><span class=\"p\">:</span><span class=\"nd\">3</span><span class=\"o\">,</span>\n                 <span class=\"nt\">from</span> <span class=\"o\">/</span><span class=\"nt\">workspace</span><span class=\"o\">/</span><span class=\"nt\">ws_ign</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">ign-rendering</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">base</span><span class=\"o\">/</span><span class=\"nt\">BaseScene</span><span class=\"p\">.</span><span class=\"nc\">cc</span><span class=\"p\">:</span><span class=\"nd\">27</span><span class=\"o\">:</span>\n<span class=\"o\">/</span><span class=\"nt\">workspace</span><span class=\"o\">/</span><span class=\"nt\">ws_ign</span><span class=\"o\">/</span><span class=\"nt\">install_isolated</span><span class=\"o\">/</span><span class=\"nt\">ign_math</span><span class=\"o\">/</span><span class=\"nt\">include</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">math4</span><span class=\"o\">/</span><span class=\"nt\">ignition</span><span class=\"o\">/</span><span class=\"nt\">math</span><span class=\"o\">/</span><span class=\"nt\">Color</span><span class=\"p\">.</span><span class=\"nc\">hh</span><span class=\"p\">:</span><span class=\"nd\">35</span><span class=\"p\">:</span><span class=\"nd\">33</span><span class=\"o\">:</span> <span class=\"nt\">note</span><span class=\"o\">:</span>                 <span class=\"nt\">class</span> <span class=\"nt\">ignition</span><span class=\"p\">::</span><span class=\"nd\">ma</span>\n<span class=\"nt\">th</span><span class=\"p\">::</span><span class=\"nd\">v4</span><span class=\"p\">::</span><span class=\"nd\">Color</span>\n     <span class=\"nt\">class</span> <span class=\"nt\">IGNITION_MATH_VISIBLE</span> <span class=\"nt\">Color</span>\n                                 <span class=\"o\">^</span>\n</pre></div>\n\n\n<p>The forward declaration created a type <code>ignition::math::Color</code>, while the true type is <code>ignition::math::v4::Color</code>. Both can be referred to as <code>ignition::math::Color</code> so the compiler doesn't know which one to pick.</p>", "type": "rendered"}, "created_on": "2017-12-18T23:02:41.322748+00:00", "user": {"display_name": "Shane Loretz", "uuid": "{656e3311-aad9-45a1-aaf7-b0ee0e84b287}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B656e3311-aad9-45a1-aaf7-b0ee0e84b287%7D"}, "html": {"href": "https://bitbucket.org/%7B656e3311-aad9-45a1-aaf7-b0ee0e84b287%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:684383ab-ac95-4859-a350-4a6f41a94a22/c7a1ebf5-cade-4115-9f26-9d3facb776db/128"}}, "nickname": "Shane Loretz", "type": "user", "account_id": "557058:684383ab-ac95-4859-a350-4a6f41a94a22"}, "updated_on": "2017-12-18T23:03:18.198395+00:00", "type": "pullrequest_comment", "id": 52199136}