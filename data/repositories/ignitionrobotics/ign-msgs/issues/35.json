{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-msgs.json"}, "html": {"href": "#!/ignitionrobotics/ign-msgs"}, "avatar": {"href": "data/bytebucket.org/ravatar/{a9e7131f-94ac-4283-ae4e-330068146520}ts=1533307"}}, "type": "repository", "name": "ign-msgs", "full_name": "ignitionrobotics/ign-msgs", "uuid": "{a9e7131f-94ac-4283-ae4e-330068146520}"}, "links": {"attachments": {"href": "data/repositories/ignitionrobotics/ign-msgs/issues/35/attachments_page=1.json"}, "self": {"href": "data/repositories/ignitionrobotics/ign-msgs/issues/35.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-msgs/issues/35/watch"}, "comments": {"href": "data/repositories/ignitionrobotics/ign-msgs/issues/35/comments_page=1.json"}, "html": {"href": "#!/ignitionrobotics/ign-msgs/issues/35/citadel-update-jointcmd-and-pid-messages"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-msgs/issues/35/vote"}}, "reporter": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "title": "[Citadel] Update JointCmd and PID messages to support optional fields", "component": null, "votes": 0, "watches": 1, "content": {"raw": "In `gazebo::msgs` and ign-msgs2 and earlier, we used `proto2` syntax, in which it could be determined which fields were unset. Since `ign-msgs3`, we are using `proto3` syntax, in which unset fields of primitive leaf types (string, int, float, etc) are indistinguishable from fields with a default value. This is problematic for the JointController in `osrf/gazebo`, in which position PID, velocity PID, and force control can be applied additively in any combination. It is common to use a PID control along with a feed-forward force parameter to counteract constant disturbances (like gravity compensation).\r\n\r\nCurrently this is problematic for the `JointCmd` and `PID` messages because `JointCMD::force` is a double, and the `target` and gain values in `PID` are `double`. So it will work if you are only sending a `force`, but if you simply want to update the `target` of a PID controller, that will reset the `force` and the PID gains unless you repeat those values.\r\n\r\ncc @{557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8}  @{557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5}  @{557058:90bc87b0-2886-4377-a17c-3a6629a697ff}\r\n\r\nLet's think about doing this before the `ign-msgs5` cutoff.", "markup": "markdown", "html": "<p>In <code>gazebo::msgs</code> and ign-msgs2 and earlier, we used <code>proto2</code> syntax, in which it could be determined which fields were unset. Since <code>ign-msgs3</code>, we are using <code>proto3</code> syntax, in which unset fields of primitive leaf types (string, int, float, etc) are indistinguishable from fields with a default value. This is problematic for the JointController in <code>osrf/gazebo</code>, in which position PID, velocity PID, and force control can be applied additively in any combination. It is common to use a PID control along with a feed-forward force parameter to counteract constant disturbances (like gravity compensation).</p>\n<p>Currently this is problematic for the <code>JointCmd</code> and <code>PID</code> messages because <code>JointCMD::force</code> is a double, and the <code>target</code> and gain values in <code>PID</code> are <code>double</code>. So it will work if you are only sending a <code>force</code>, but if you simply want to update the <code>target</code> of a PID controller, that will reset the <code>force</code> and the PID gains unless you repeat those values.</p>\n<p>cc <span class=\"ap-mention\" data-atlassian-id=\"557058:6ff86fcb-b7ab-44a5-b8a6-f6d9cae8b6e8\">@Louise Poubel</span>  <span class=\"ap-mention\" data-atlassian-id=\"557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5\">@Ian Chen</span>  <span class=\"ap-mention\" data-atlassian-id=\"557058:90bc87b0-2886-4377-a17c-3a6629a697ff\">@Addisu Z. Taddese</span></p>\n<p>Let's think about doing this before the <code>ign-msgs5</code> cutoff.</p>", "type": "rendered"}, "assignee": null, "state": "new", "version": null, "edited_on": null, "created_on": "2019-11-14T01:46:44.908610+00:00", "milestone": null, "updated_on": "2019-11-14T01:47:47.832017+00:00", "type": "issue", "id": 35}