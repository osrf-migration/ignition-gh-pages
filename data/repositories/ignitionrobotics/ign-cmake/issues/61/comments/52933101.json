{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-cmake/issues/61/comments/52933101.json"}, "html": {"href": "#!/ignitionrobotics/ign-cmake/issues/61#comment-52933101"}}, "issue": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-cmake/issues/61.json"}}, "type": "issue", "id": 61, "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-cmake.json"}, "html": {"href": "#!/ignitionrobotics/ign-cmake"}, "avatar": {"href": "data/bytebucket.org/ravatar/{3e77bcf7-f260-4cec-a1a0-116b8e298901}ts=default"}}, "type": "repository", "name": "ign-cmake", "full_name": "ignitionrobotics/ign-cmake", "uuid": "{3e77bcf7-f260-4cec-a1a0-116b8e298901}"}, "title": "IGNITION_CMAKE_VERSION_MAJOR changes after finding packages that use newer version of ign-cmake"}, "content": {"raw": "I can reproduce the issue with this workspace:\n\n~~~\nrepositories:\n  ign-cmake1:\n    type: hg\n    url: #!/ignitionrobotics/ign-cmake\n    version: ca665459dbe2\n  ign-cmake2:\n    type: hg\n    url: #!/ignitionrobotics/ign-cmake\n    version: 6053a9727e17\n  ign-common:\n    type: hg\n    url: #!/ignitionrobotics/ign-common\n    version: 8d76e774aa27\n  ign-math:\n    type: hg\n    url: #!/ignitionrobotics/ign-math\n    version: 6244467771ba\n  ign-msgs:\n    type: hg\n    url: #!/ignitionrobotics/ign-msgs\n    version: 4f306ba30be2\n  ign-transport:\n    type: hg\n    url: #!/ignitionrobotics/ign-transport\n    version: 90f685aa340f\n~~~\n\nI believe it happens in this example because `ign-transport`'s core library [exports a dependency on `ignition-cmake1::utilities`](\n#!/ignitionrobotics/ign-transport/src/ignition-transport5_5.0.0/src/CMakeLists.txt#lines-11), but since it depends on a version of ign-msgs2 that uses ignition-math6 and ignition-cmake2, something gets a bit mixed up. When I grep for `ignition-cmake` in the installed cmake config files, I see `ignition-cmake1::utilities` in `ignition-transport5-targets.cmake` and `find_dependency(ignition-cmake2)` in `ignition-transport5-config.cmake`.\n\n~~~\nignition-transport5-targets.cmake:59:  INTERFACE_LINK_LIBRARIES \"ignition-cmake1::utilities;ignition-msgs2::ignition-msgs2;UUID::UUID\"\nignition-transport5-config.cmake:61:# Find ignition-cmake, because we need its modules in order to find the rest of\nignition-transport5-config.cmake:63:find_dependency(ignition-cmake2)\n~~~\n\nThe `IGNITION_CMAKE_VERSION_MAJOR` is `1` when `find_package(ignition-cmake1)` is first called, but it changes to `2` after `ign_find_package(ignition-msgs2)`.", "markup": "markdown", "html": "<p>I can reproduce the issue with this workspace:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">repositories</span><span class=\"o\">:</span>\n  <span class=\"n\">ign</span><span class=\"o\">-</span><span class=\"n\">cmake1</span><span class=\"o\">:</span>\n    <span class=\"n\">type</span><span class=\"o\">:</span> <span class=\"n\">hg</span>\n    <span class=\"n\">url</span><span class=\"o\">:</span> <span class=\"n\">https</span><span class=\"o\">://</span><span class=\"n\">bitbucket</span><span class=\"o\">.</span><span class=\"na\">org</span><span class=\"sr\">/ignitionrobotics/ig</span><span class=\"n\">n</span><span class=\"o\">-</span><span class=\"n\">cmake</span>\n    <span class=\"n\">version</span><span class=\"o\">:</span> <span class=\"n\">ca665459dbe2</span>\n  <span class=\"n\">ign</span><span class=\"o\">-</span><span class=\"n\">cmake2</span><span class=\"o\">:</span>\n    <span class=\"n\">type</span><span class=\"o\">:</span> <span class=\"n\">hg</span>\n    <span class=\"n\">url</span><span class=\"o\">:</span> <span class=\"n\">https</span><span class=\"o\">://</span><span class=\"n\">bitbucket</span><span class=\"o\">.</span><span class=\"na\">org</span><span class=\"sr\">/ignitionrobotics/ig</span><span class=\"n\">n</span><span class=\"o\">-</span><span class=\"n\">cmake</span>\n    <span class=\"n\">version</span><span class=\"o\">:</span> <span class=\"mi\">6053</span><span class=\"n\">a9727e17</span>\n  <span class=\"n\">ign</span><span class=\"o\">-</span><span class=\"n\">common</span><span class=\"o\">:</span>\n    <span class=\"n\">type</span><span class=\"o\">:</span> <span class=\"n\">hg</span>\n    <span class=\"n\">url</span><span class=\"o\">:</span> <span class=\"n\">https</span><span class=\"o\">://</span><span class=\"n\">bitbucket</span><span class=\"o\">.</span><span class=\"na\">org</span><span class=\"sr\">/ignitionrobotics/ig</span><span class=\"n\">n</span><span class=\"o\">-</span><span class=\"n\">common</span>\n    <span class=\"n\">version</span><span class=\"o\">:</span> <span class=\"mi\">8</span><span class=\"n\">d76e774aa27</span>\n  <span class=\"n\">ign</span><span class=\"o\">-</span><span class=\"n\">math</span><span class=\"o\">:</span>\n    <span class=\"n\">type</span><span class=\"o\">:</span> <span class=\"n\">hg</span>\n    <span class=\"n\">url</span><span class=\"o\">:</span> <span class=\"n\">https</span><span class=\"o\">://</span><span class=\"n\">bitbucket</span><span class=\"o\">.</span><span class=\"na\">org</span><span class=\"sr\">/ignitionrobotics/ig</span><span class=\"n\">n</span><span class=\"o\">-</span><span class=\"n\">math</span>\n    <span class=\"n\">version</span><span class=\"o\">:</span> <span class=\"mi\">6244467771</span><span class=\"n\">ba</span>\n  <span class=\"n\">ign</span><span class=\"o\">-</span><span class=\"n\">msgs</span><span class=\"o\">:</span>\n    <span class=\"n\">type</span><span class=\"o\">:</span> <span class=\"n\">hg</span>\n    <span class=\"n\">url</span><span class=\"o\">:</span> <span class=\"n\">https</span><span class=\"o\">://</span><span class=\"n\">bitbucket</span><span class=\"o\">.</span><span class=\"na\">org</span><span class=\"sr\">/ignitionrobotics/ig</span><span class=\"n\">n</span><span class=\"o\">-</span><span class=\"n\">msgs</span>\n    <span class=\"n\">version</span><span class=\"o\">:</span> <span class=\"mi\">4</span><span class=\"n\">f306ba30be2</span>\n  <span class=\"n\">ign</span><span class=\"o\">-</span><span class=\"n\">transport</span><span class=\"o\">:</span>\n    <span class=\"n\">type</span><span class=\"o\">:</span> <span class=\"n\">hg</span>\n    <span class=\"n\">url</span><span class=\"o\">:</span> <span class=\"n\">https</span><span class=\"o\">://</span><span class=\"n\">bitbucket</span><span class=\"o\">.</span><span class=\"na\">org</span><span class=\"sr\">/ignitionrobotics/ig</span><span class=\"n\">n</span><span class=\"o\">-</span><span class=\"n\">transport</span>\n    <span class=\"n\">version</span><span class=\"o\">:</span> <span class=\"mi\">90</span><span class=\"n\">f685aa340f</span>\n</pre></div>\n\n\n<p>I believe it happens in this example because <code>ign-transport</code>'s core library <a data-is-external-link=\"true\" href=\"#!/ignitionrobotics/ign-transport/src/ignition-transport5_5.0.0/src/CMakeLists.txt#lines-11\" rel=\"nofollow\">exports a dependency on <code>ignition-cmake1::utilities</code></a>, but since it depends on a version of ign-msgs2 that uses ignition-math6 and ignition-cmake2, something gets a bit mixed up. When I grep for <code>ignition-cmake</code> in the installed cmake config files, I see <code>ignition-cmake1::utilities</code> in <code>ignition-transport5-targets.cmake</code> and <code>find_dependency(ignition-cmake2)</code> in <code>ignition-transport5-config.cmake</code>.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nt\">ignition-transport5-targets</span><span class=\"p\">.</span><span class=\"nc\">cmake</span><span class=\"p\">:</span><span class=\"nd\">59</span><span class=\"o\">:</span>  <span class=\"nt\">INTERFACE_LINK_LIBRARIES</span> <span class=\"s2\">&quot;ignition-cmake1::utilities;ignition-msgs2::ignition-msgs2;UUID::UUID&quot;</span>\n<span class=\"nt\">ignition-transport5-config</span><span class=\"p\">.</span><span class=\"nc\">cmake</span><span class=\"p\">:</span><span class=\"nd\">61</span><span class=\"o\">:</span><span class=\"err\">#</span> <span class=\"nt\">Find</span> <span class=\"nt\">ignition-cmake</span><span class=\"o\">,</span> <span class=\"nt\">because</span> <span class=\"nt\">we</span> <span class=\"nt\">need</span> <span class=\"nt\">its</span> <span class=\"nt\">modules</span> <span class=\"nt\">in</span> <span class=\"nt\">order</span> <span class=\"nt\">to</span> <span class=\"nt\">find</span> <span class=\"nt\">the</span> <span class=\"nt\">rest</span> <span class=\"nt\">of</span>\n<span class=\"nt\">ignition-transport5-config</span><span class=\"p\">.</span><span class=\"nc\">cmake</span><span class=\"p\">:</span><span class=\"nd\">63</span><span class=\"p\">:</span><span class=\"nd\">find_dependency</span><span class=\"o\">(</span><span class=\"nt\">ignition-cmake2</span><span class=\"o\">)</span>\n</pre></div>\n\n\n<p>The <code>IGNITION_CMAKE_VERSION_MAJOR</code> is <code>1</code> when <code>find_package(ignition-cmake1)</code> is first called, but it changes to <code>2</code> after <code>ign_find_package(ignition-msgs2)</code>.</p>", "type": "rendered"}, "created_on": "2019-07-10T21:32:37.211175+00:00", "user": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "updated_on": null, "type": "issue_comment", "id": 52933101}