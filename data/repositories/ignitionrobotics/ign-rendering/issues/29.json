{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-rendering.json"}, "html": {"href": "#!/ignitionrobotics/ign-rendering"}, "avatar": {"href": "data/bytebucket.org/ravatar/{f6b404b6-f373-460d-a470-69ff6f27cd93}ts=1533308"}}, "type": "repository", "name": "ign-rendering", "full_name": "ignitionrobotics/ign-rendering", "uuid": "{f6b404b6-f373-460d-a470-69ff6f27cd93}"}, "links": {"attachments": {"href": "data/repositories/ignitionrobotics/ign-rendering/issues/29/attachments_page=1.json"}, "self": {"href": "data/repositories/ignitionrobotics/ign-rendering/issues/29.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-rendering/issues/29/watch"}, "comments": {"href": "data/repositories/ignitionrobotics/ign-rendering/issues/29/comments_page=1.json"}, "html": {"href": "#!/ignitionrobotics/ign-rendering/issues/29/depthcamera-compilation-error-on-clang"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/ignitionrobotics/ign-rendering/issues/29/vote"}}, "reporter": {"display_name": "Steve Peters", "uuid": "{2ccfed09-18b8-4921-8d58-15ef01092802}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D"}, "html": {"href": "https://bitbucket.org/%7B2ccfed09-18b8-4921-8d58-15ef01092802%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/1fb4816dad9e68337d3096f750951f6cd=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsSP-1.png"}}, "nickname": "Steven Peters", "type": "user", "account_id": "557058:5de38267-b118-494c-aa76-4fab35448816"}, "title": "DepthCamera compilation error on clang / macOS", "component": {"name": "ogre1.x", "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-rendering/components/453289.json"}}}, "votes": 0, "watches": 1, "content": {"raw": "There is a compilation error for clang / macOS in `OgreScene.cc` related to the `DepthCamera` class since pull request #93. I haven't tested with clang on Ubuntu yet.\r\n\r\n~~~\r\nogre/src/OgreScene.cc:376:34: error: no viable conversion from 'shared_ptr<ignition::rendering::v1::OgreDepthCamera>' to\r\n      'shared_ptr<ignition::rendering::v1::OgreObject>'\r\n  bool result = this->InitObject(camera, _id, _name);\r\n                                 ^~~~~~\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3703:23: note: candidate constructor not viable: no known conversion from\r\n      'ignition::rendering::v1::OgreDepthCameraPtr' (aka 'std::__1::shared_ptr<ignition::rendering::v1::OgreDepthCamera>') to 'std::nullptr_t' (aka 'nullptr_t') for 1st argument\r\n    _LIBCPP_CONSTEXPR shared_ptr(nullptr_t) _NOEXCEPT;\r\n                      ^\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3717:5: note: candidate constructor not viable: no known conversion from\r\n      'ignition::rendering::v1::OgreDepthCameraPtr' (aka 'std::__1::shared_ptr<ignition::rendering::v1::OgreDepthCamera>') to 'const\r\n      std::__1::shared_ptr<ignition::rendering::v1::OgreObject> &' for 1st argument\r\n    shared_ptr(const shared_ptr& __r) _NOEXCEPT;\r\n    ^\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3725:5: note: candidate constructor not viable: no known conversion from\r\n      'ignition::rendering::v1::OgreDepthCameraPtr' (aka 'std::__1::shared_ptr<ignition::rendering::v1::OgreDepthCamera>') to\r\n      'std::__1::shared_ptr<ignition::rendering::v1::OgreObject> &&' for 1st argument\r\n    shared_ptr(shared_ptr&& __r) _NOEXCEPT;\r\n    ^\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3720:9: note: candidate template ignored: requirement\r\n      'is_convertible<OgreDepthCamera *, element_type *>::value' was not satisfied [with _Yp = ignition::rendering::v1::OgreDepthCamera]\r\n        shared_ptr(const shared_ptr<_Yp>& __r,\r\n        ^\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3726:52: note: candidate template ignored: requirement\r\n      'is_convertible<OgreDepthCamera *, element_type *>::value' was not satisfied [with _Yp = ignition::rendering::v1::OgreDepthCamera]\r\n    template<class _Yp> _LIBCPP_INLINE_VISIBILITY  shared_ptr(shared_ptr<_Yp>&& __r,\r\n                                                   ^\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3745:9: note: candidate template ignored: could not match 'unique_ptr'\r\n      against 'shared_ptr'\r\n        shared_ptr(unique_ptr<_Yp, _Dp>&&,\r\n        ^\r\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3754:9: note: candidate template ignored: could not match 'unique_ptr'\r\n      against 'shared_ptr'\r\n        shared_ptr(unique_ptr<_Yp, _Dp>&&,\r\n        ^\r\n/Users/jenkins/Desktop/ign-rendering/ogre/include/ignition/rendering/ogre/OgreScene.hh:142:56: note: passing argument to parameter '_object' here\r\n      protected: virtual bool InitObject(OgreObjectPtr _object,\r\n                                                       ^\r\n1 error generated.\r\n\r\n~~~\r\n\r\nThe clearest way to see the error is by adding the following `static_assert`:\r\n\r\n~~~\r\ndiff -r 153ef8853a87 ogre/src/OgreDepthCamera.cc\r\n--- a/ogre/src/OgreDepthCamera.cc       Thu Oct 11 11:47:22 2018 -0700\r\n+++ b/ogre/src/OgreDepthCamera.cc       Thu Oct 11 15:59:53 2018 -0700\r\n@@ -15,6 +15,7 @@\r\n  *\r\n */\r\n \r\n+#include <type_traits>\r\n #include \"ignition/rendering/ogre/OgreDepthCamera.hh\"\r\n #include <ignition/math/Helpers.hh>\r\n #if (_WIN32)\r\n@@ -30,6 +31,7 @@\r\n OgreDepthCamera::OgreDepthCamera()\r\n   : dataPtr(new OgreDepthCameraPrivate())\r\n {\r\n+  static_assert(std::is_convertible<OgreDepthCamera*, OgreObject*>::value);\r\n }\r\n \r\n //////////////////////////////////////////////////\r\n~~~\r\n\r\nThis passes on Ubuntu with gcc, but fails on macOS with clang:\r\n\r\n~~~\r\nogre/src/OgreDepthCamera.cc:34:3:\r\n error: static_assert failed due to requirement 'std::is_convertible<OgreDepthCamera *, OgreObject *>::value'\r\n  static_assert(std::is_convertible<OgreDepthCamera*, OgreObject*>::value);\r\n  ^             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n1 error generated.\r\nmake[2]: *** [ogre/src/CMakeFiles/ignition-rendering1-ogre.dir/OgreDepthCamera.cc.o] Error 1\r\nmake[1]: *** [ogre/src/CMakeFiles/ignition-rendering1-ogre.dir/all] Error 2\r\nmake: *** [all] Error 2\r\n~~~\r\n\r\ncc @JChoclin", "markup": "markdown", "html": "<p>There is a compilation error for clang / macOS in <code>OgreScene.cc</code> related to the <code>DepthCamera</code> class since <a href=\"#!/ignitionrobotics/ign-rendering/pull-requests/93/depth-camera\" rel=\"nofollow\" class=\"ap-connect-link\">pull request #93</a>. I haven't tested with clang on Ubuntu yet.</p>\n<div class=\"codehilite\"><pre><span></span>ogre/src/OgreScene.cc:376:34: error: no viable conversion from &#39;shared_ptr&lt;ignition::rendering::v1::OgreDepthCamera&gt;&#39; to\n      &#39;shared_ptr&lt;ignition::rendering::v1::OgreObject&gt;&#39;\n  bool result = this-&gt;InitObject(camera, _id, _name);\n                                 ^~~~~~\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3703:23: note: candidate constructor not viable: no known conversion from\n      &#39;ignition::rendering::v1::OgreDepthCameraPtr&#39; (aka &#39;std::__1::shared_ptr&lt;ignition::rendering::v1::OgreDepthCamera&gt;&#39;) to &#39;std::nullptr_t&#39; (aka &#39;nullptr_t&#39;) for 1st argument\n    _LIBCPP_CONSTEXPR shared_ptr(nullptr_t) _NOEXCEPT;\n                      ^\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3717:5: note: candidate constructor not viable: no known conversion from\n      &#39;ignition::rendering::v1::OgreDepthCameraPtr&#39; (aka &#39;std::__1::shared_ptr&lt;ignition::rendering::v1::OgreDepthCamera&gt;&#39;) to &#39;const\n      std::__1::shared_ptr&lt;ignition::rendering::v1::OgreObject&gt; &amp;&#39; for 1st argument\n    shared_ptr(const shared_ptr&amp; __r) _NOEXCEPT;\n    ^\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3725:5: note: candidate constructor not viable: no known conversion from\n      &#39;ignition::rendering::v1::OgreDepthCameraPtr&#39; (aka &#39;std::__1::shared_ptr&lt;ignition::rendering::v1::OgreDepthCamera&gt;&#39;) to\n      &#39;std::__1::shared_ptr&lt;ignition::rendering::v1::OgreObject&gt; &amp;&amp;&#39; for 1st argument\n    shared_ptr(shared_ptr&amp;&amp; __r) _NOEXCEPT;\n    ^\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3720:9: note: candidate template ignored: requirement\n      &#39;is_convertible&lt;OgreDepthCamera *, element_type *&gt;::value&#39; was not satisfied [with _Yp = ignition::rendering::v1::OgreDepthCamera]\n        shared_ptr(const shared_ptr&lt;_Yp&gt;&amp; __r,\n        ^\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3726:52: note: candidate template ignored: requirement\n      &#39;is_convertible&lt;OgreDepthCamera *, element_type *&gt;::value&#39; was not satisfied [with _Yp = ignition::rendering::v1::OgreDepthCamera]\n    template&lt;class _Yp&gt; _LIBCPP_INLINE_VISIBILITY  shared_ptr(shared_ptr&lt;_Yp&gt;&amp;&amp; __r,\n                                                   ^\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3745:9: note: candidate template ignored: could not match &#39;unique_ptr&#39;\n      against &#39;shared_ptr&#39;\n        shared_ptr(unique_ptr&lt;_Yp, _Dp&gt;&amp;&amp;,\n        ^\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/memory:3754:9: note: candidate template ignored: could not match &#39;unique_ptr&#39;\n      against &#39;shared_ptr&#39;\n        shared_ptr(unique_ptr&lt;_Yp, _Dp&gt;&amp;&amp;,\n        ^\n/Users/jenkins/Desktop/ign-rendering/ogre/include/ignition/rendering/ogre/OgreScene.hh:142:56: note: passing argument to parameter &#39;_object&#39; here\n      protected: virtual bool InitObject(OgreObjectPtr _object,\n                                                       ^\n1 error generated.\n</pre></div>\n\n\n<p>The clearest way to see the error is by adding the following <code>static_assert</code>:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r 153ef8853a87 ogre/src/OgreDepthCamera.cc</span>\n<span class=\"gd\">--- a/ogre/src/OgreDepthCamera.cc       Thu Oct 11 11:47:22 2018 -0700</span>\n<span class=\"gi\">+++ b/ogre/src/OgreDepthCamera.cc       Thu Oct 11 15:59:53 2018 -0700</span>\n<span class=\"gu\">@@ -15,6 +15,7 @@</span>\n  *\n */\n\n<span class=\"gi\">+#include &lt;type_traits&gt;</span>\n #include &quot;ignition/rendering/ogre/OgreDepthCamera.hh&quot;\n #include &lt;ignition/math/Helpers.hh&gt;\n #if (_WIN32)\n<span class=\"gu\">@@ -30,6 +31,7 @@</span>\n OgreDepthCamera::OgreDepthCamera()\n   : dataPtr(new OgreDepthCameraPrivate())\n {\n<span class=\"gi\">+  static_assert(std::is_convertible&lt;OgreDepthCamera*, OgreObject*&gt;::value);</span>\n }\n\n //////////////////////////////////////////////////\n</pre></div>\n\n\n<p>This passes on Ubuntu with gcc, but fails on macOS with clang:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nt\">ogre</span><span class=\"o\">/</span><span class=\"nt\">src</span><span class=\"o\">/</span><span class=\"nt\">OgreDepthCamera</span><span class=\"p\">.</span><span class=\"nc\">cc</span><span class=\"p\">:</span><span class=\"nd\">34</span><span class=\"p\">:</span><span class=\"nd\">3</span><span class=\"o\">:</span>\n <span class=\"nt\">error</span><span class=\"o\">:</span> <span class=\"nt\">static_assert</span> <span class=\"nt\">failed</span> <span class=\"nt\">due</span> <span class=\"nt\">to</span> <span class=\"nt\">requirement</span> <span class=\"s1\">&#39;std::is_convertible&lt;OgreDepthCamera *, OgreObject *&gt;::value&#39;</span>\n  <span class=\"nt\">static_assert</span><span class=\"o\">(</span><span class=\"nt\">std</span><span class=\"p\">::</span><span class=\"nd\">is_convertible</span><span class=\"o\">&lt;</span><span class=\"nt\">OgreDepthCamera</span><span class=\"o\">*,</span> <span class=\"nt\">OgreObject</span><span class=\"o\">*&gt;</span><span class=\"p\">::</span><span class=\"nd\">value</span><span class=\"o\">);</span>\n  <span class=\"o\">^</span>             <span class=\"o\">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>\n<span class=\"nt\">1</span> <span class=\"nt\">error</span> <span class=\"nt\">generated</span><span class=\"o\">.</span>\n<span class=\"nt\">make</span><span class=\"cp\">[</span><span class=\"mi\">2</span><span class=\"cp\">]</span><span class=\"o\">:</span> <span class=\"o\">***</span> <span class=\"cp\">[</span><span class=\"nx\">ogre</span><span class=\"p\">/</span><span class=\"nx\">src</span><span class=\"p\">/</span><span class=\"nx\">CMakeFiles</span><span class=\"p\">/</span><span class=\"nx\">ignition</span><span class=\"na\">-rendering1-ogre.dir</span><span class=\"p\">/</span><span class=\"nx\">OgreDepthCamera.cc.o</span><span class=\"cp\">]</span> <span class=\"nt\">Error</span> <span class=\"nt\">1</span>\n<span class=\"nt\">make</span><span class=\"cp\">[</span><span class=\"mi\">1</span><span class=\"cp\">]</span><span class=\"o\">:</span> <span class=\"o\">***</span> <span class=\"cp\">[</span><span class=\"nx\">ogre</span><span class=\"p\">/</span><span class=\"nx\">src</span><span class=\"p\">/</span><span class=\"nx\">CMakeFiles</span><span class=\"p\">/</span><span class=\"nx\">ignition</span><span class=\"na\">-rendering1-ogre.dir</span><span class=\"p\">/</span><span class=\"nb\">all</span><span class=\"cp\">]</span> <span class=\"nt\">Error</span> <span class=\"nt\">2</span>\n<span class=\"nt\">make</span><span class=\"o\">:</span> <span class=\"o\">***</span> <span class=\"cp\">[</span><span class=\"kc\">all</span><span class=\"cp\">]</span> <span class=\"nt\">Error</span> <span class=\"nt\">2</span>\n</pre></div>\n\n\n<p>cc @JChoclin</p>", "type": "rendered"}, "assignee": null, "state": "resolved", "version": null, "edited_on": null, "created_on": "2018-10-11T23:06:18.265283+00:00", "milestone": null, "updated_on": "2018-10-25T21:42:35.687361+00:00", "type": "issue", "id": 29}