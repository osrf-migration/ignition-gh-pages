{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-rendering/pullrequests/234/comments/135705128.json"}, "html": {"href": "#!/ignitionrobotics/ign-rendering/pull-requests/234/_/diff#comment-135705128"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 234, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-rendering/pullrequests/234.json"}, "html": {"href": "#!/ignitionrobotics/ign-rendering/pull-requests/234"}}, "title": "Prevent flaky crash"}, "content": {"raw": "Pasting likely related Ogre bug stacktrace for reference:\n\n```\nruby: /var/lib/jenkins/workspace/ogre-2.1-debbuilder/repo/Components/Hlms/Pbs/src/OgreHlmsPbs.cpp:1700: virtual Ogre::HlmsCache Ogre::HlmsPbs::preparePassHash(const Ogre::CompositorShadowNode*, bool, bool, Ogre::SceneManager*): Assertion `(size_t)(passBufferPtr - startupPtr) * 4u == mapSize' failed.\n\nThread 15 \"ignition::gazeb\" received signal SIGABRT, Aborted.\n[Switching to Thread 0x7fff95c74700 (LWP 29014)]\n__GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\n51\t../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n(gdb) up\n#1  0x00007ffff7573801 in __GI_abort () at abort.c:79\n79\tabort.c: No such file or directory.\n(gdb) \n#2  0x00007ffff756339a in __assert_fail_base (fmt=0x7ffff76ea7d8 \"%s%s%s:%u: %s%sAssertion `%s' failed.\\n%n\", assertion=assertion@entry=0x7fff945b1308 \"(size_t)(passBufferPtr - startupPtr) * 4u == mapSize\", \n    file=file@entry=0x7fff945b0ba0 \"/var/lib/jenkins/workspace/ogre-2.1-debbuilder/repo/Components/Hlms/Pbs/src/OgreHlmsPbs.cpp\", line=line@entry=1700, \n    function=function@entry=0x7fff945b1f40 \"virtual Ogre::HlmsCache Ogre::HlmsPbs::preparePassHash(const Ogre::CompositorShadowNode*, bool, bool, Ogre::SceneManager*)\") at assert.c:92\n92\tassert.c: No such file or directory.\n(gdb) \n#3  0x00007ffff7563412 in __GI___assert_fail (assertion=0x7fff945b1308 \"(size_t)(passBufferPtr - startupPtr) * 4u == mapSize\", \n    file=0x7fff945b0ba0 \"/var/lib/jenkins/workspace/ogre-2.1-debbuilder/repo/Components/Hlms/Pbs/src/OgreHlmsPbs.cpp\", line=1700, \n    function=0x7fff945b1f40 \"virtual Ogre::HlmsCache Ogre::HlmsPbs::preparePassHash(const Ogre::CompositorShadowNode*, bool, bool, Ogre::SceneManager*)\") at assert.c:101\n101\tin assert.c\n(gdb) \n#4  0x00007fff94588c48 in Ogre::HlmsPbs::preparePassHash(Ogre::CompositorShadowNode const*, bool, bool, Ogre::SceneManager*) () from /usr/lib/x86_64-linux-gnu/libOgreHlmsPbs.so.2.1.0\n(gdb) \n#5  0x00007fff94ac6e70 in Ogre::RenderQueue::render(Ogre::RenderSystem*, unsigned char, unsigned char, bool, bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#6  0x00007fff94b0e802 in Ogre::SceneManager::_renderPhase02(Ogre::Camera*, Ogre::Camera const*, Ogre::Viewport*, unsigned char, unsigned char, bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#7  0x00007fff94928716 in Ogre::Camera::_renderScenePhase02(Ogre::Camera const*, Ogre::Viewport*, unsigned char, unsigned char, bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#8  0x00007fff94ae19b9 in Ogre::RenderTarget::_updateViewportRenderPhase02(Ogre::Viewport*, Ogre::Camera*, Ogre::Camera const*, unsigned char, unsigned char, bool) ()\n   from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#9  0x00007fff94c399ca in Ogre::CompositorPassScene::execute(Ogre::Camera const*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#10 0x00007fff94c14c67 in Ogre::CompositorNode::_update(Ogre::Camera const*, Ogre::SceneManager*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#11 0x00007fff94c278ca in Ogre::CompositorWorkspace::_update() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#12 0x00007fff94c0f3c1 in Ogre::CompositorManager2::_updateImplementation(Ogre::SceneManagerEnumerator&, Ogre::HlmsManager*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#13 0x00007fff94b00f95 in Ogre::Root::_updateAllRenderTargets() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#14 0x00007fff94b010fc in Ogre::Root::renderOneFrame() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n\n#15 0x00007fff950d77a5 in ignition::rendering::v2::Ogre2RenderTarget::Render (this=0x7fff886e5fb0) at /home/john/ign-ws/src/ign-rendering/ogre2/src/Ogre2RenderTarget.cc:173\n173\t  engine->OgreRoot()->renderOneFrame();\n(gdb) \n\n#16 0x00007fff9508d3f6 in ignition::rendering::v2::BaseCamera<ignition::rendering::v2::Ogre2Sensor>::Update (this=0x7fff886c3a20) at /usr/include/c++/8/ext/atomicity.h:82\n82\t      return __exchange_and_add(__mem, __val);\n(gdb) \n\n#17 0x00007fffac56451d in ignition::gazebo::v2::IgnRenderer::Render (this=0x555556fc76a0) at /usr/include/c++/8/bits/shared_ptr_base.h:1018\n1018\t      _M_get() const noexcept\n(gdb) \n#18 0x00007fffac565276 in ignition::gazebo::v2::RenderThread::RenderNext (this=0x555556fc7680) at /home/john/ign-ws/src/ign-gazebo/src/gui/plugins/scene3d/Scene3D.cc:1323\n1323\t  this->ignRenderer.Render();\n(gdb) \n#19 0x00007ffff117e0c2 in QObject::event(QEvent*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#20 0x00007ffff114e76a in QCoreApplication::notify(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#21 0x00007ffff114e8d8 in QCoreApplication::notifyInternal2(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#22 0x00007ffff115104d in QCoreApplicationPrivate::sendPostedEvents(QObject*, int, QThreadData*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#23 0x00007ffff11a8263 in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#24 0x00007fffed84a417 in g_main_context_dispatch () from /usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\n(gdb) \n#25 0x00007fffed84a650 in ?? () from /usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\n(gdb) \n#26 0x00007fffed84a6dc in g_main_context_iteration () from /usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\n(gdb) \n#27 0x00007ffff11a788f in QEventDispatcherGlib::processEvents(QFlags<QEventLoop::ProcessEventsFlag>) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#28 0x00007ffff114c90a in QEventLoop::exec(QFlags<QEventLoop::ProcessEventsFlag>) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#29 0x00007ffff0f6b23a in QThread::exec() () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#30 0x00007ffff0f7017d in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#31 0x00007ffff731b6db in start_thread (arg=0x7fff95c74700) at pthread_create.c:463\n463\tpthread_create.c: No such file or directory.\n(gdb) \n#32 0x00007ffff765488f in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:95\n95\t../sysdeps/unix/sysv/linux/x86_64/clone.S: No such file or directory.\n(gdb) \n```\n\n\u200c", "markup": "markdown", "html": "<p>Pasting likely related Ogre bug stacktrace for reference:</p>\n<div class=\"codehilite\"><pre><span></span>ruby: /var/lib/jenkins/workspace/ogre-2.1-debbuilder/repo/Components/Hlms/Pbs/src/OgreHlmsPbs.cpp:1700: virtual Ogre::HlmsCache Ogre::HlmsPbs::preparePassHash(const Ogre::CompositorShadowNode*, bool, bool, Ogre::SceneManager*): Assertion `(size_t)(passBufferPtr - startupPtr) * 4u == mapSize&#39; failed.\n\nThread 15 &quot;ignition::gazeb&quot; received signal SIGABRT, Aborted.\n[Switching to Thread 0x7fff95c74700 (LWP 29014)]\n__GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\n51  ../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n(gdb) up\n#1  0x00007ffff7573801 in __GI_abort () at abort.c:79\n79  abort.c: No such file or directory.\n(gdb) \n#2  0x00007ffff756339a in __assert_fail_base (fmt=0x7ffff76ea7d8 &quot;%s%s%s:%u: %s%sAssertion `%s&#39; failed.\\n%n&quot;, assertion=assertion@entry=0x7fff945b1308 &quot;(size_t)(passBufferPtr - startupPtr) * 4u == mapSize&quot;, \n    file=file@entry=0x7fff945b0ba0 &quot;/var/lib/jenkins/workspace/ogre-2.1-debbuilder/repo/Components/Hlms/Pbs/src/OgreHlmsPbs.cpp&quot;, line=line@entry=1700, \n    function=function@entry=0x7fff945b1f40 &quot;virtual Ogre::HlmsCache Ogre::HlmsPbs::preparePassHash(const Ogre::CompositorShadowNode*, bool, bool, Ogre::SceneManager*)&quot;) at assert.c:92\n92  assert.c: No such file or directory.\n(gdb) \n#3  0x00007ffff7563412 in __GI___assert_fail (assertion=0x7fff945b1308 &quot;(size_t)(passBufferPtr - startupPtr) * 4u == mapSize&quot;, \n    file=0x7fff945b0ba0 &quot;/var/lib/jenkins/workspace/ogre-2.1-debbuilder/repo/Components/Hlms/Pbs/src/OgreHlmsPbs.cpp&quot;, line=1700, \n    function=0x7fff945b1f40 &quot;virtual Ogre::HlmsCache Ogre::HlmsPbs::preparePassHash(const Ogre::CompositorShadowNode*, bool, bool, Ogre::SceneManager*)&quot;) at assert.c:101\n101 in assert.c\n(gdb) \n#4  0x00007fff94588c48 in Ogre::HlmsPbs::preparePassHash(Ogre::CompositorShadowNode const*, bool, bool, Ogre::SceneManager*) () from /usr/lib/x86_64-linux-gnu/libOgreHlmsPbs.so.2.1.0\n(gdb) \n#5  0x00007fff94ac6e70 in Ogre::RenderQueue::render(Ogre::RenderSystem*, unsigned char, unsigned char, bool, bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#6  0x00007fff94b0e802 in Ogre::SceneManager::_renderPhase02(Ogre::Camera*, Ogre::Camera const*, Ogre::Viewport*, unsigned char, unsigned char, bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#7  0x00007fff94928716 in Ogre::Camera::_renderScenePhase02(Ogre::Camera const*, Ogre::Viewport*, unsigned char, unsigned char, bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#8  0x00007fff94ae19b9 in Ogre::RenderTarget::_updateViewportRenderPhase02(Ogre::Viewport*, Ogre::Camera*, Ogre::Camera const*, unsigned char, unsigned char, bool) ()\n   from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#9  0x00007fff94c399ca in Ogre::CompositorPassScene::execute(Ogre::Camera const*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#10 0x00007fff94c14c67 in Ogre::CompositorNode::_update(Ogre::Camera const*, Ogre::SceneManager*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#11 0x00007fff94c278ca in Ogre::CompositorWorkspace::_update() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#12 0x00007fff94c0f3c1 in Ogre::CompositorManager2::_updateImplementation(Ogre::SceneManagerEnumerator&amp;, Ogre::HlmsManager*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#13 0x00007fff94b00f95 in Ogre::Root::_updateAllRenderTargets() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#14 0x00007fff94b010fc in Ogre::Root::renderOneFrame() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n\n#15 0x00007fff950d77a5 in ignition::rendering::v2::Ogre2RenderTarget::Render (this=0x7fff886e5fb0) at /home/john/ign-ws/src/ign-rendering/ogre2/src/Ogre2RenderTarget.cc:173\n173   engine-&gt;OgreRoot()-&gt;renderOneFrame();\n(gdb) \n\n#16 0x00007fff9508d3f6 in ignition::rendering::v2::BaseCamera&lt;ignition::rendering::v2::Ogre2Sensor&gt;::Update (this=0x7fff886c3a20) at /usr/include/c++/8/ext/atomicity.h:82\n82        return __exchange_and_add(__mem, __val);\n(gdb) \n\n#17 0x00007fffac56451d in ignition::gazebo::v2::IgnRenderer::Render (this=0x555556fc76a0) at /usr/include/c++/8/bits/shared_ptr_base.h:1018\n1018          _M_get() const noexcept\n(gdb) \n#18 0x00007fffac565276 in ignition::gazebo::v2::RenderThread::RenderNext (this=0x555556fc7680) at /home/john/ign-ws/src/ign-gazebo/src/gui/plugins/scene3d/Scene3D.cc:1323\n1323      this-&gt;ignRenderer.Render();\n(gdb) \n#19 0x00007ffff117e0c2 in QObject::event(QEvent*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#20 0x00007ffff114e76a in QCoreApplication::notify(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#21 0x00007ffff114e8d8 in QCoreApplication::notifyInternal2(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#22 0x00007ffff115104d in QCoreApplicationPrivate::sendPostedEvents(QObject*, int, QThreadData*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#23 0x00007ffff11a8263 in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#24 0x00007fffed84a417 in g_main_context_dispatch () from /usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\n(gdb) \n#25 0x00007fffed84a650 in ?? () from /usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\n(gdb) \n#26 0x00007fffed84a6dc in g_main_context_iteration () from /usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\n(gdb) \n#27 0x00007ffff11a788f in QEventDispatcherGlib::processEvents(QFlags&lt;QEventLoop::ProcessEventsFlag&gt;) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#28 0x00007ffff114c90a in QEventLoop::exec(QFlags&lt;QEventLoop::ProcessEventsFlag&gt;) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#29 0x00007ffff0f6b23a in QThread::exec() () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#30 0x00007ffff0f7017d in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#31 0x00007ffff731b6db in start_thread (arg=0x7fff95c74700) at pthread_create.c:463\n463 pthread_create.c: No such file or directory.\n(gdb) \n#32 0x00007ffff765488f in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:95\n95  ../sysdeps/unix/sysv/linux/x86_64/clone.S: No such file or directory.\n(gdb) \n</pre></div>\n\n\n<p>\u200c</p>", "type": "rendered"}, "created_on": "2020-02-13T01:59:37.738092+00:00", "user": {"display_name": "John Shepherd", "uuid": "{c4803212-effe-4921-9323-02cd01b8bc9c}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc4803212-effe-4921-9323-02cd01b8bc9c%7D"}, "html": {"href": "https://bitbucket.org/%7Bc4803212-effe-4921-9323-02cd01b8bc9c%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/5d114073a232e50bd6f26983/41da687b-99ee-4c7e-a527-0202b6dc55f5/128"}}, "nickname": "John Shepherd", "type": "user", "account_id": "5d114073a232e50bd6f26983"}, "updated_on": "2020-02-13T01:59:37.744511+00:00", "type": "pullrequest_comment", "id": 135705128}