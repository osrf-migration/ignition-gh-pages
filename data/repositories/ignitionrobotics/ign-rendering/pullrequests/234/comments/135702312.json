{"links": {"self": {"href": "data/repositories/ignitionrobotics/ign-rendering/pullrequests/234/comments/135702312.json"}, "html": {"href": "#!/ignitionrobotics/ign-rendering/pull-requests/234/_/diff#comment-135702312"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 234, "links": {"self": {"href": "data/repositories/ignitionrobotics/ign-rendering/pullrequests/234.json"}, "html": {"href": "#!/ignitionrobotics/ign-rendering/pull-requests/234"}}, "title": "Prevent flaky crash"}, "content": {"raw": "I managed to catch this crash in gdb with stacktrace: \n\n```\nInvalid parameter at line 374 (@foreach). 'hlms_lights_directional' is not a number nor a variable\nterminate called after throwing an instance of 'Ogre::RenderingAPIException'\n  what():  OGRE EXCEPTION(3:RenderingAPIException): Fragment Program 536904192PixelShader_ps failed to compile. See compile log above for details. in GLSLShader::compile at /var/lib/jenkins/workspace/ogre-2.1-debbuilder/repo/RenderSystems/GL3Plus/src/GLSL/OgreGLSLShader.cpp (line 308)\n\nThread 15 \"ignition::gazeb\" received signal SIGABRT, Aborted.\n[Switching to Thread 0x7fff95c74700 (LWP 32581)]\n__GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\n51\t../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n(gdb) up\n#1  0x00007ffff7573801 in __GI_abort () at abort.c:79\n79\tabort.c: No such file or directory.\n(gdb) \n#2  0x00007ffff0b9e87e in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n(gdb) \n#3  0x00007ffff0baa486 in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n(gdb) \n#4  0x00007ffff0baa4f1 in std::terminate() () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n(gdb) \n#5  0x00007ffff0baa745 in __cxa_throw () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n(gdb) \n#6  0x00007fff8f271b11 in Ogre::GLSLShader::compile(bool) () from /usr/lib/x86_64-linux-gnu/OGRE-2.1/OGRE/RenderSystem_GL3Plus.so\n(gdb) \n#7  0x00007fff8f25d5d6 in Ogre::GLSLMonolithicProgram::compileAndLink() () from /usr/lib/x86_64-linux-gnu/OGRE-2.1/OGRE/RenderSystem_GL3Plus.so\n(gdb) \n#8  0x00007fff8f25d229 in Ogre::GLSLMonolithicProgram::activate() () from /usr/lib/x86_64-linux-gnu/OGRE-2.1/OGRE/RenderSystem_GL3Plus.so\n(gdb) \n#9  0x00007fff8f25ef99 in Ogre::GLSLMonolithicProgramManager::getActiveMonolithicProgram() () from /usr/lib/x86_64-linux-gnu/OGRE-2.1/OGRE/RenderSystem_GL3Plus.so\n(gdb) \n#10 0x00007fff8f2a80f5 in Ogre::GL3PlusRenderSystem::_setPipelineStateObject(Ogre::HlmsPso const*) () from /usr/lib/x86_64-linux-gnu/OGRE-2.1/OGRE/RenderSystem_GL3Plus.so\n(gdb) \n#11 0x00007fff945a9901 in Ogre::HlmsPbs::createShaderCacheEntry(unsigned int, Ogre::HlmsCache const&, unsigned int, Ogre::QueuedRenderable const&) () from /usr/lib/x86_64-linux-gnu/libOgreHlmsPbs.so.2.1.0\n(gdb) \n#12 0x00007fff94ae4d34 in Ogre::RenderQueue::renderGL3(bool, bool, Ogre::HlmsCache*, Ogre::RenderQueue::RenderQueueGroup const&, Ogre::IndirectBufferPacked*, unsigned char*, unsigned char*) ()\n   from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#13 0x00007fff94ae74a9 in Ogre::RenderQueue::render(Ogre::RenderSystem*, unsigned char, unsigned char, bool, bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#14 0x00007fff94b2e802 in Ogre::SceneManager::_renderPhase02(Ogre::Camera*, Ogre::Camera const*, Ogre::Viewport*, unsigned char, unsigned char, bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#15 0x00007fff94948716 in Ogre::Camera::_renderScenePhase02(Ogre::Camera const*, Ogre::Viewport*, unsigned char, unsigned char, bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#16 0x00007fff94b019b9 in Ogre::RenderTarget::_updateViewportRenderPhase02(Ogre::Viewport*, Ogre::Camera*, Ogre::Camera const*, unsigned char, unsigned char, bool) ()\n   from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#17 0x00007fff94c599ca in Ogre::CompositorPassScene::execute(Ogre::Camera const*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#18 0x00007fff94c34c67 in Ogre::CompositorNode::_update(Ogre::Camera const*, Ogre::SceneManager*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#19 0x00007fff94c40f57 in Ogre::CompositorShadowNode::_update(Ogre::Camera*, Ogre::Camera const*, Ogre::SceneManager*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#20 0x00007fff94c5988d in Ogre::CompositorPassScene::execute(Ogre::Camera const*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#21 0x00007fff94c34c67 in Ogre::CompositorNode::_update(Ogre::Camera const*, Ogre::SceneManager*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#22 0x00007fff94c478ca in Ogre::CompositorWorkspace::_update() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#23 0x00007fff94c2f3c1 in Ogre::CompositorManager2::_updateImplementation(Ogre::SceneManagerEnumerator&, Ogre::HlmsManager*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#24 0x00007fff94b20f95 in Ogre::Root::_updateAllRenderTargets() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#25 0x00007fff94b210fc in Ogre::Root::renderOneFrame() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n\n#26 0x00007fff950f77a5 in ignition::rendering::v2::Ogre2RenderTarget::Render (this=0x7fff886e2e70) at /home/john/ign-ws/src/ign-rendering/ogre2/src/Ogre2RenderTarget.cc:173\n173\t  engine->OgreRoot()->renderOneFrame();\n(gdb) \n\n#27 0x00007fff950ad3f6 in ignition::rendering::v2::BaseCamera<ignition::rendering::v2::Ogre2Sensor>::Update (this=0x7fff886c39f0) at /usr/include/c++/8/ext/atomicity.h:82\n82\t      return __exchange_and_add(__mem, __val);\n(gdb) \n#28 0x00007fffac58451d in ignition::gazebo::v2::IgnRenderer::Render (this=0x555556fc5c00) at /usr/include/c++/8/bits/shared_ptr_base.h:1018\n1018\t      _M_get() const noexcept\n(gdb) \n#29 0x00007fffac585276 in ignition::gazebo::v2::RenderThread::RenderNext (this=0x555556fc5be0) at /home/john/ign-ws/src/ign-gazebo/src/gui/plugins/scene3d/Scene3D.cc:1317\n1317\t  this->ignRenderer.Render();\n(gdb) \n#30 0x00007ffff119f0c2 in QObject::event(QEvent*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#31 0x00007ffff116f76a in QCoreApplication::notify(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) up\n#32 0x00007ffff116f8d8 in QCoreApplication::notifyInternal2(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#33 0x00007ffff117204d in QCoreApplicationPrivate::sendPostedEvents(QObject*, int, QThreadData*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#34 0x00007ffff11c9263 in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#35 0x00007fffed86b417 in g_main_context_dispatch () from /usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\n(gdb) \n#36 0x00007fffed86b650 in ?? () from /usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\n(gdb) \n#37 0x00007fffed86b6dc in g_main_context_iteration () from /usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\n(gdb) \n#38 0x00007ffff11c888f in QEventDispatcherGlib::processEvents(QFlags<QEventLoop::ProcessEventsFlag>) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#39 0x00007ffff116d90a in QEventLoop::exec(QFlags<QEventLoop::ProcessEventsFlag>) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#40 0x00007ffff0f8c23a in QThread::exec() () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#41 0x00007ffff0f9117d in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#42 0x00007ffff731b6db in start_thread (arg=0x7fff95c74700) at pthread_create.c:463\n463\tpthread_create.c: No such file or directory.\n(gdb) \n#43 0x00007ffff765488f in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:95\n95\t../sysdeps/unix/sysv/linux/x86_64/clone.S: No such file or directory.\n```\n\n\u200c", "markup": "markdown", "html": "<p>I managed to catch this crash in gdb with stacktrace: </p>\n<div class=\"codehilite\"><pre><span></span>Invalid parameter at line 374 (@foreach). &#39;hlms_lights_directional&#39; is not a number nor a variable\nterminate called after throwing an instance of &#39;Ogre::RenderingAPIException&#39;\n  what():  OGRE EXCEPTION(3:RenderingAPIException): Fragment Program 536904192PixelShader_ps failed to compile. See compile log above for details. in GLSLShader::compile at /var/lib/jenkins/workspace/ogre-2.1-debbuilder/repo/RenderSystems/GL3Plus/src/GLSL/OgreGLSLShader.cpp (line 308)\n\nThread 15 &quot;ignition::gazeb&quot; received signal SIGABRT, Aborted.\n[Switching to Thread 0x7fff95c74700 (LWP 32581)]\n__GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\n51  ../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\n(gdb) up\n#1  0x00007ffff7573801 in __GI_abort () at abort.c:79\n79  abort.c: No such file or directory.\n(gdb) \n#2  0x00007ffff0b9e87e in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n(gdb) \n#3  0x00007ffff0baa486 in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n(gdb) \n#4  0x00007ffff0baa4f1 in std::terminate() () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n(gdb) \n#5  0x00007ffff0baa745 in __cxa_throw () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n(gdb) \n#6  0x00007fff8f271b11 in Ogre::GLSLShader::compile(bool) () from /usr/lib/x86_64-linux-gnu/OGRE-2.1/OGRE/RenderSystem_GL3Plus.so\n(gdb) \n#7  0x00007fff8f25d5d6 in Ogre::GLSLMonolithicProgram::compileAndLink() () from /usr/lib/x86_64-linux-gnu/OGRE-2.1/OGRE/RenderSystem_GL3Plus.so\n(gdb) \n#8  0x00007fff8f25d229 in Ogre::GLSLMonolithicProgram::activate() () from /usr/lib/x86_64-linux-gnu/OGRE-2.1/OGRE/RenderSystem_GL3Plus.so\n(gdb) \n#9  0x00007fff8f25ef99 in Ogre::GLSLMonolithicProgramManager::getActiveMonolithicProgram() () from /usr/lib/x86_64-linux-gnu/OGRE-2.1/OGRE/RenderSystem_GL3Plus.so\n(gdb) \n#10 0x00007fff8f2a80f5 in Ogre::GL3PlusRenderSystem::_setPipelineStateObject(Ogre::HlmsPso const*) () from /usr/lib/x86_64-linux-gnu/OGRE-2.1/OGRE/RenderSystem_GL3Plus.so\n(gdb) \n#11 0x00007fff945a9901 in Ogre::HlmsPbs::createShaderCacheEntry(unsigned int, Ogre::HlmsCache const&amp;, unsigned int, Ogre::QueuedRenderable const&amp;) () from /usr/lib/x86_64-linux-gnu/libOgreHlmsPbs.so.2.1.0\n(gdb) \n#12 0x00007fff94ae4d34 in Ogre::RenderQueue::renderGL3(bool, bool, Ogre::HlmsCache*, Ogre::RenderQueue::RenderQueueGroup const&amp;, Ogre::IndirectBufferPacked*, unsigned char*, unsigned char*) ()\n   from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#13 0x00007fff94ae74a9 in Ogre::RenderQueue::render(Ogre::RenderSystem*, unsigned char, unsigned char, bool, bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#14 0x00007fff94b2e802 in Ogre::SceneManager::_renderPhase02(Ogre::Camera*, Ogre::Camera const*, Ogre::Viewport*, unsigned char, unsigned char, bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#15 0x00007fff94948716 in Ogre::Camera::_renderScenePhase02(Ogre::Camera const*, Ogre::Viewport*, unsigned char, unsigned char, bool) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#16 0x00007fff94b019b9 in Ogre::RenderTarget::_updateViewportRenderPhase02(Ogre::Viewport*, Ogre::Camera*, Ogre::Camera const*, unsigned char, unsigned char, bool) ()\n   from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#17 0x00007fff94c599ca in Ogre::CompositorPassScene::execute(Ogre::Camera const*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#18 0x00007fff94c34c67 in Ogre::CompositorNode::_update(Ogre::Camera const*, Ogre::SceneManager*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#19 0x00007fff94c40f57 in Ogre::CompositorShadowNode::_update(Ogre::Camera*, Ogre::Camera const*, Ogre::SceneManager*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#20 0x00007fff94c5988d in Ogre::CompositorPassScene::execute(Ogre::Camera const*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#21 0x00007fff94c34c67 in Ogre::CompositorNode::_update(Ogre::Camera const*, Ogre::SceneManager*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#22 0x00007fff94c478ca in Ogre::CompositorWorkspace::_update() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#23 0x00007fff94c2f3c1 in Ogre::CompositorManager2::_updateImplementation(Ogre::SceneManagerEnumerator&amp;, Ogre::HlmsManager*) () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#24 0x00007fff94b20f95 in Ogre::Root::_updateAllRenderTargets() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n#25 0x00007fff94b210fc in Ogre::Root::renderOneFrame() () from /usr/lib/x86_64-linux-gnu/libOgreMain.so.2.1.0\n(gdb) \n\n#26 0x00007fff950f77a5 in ignition::rendering::v2::Ogre2RenderTarget::Render (this=0x7fff886e2e70) at /home/john/ign-ws/src/ign-rendering/ogre2/src/Ogre2RenderTarget.cc:173\n173   engine-&gt;OgreRoot()-&gt;renderOneFrame();\n(gdb) \n\n#27 0x00007fff950ad3f6 in ignition::rendering::v2::BaseCamera&lt;ignition::rendering::v2::Ogre2Sensor&gt;::Update (this=0x7fff886c39f0) at /usr/include/c++/8/ext/atomicity.h:82\n82        return __exchange_and_add(__mem, __val);\n(gdb) \n#28 0x00007fffac58451d in ignition::gazebo::v2::IgnRenderer::Render (this=0x555556fc5c00) at /usr/include/c++/8/bits/shared_ptr_base.h:1018\n1018          _M_get() const noexcept\n(gdb) \n#29 0x00007fffac585276 in ignition::gazebo::v2::RenderThread::RenderNext (this=0x555556fc5be0) at /home/john/ign-ws/src/ign-gazebo/src/gui/plugins/scene3d/Scene3D.cc:1317\n1317      this-&gt;ignRenderer.Render();\n(gdb) \n#30 0x00007ffff119f0c2 in QObject::event(QEvent*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#31 0x00007ffff116f76a in QCoreApplication::notify(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) up\n#32 0x00007ffff116f8d8 in QCoreApplication::notifyInternal2(QObject*, QEvent*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#33 0x00007ffff117204d in QCoreApplicationPrivate::sendPostedEvents(QObject*, int, QThreadData*) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#34 0x00007ffff11c9263 in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#35 0x00007fffed86b417 in g_main_context_dispatch () from /usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\n(gdb) \n#36 0x00007fffed86b650 in ?? () from /usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\n(gdb) \n#37 0x00007fffed86b6dc in g_main_context_iteration () from /usr/lib/x86_64-linux-gnu/libglib-2.0.so.0\n(gdb) \n#38 0x00007ffff11c888f in QEventDispatcherGlib::processEvents(QFlags&lt;QEventLoop::ProcessEventsFlag&gt;) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#39 0x00007ffff116d90a in QEventLoop::exec(QFlags&lt;QEventLoop::ProcessEventsFlag&gt;) () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#40 0x00007ffff0f8c23a in QThread::exec() () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#41 0x00007ffff0f9117d in ?? () from /usr/lib/x86_64-linux-gnu/libQt5Core.so.5\n(gdb) \n#42 0x00007ffff731b6db in start_thread (arg=0x7fff95c74700) at pthread_create.c:463\n463 pthread_create.c: No such file or directory.\n(gdb) \n#43 0x00007ffff765488f in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:95\n95  ../sysdeps/unix/sysv/linux/x86_64/clone.S: No such file or directory.\n</pre></div>\n\n\n<p>\u200c</p>", "type": "rendered"}, "created_on": "2020-02-13T01:05:36.845090+00:00", "user": {"display_name": "John Shepherd", "uuid": "{c4803212-effe-4921-9323-02cd01b8bc9c}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc4803212-effe-4921-9323-02cd01b8bc9c%7D"}, "html": {"href": "https://bitbucket.org/%7Bc4803212-effe-4921-9323-02cd01b8bc9c%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/5d114073a232e50bd6f26983/41da687b-99ee-4c7e-a527-0202b6dc55f5/128"}}, "nickname": "John Shepherd", "type": "user", "account_id": "5d114073a232e50bd6f26983"}, "updated_on": "2020-02-13T01:05:36.865921+00:00", "type": "pullrequest_comment", "id": 135702312}